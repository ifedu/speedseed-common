var Stream = require('stream');
module.exports = MuteStream;
// var out = new MuteStream(process.stdout)
// argument auto-pipes
function MuteStream(opts) {
    Stream.apply(this);
    opts = opts || {};
    this.writable = this.readable = true;
    this.muted = false;
    this.on('pipe', this._onpipe);
    this.replace = opts.replace;
    // For readline-type situations
    // This much at the start of a line being redrawn after a ctrl char
    // is seen (such as backspace) won't be redrawn as the replacement
    this._prompt = opts.prompt || null;
    this._hadControl = false;
}
MuteStream.prototype = Object.create(Stream.prototype);
Object.defineProperty(MuteStream.prototype, 'constructor', {
    value: MuteStream,
    enumerable: false
});
MuteStream.prototype.mute = function () {
    this.muted = true;
};
MuteStream.prototype.unmute = function () {
    this.muted = false;
};
Object.defineProperty(MuteStream.prototype, '_onpipe', {
    value: onPipe,
    enumerable: false,
    writable: true,
    configurable: true
});
function onPipe(src) {
    this._src = src;
}
Object.defineProperty(MuteStream.prototype, 'isTTY', {
    get: getIsTTY,
    set: setIsTTY,
    enumerable: true,
    configurable: true
});
function getIsTTY() {
    return ((this._dest) ? this._dest.isTTY
        : (this._src) ? this._src.isTTY
            : false);
}
// basically just get replace the getter/setter with a regular value
function setIsTTY(isTTY) {
    Object.defineProperty(this, 'isTTY', {
        value: isTTY,
        enumerable: true,
        writable: true,
        configurable: true
    });
}
Object.defineProperty(MuteStream.prototype, 'rows', {
    get: function () {
        return (this._dest ? this._dest.rows
            : this._src ? this._src.rows
                : undefined);
    }, enumerable: true, configurable: true
});
Object.defineProperty(MuteStream.prototype, 'columns', {
    get: function () {
        return (this._dest ? this._dest.columns
            : this._src ? this._src.columns
                : undefined);
    }, enumerable: true, configurable: true
});
MuteStream.prototype.pipe = function (dest, options) {
    this._dest = dest;
    return Stream.prototype.pipe.call(this, dest, options);
};
MuteStream.prototype.pause = function () {
    if (this._src)
        return this._src.pause();
};
MuteStream.prototype.resume = function () {
    if (this._src)
        return this._src.resume();
};
MuteStream.prototype.write = function (c) {
    if (this.muted) {
        if (!this.replace)
            return true;
        if (c.match(/^\u001b/)) {
            if (c.indexOf(this._prompt) === 0) {
                c = c.substr(this._prompt.length);
                c = c.replace(/./g, this.replace);
                c = this._prompt + c;
            }
            this._hadControl = true;
            return this.emit('data', c);
        }
        else {
            if (this._prompt && this._hadControl &&
                c.indexOf(this._prompt) === 0) {
                this._hadControl = false;
                this.emit('data', this._prompt);
                c = c.substr(this._prompt.length);
            }
            c = c.toString().replace(/./g, this.replace);
        }
    }
    this.emit('data', c);
};
MuteStream.prototype.end = function (c) {
    if (this.muted) {
        if (c && this.replace) {
            c = c.toString().replace(/./g, this.replace);
        }
        else {
            c = null;
        }
    }
    if (c)
        this.emit('data', c);
    this.emit('end');
};
function proxy(fn) {
    return function () {
        var d = this._dest;
        var s = this._src;
        if (d && d[fn])
            d[fn].apply(d, arguments);
        if (s && s[fn])
            s[fn].apply(s, arguments);
    };
}
MuteStream.prototype.destroy = proxy('destroy');
MuteStream.prototype.destroySoon = proxy('destroySoon');
MuteStream.prototype.close = proxy('close');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxtdXRlLXN0cmVhbVxcbXV0ZS5qcyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxtdXRlLXN0cmVhbVxcbXV0ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUE7QUFFOUIsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFVLENBQUE7QUFFM0IsMkNBQTJDO0FBQzNDLHNCQUFzQjtBQUN0QixvQkFBcUIsSUFBSTtJQUN2QixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2xCLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFBO0lBQ2pCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUE7SUFDcEMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUE7SUFDbEIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQzdCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQTtJQUUzQiwrQkFBK0I7SUFDL0IsbUVBQW1FO0lBQ25FLGtFQUFrRTtJQUNsRSxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFBO0lBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFBO0FBQzFCLENBQUM7QUFFRCxVQUFVLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMs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QUFLLEdBQUc7SUFDM0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO0FBQ3pDLENBQUMsQ0FBQTtBQUVELFVBQVUsQ0FBQyxTQUFTLENBQUMsTUFBTSxHQUFHO0lBQzVCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQTtBQUMxQyxDQUFDLENBQUE7QUFFRCxVQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUM7SUFDdEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDZixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFBO1FBQzlCLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2xDLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ2xDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztZQUN2QixDQUFDO1lBQ0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUE7WUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFBO1FBQzdCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLFdBQVc7Z0JBQ2hDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFBO2dCQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7Z0JBQy9CLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7WUFDbkMsQ0FBQztZQUNELENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7UUFDOUMsQ0FBQztJQUNILENBQUM7SUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUN0QixDQUFDLENBQUE7QUFFRCxVQUFVLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxVQUFVLENBQUM7SUFDcEMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDZixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDdEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUM5QyxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixDQUFDLEdBQUcsSUFBSSxDQUFBO1FBQ1YsQ0FBQztJQUNILENBQUM7SUFDRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUMzQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ2xCLENBQUMsQ0FBQTtBQUVELGVBQWdCLEVBQUU7SUFBSSxNQUFNLENBQUM7UUFDM0IsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQTtRQUNsQixJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFBO1FBQ2pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQTtRQUN6QyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUE7SUFDM0MsQ0FBQyxDQUFBO0FBQUEsQ0FBQztBQUVGLFVBQVUsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQTtBQUMvQyxVQUFVLENBQUMsU0FBUyxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUE7QUFDdkQsVUFBVSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFN0cmVhbSA9IHJlcXVpcmUoJ3N0cmVhbScpXG5cbm1vZHVsZS5leHBvcnRzID0gTXV0ZVN0cmVhbVxuXG4vLyB2YXIgb3V0ID0gbmV3IE11dGVTdHJlYW0ocHJvY2Vzcy5zdGRvdXQpXG4vLyBhcmd1bWVudCBhdXRvLXBpcGVzXG5mdW5jdGlvbiBNdXRlU3RyZWFtIChvcHRzKSB7XG4gIFN0cmVhbS5hcHBseSh0aGlzKVxuICBvcHRzID0gb3B0cyB8fCB7fVxuICB0aGlzLndyaXRhYmxlID0gdGhpcy5yZWFkYWJsZSA9IHRydWVcbiAgdGhpcy5tdXRlZCA9IGZhbHNlXG4gIHRoaXMub24oJ3BpcGUnLCB0aGlzLl9vbnBpcGUpXG4gIHRoaXMucmVwbGFjZSA9IG9wdHMucmVwbGFjZVxuXG4gIC8vIEZvciByZWFkbGluZS10eXBlIHNpdHVhdGlvbnNcbiAgLy8gVGhpcyBtdWNoIGF0IHRoZSBzdGFydCBvZiBhIGxpbmUgYmVpbmcgcmVkcmF3biBhZnRlciBhIGN0cmwgY2hhclxuICAvLyBpcyBzZWVuIChzdWNoIGFzIGJhY2tzcGFjZSkgd29uJ3QgYmUgcmVkcmF3biBhcyB0aGUgcmVwbGFjZW1lbnRcbiAgdGhpcy5fcHJvbXB0ID0gb3B0cy5wcm9tcHQgfHwgbnVsbFxuICB0aGlzLl9oYWRDb250cm9sID0gZmFsc2Vcbn1cblxuTXV0ZVN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFN0cmVhbS5wcm90b3R5cGUpXG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShNdXRlU3RyZWFtLnByb3RvdHlwZSwgJ2NvbnN0cnVjdG9yJywge1xuICB2YWx1ZTogTXV0ZVN0cmVhbSxcbiAgZW51bWVyYWJsZTogZmFsc2Vcbn0pXG5cbk11dGVTdHJlYW0ucHJvdG90eXBlLm11dGUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMubXV0ZWQgPSB0cnVlXG59XG5cbk11dGVTdHJlYW0ucHJvdG90eXBlLnVubXV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5tdXRlZCA9IGZhbHNlXG59XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShNdXRlU3RyZWFtLnByb3RvdHlwZSwgJ19vbnBpcGUnLCB7XG4gIHZhbHVlOiBvblBpcGUsXG4gIGVudW1lcmFibGU6IGZhbHNlLFxuICB3cml0YWJsZTogdHJ1ZSxcbiAgY29uZmlndXJhYmxlOiB0cnVlXG59KVxuXG5mdW5jdGlvbiBvblBpcGUgKHNyYykge1xuICB0aGlzLl9zcmMgPSBzcmNcbn1cblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KE11dGVTdHJlYW0ucHJvdG90eXBlLCAnaXNUVFknLCB7XG4gIGdldDogZ2V0SXNUVFksXG4gIHNldDogc2V0SXNUVFksXG4gIGVudW1lcmFibGU6IHRydWUsXG4gIGNvbmZpZ3VyYWJsZTogdHJ1ZVxufSlcblxuZnVuY3Rpb24gZ2V0SXNUVFkgKCkge1xuICByZXR1cm4oICh0aGlzLl9kZXN0KSA/IHRoaXMuX2Rlc3QuaXNUVFlcbiAgICAgICAgOiAodGhpcy5fc3JjKSA/IHRoaXMuX3NyYy5pc1RUWVxuICAgICAgICA6IGZhbHNlXG4gICAgICAgIClcbn1cblxuLy8gYmFzaWNhbGx5IGp1c3QgZ2V0IHJlcGxhY2UgdGhlIGdldHRlci9zZXR0ZXIgd2l0aCBhIHJlZ3VsYXIgdmFsdWVcbmZ1bmN0aW9uIHNldElzVFRZIChpc1RUWSkge1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgJ2lzVFRZJywge1xuICAgIHZhbHVlOiBpc1RUWSxcbiAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICB9KVxufVxuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoTXV0ZVN0cmVhbS5wcm90b3R5cGUsICdyb3dzJywge1xuICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4oIHRoaXMuX2Rlc3QgPyB0aGlzLl9kZXN0LnJvd3NcbiAgICAgICAgICA6IHRoaXMuX3NyYyA/IHRoaXMuX3NyYy5yb3dzXG4gICAgICAgICAgOiB1bmRlZmluZWQgKVxuICB9LCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSlcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KE11dGVTdHJlYW0ucHJvdG90eXBlLCAnY29sdW1ucycsIHtcbiAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuKCB0aGlzLl9kZXN0ID8gdGhpcy5fZGVzdC5jb2x1bW5zXG4gICAgICAgICAgOiB0aGlzLl9zcmMgPyB0aGlzLl9zcmMuY29sdW1uc1xuICAgICAgICAgIDogdW5kZWZpbmVkIClcbiAgfSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0pXG5cblxuTXV0ZVN0cmVhbS5wcm90b3R5cGUucGlwZSA9IGZ1bmN0aW9uIChkZXN0LCBvcHRpb25zKSB7XG4gIHRoaXMuX2Rlc3QgPSBkZXN0XG4gIHJldHVybiBTdHJlYW0ucHJvdG90eXBlLnBpcGUuY2FsbCh0aGlzLCBkZXN0LCBvcHRpb25zKVxufVxuXG5NdXRlU3RyZWFtLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuX3NyYykgcmV0dXJuIHRoaXMuX3NyYy5wYXVzZSgpXG59XG5cbk11dGVTdHJlYW0ucHJvdG90eXBlLnJlc3VtZSA9IGZ1bmN0aW9uICgpIHtcbiAgaWYgKHRoaXMuX3NyYykgcmV0dXJuIHRoaXMuX3NyYy5yZXN1bWUoKVxufVxuXG5NdXRlU3RyZWFtLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChjKSB7XG4gIGlmICh0aGlzLm11dGVkKSB7XG4gICAgaWYgKCF0aGlzLnJlcGxhY2UpIHJldHVybiB0cnVlXG4gICAgaWYgKGMubWF0Y2goL15cXHUwMDFiLykpIHtcbiAgICAgIGlmKGMuaW5kZXhPZih0aGlzLl9wcm9tcHQpID09PSAwKSB7XG4gICAgICAgIGMgPSBjLnN1YnN0cih0aGlzLl9wcm9tcHQubGVuZ3RoKTtcbiAgICAgICAgYyA9IGMucmVwbGFjZSgvLi9nLCB0aGlzLnJlcGxhY2UpO1xuICAgICAgICBjID0gdGhpcy5fcHJvbXB0ICsgYztcbiAgICAgIH1cbiAgICAgIHRoaXMuX2hhZENvbnRyb2wgPSB0cnVlXG4gICAgICByZXR1cm4gdGhpcy5lbWl0KCdkYXRhJywgYylcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRoaXMuX3Byb21wdCAmJiB0aGlzLl9oYWRDb250cm9sICYmXG4gICAgICAgICAgYy5pbmRleE9mKHRoaXMuX3Byb21wdCkgPT09IDApIHtcbiAgICAgICAgdGhpcy5faGFkQ29udHJvbCA9IGZhbHNlXG4gICAgICAgIHRoaXMuZW1pdCgnZGF0YScsIHRoaXMuX3Byb21wdClcbiAgICAgICAgYyA9IGMuc3Vic3RyKHRoaXMuX3Byb21wdC5sZW5ndGgpXG4gICAgICB9XG4gICAgICBjID0gYy50b1N0cmluZygpLnJlcGxhY2UoLy4vZywgdGhpcy5yZXBsYWNlKVxuICAgIH1cbiAgfVxuICB0aGlzLmVtaXQoJ2RhdGEnLCBjKVxufVxuXG5NdXRlU3RyZWFtLnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoYykge1xuICBpZiAodGhpcy5tdXRlZCkge1xuICAgIGlmIChjICYmIHRoaXMucmVwbGFjZSkge1xuICAgICAgYyA9IGMudG9TdHJpbmcoKS5yZXBsYWNlKC8uL2csIHRoaXMucmVwbGFjZSlcbiAgICB9IGVsc2Uge1xuICAgICAgYyA9IG51bGxcbiAgICB9XG4gIH1cbiAgaWYgKGMpIHRoaXMuZW1pdCgnZGF0YScsIGMpXG4gIHRoaXMuZW1pdCgnZW5kJylcbn1cblxuZnVuY3Rpb24gcHJveHkgKGZuKSB7IHJldHVybiBmdW5jdGlvbiAoKSB7XG4gIHZhciBkID0gdGhpcy5fZGVzdFxuICB2YXIgcyA9IHRoaXMuX3NyY1xuICBpZiAoZCAmJiBkW2ZuXSkgZFtmbl0uYXBwbHkoZCwgYXJndW1lbnRzKVxuICBpZiAocyAmJiBzW2ZuXSkgc1tmbl0uYXBwbHkocywgYXJndW1lbnRzKVxufX1cblxuTXV0ZVN0cmVhbS5wcm90b3R5cGUuZGVzdHJveSA9IHByb3h5KCdkZXN0cm95Jylcbk11dGVTdHJlYW0ucHJvdG90eXBlLmRlc3Ryb3lTb29uID0gcHJveHkoJ2Rlc3Ryb3lTb29uJylcbk11dGVTdHJlYW0ucHJvdG90eXBlLmNsb3NlID0gcHJveHkoJ2Nsb3NlJylcbiJdfQ==