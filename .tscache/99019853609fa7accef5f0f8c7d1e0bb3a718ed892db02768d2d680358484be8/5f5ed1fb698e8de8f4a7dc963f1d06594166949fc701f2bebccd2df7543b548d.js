'use strict';
var Promise = require('pinkie-promise');
var arrayUnion = require('array-union');
var objectAssign = require('object-assign');
var glob = require('glob');
var arrify = require('arrify');
var pify = require('pify');
var globP = pify(glob, Promise).bind(glob);
function isNegative(pattern) {
    return pattern[0] === '!';
}
function generateGlobTasks(patterns, opts) {
    var globTasks = [];
    patterns = arrify(patterns);
    opts = objectAssign({ ignore: [] }, opts);
    patterns.forEach(function (pattern, i) {
        if (isNegative(pattern)) {
            return;
        }
        var ignore = patterns.slice(i).filter(isNegative).map(function (pattern) {
            return pattern.slice(1);
        });
        globTasks.push({
            pattern: pattern,
            opts: objectAssign({}, opts, {
                ignore: opts.ignore.concat(ignore)
            })
        });
    });
    return globTasks;
}
module.exports = function (patterns, opts) {
    var globTasks = generateGlobTasks(patterns, opts);
    return Promise.all(globTasks.map(function (task) {
        return globP(task.pattern, task.opts);
    })).then(function (paths) {
        return arrayUnion.apply(null, paths);
    });
};
module.exports.sync = function (patterns, opts) {
    var globTasks = generateGlobTasks(patterns, opts);
    return globTasks.reduce(function (matches, task) {
        return arrayUnion(matches, glob.sync(task.pattern, task.opts));
    }, []);
};
module.exports.generateGlobTasks = generateGlobTasks;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFx5ZW9tYW4tZW52aXJvbm1lbnRcXG5vZGVfbW9kdWxlc1xcZ2xvYmJ5XFxpbmRleC5qcyIsInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFx5ZW9tYW4tZW52aXJvbm1lbnRcXG5vZGVfbW9kdWxlc1xcZ2xvYmJ5XFxpbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFDYixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUN4QyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFDeEMsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzVDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBRTNCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBRTNDLG9CQUFvQixPQUFPO0lBQzFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDO0FBQzNCLENBQUM7QUFFRCwyQkFBMkIsUUFBUSxFQUFFLElBQUk7SUFDeEMsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBRW5CLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDNUIsSUFBSSxHQUFHLFlBQVksQ0FBQyxFQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUV4QyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQVUsT0FBTyxFQUFFLENBQUM7UUFDcEMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixNQUFNLENBQUM7UUFDUixDQUFDO1FBRUQsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVUsT0FBTztZQUN0RSxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixDQUFDLENBQUMsQ0FBQztRQUVILFNBQVMsQ0FBQyxJQUFJLENBQUM7WUFDZCxPQUFPLEVBQUUsT0FBTztZQUNoQixJQUFJLEVBQUUsWUFBWSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUU7Z0JBQzVCLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7YUFDbEMsQ0FBQztTQUNGLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQztBQUNsQixDQUFDO0FBRUQsTUFBTSxDQUFDLE9BQU8sR0FBRyxVQUFVLFFBQVEsRUFBRSxJQUFJO0lBQ3hDLElBQUksU0FBUyxHQUFHLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUVsRCxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSTtRQUM5QyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsS0FBSztRQUN2QixNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksR0FBRyxVQUFVLFFBQVEsRUFBRSxJQUFJO0lBQzdDLElBQUksU0FBUyxHQUFHLGlCQUFpQixDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUVsRCxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLE9BQU8sRUFBRSxJQUFJO1FBQzlDLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDUixDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIFByb21pc2UgPSByZXF1aXJlKCdwaW5raWUtcHJvbWlzZScpO1xudmFyIGFycmF5VW5pb24gPSByZXF1aXJlKCdhcnJheS11bmlvbicpO1xudmFyIG9iamVjdEFzc2lnbiA9IHJlcXVpcmUoJ29iamVjdC1hc3NpZ24nKTtcbnZhciBnbG9iID0gcmVxdWlyZSgnZ2xvYicpO1xudmFyIGFycmlmeSA9IHJlcXVpcmUoJ2FycmlmeScpO1xudmFyIHBpZnkgPSByZXF1aXJlKCdwaWZ5Jyk7XG5cbnZhciBnbG9iUCA9IHBpZnkoZ2xvYiwgUHJvbWlzZSkuYmluZChnbG9iKTtcblxuZnVuY3Rpb24gaXNOZWdhdGl2ZShwYXR0ZXJuKSB7XG5cdHJldHVybiBwYXR0ZXJuWzBdID09PSAnISc7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlR2xvYlRhc2tzKHBhdHRlcm5zLCBvcHRzKSB7XG5cdHZhciBnbG9iVGFza3MgPSBbXTtcblxuXHRwYXR0ZXJucyA9IGFycmlmeShwYXR0ZXJucyk7XG5cdG9wdHMgPSBvYmplY3RBc3NpZ24oe2lnbm9yZTogW119LCBvcHRzKTtcblxuXHRwYXR0ZXJucy5mb3JFYWNoKGZ1bmN0aW9uIChwYXR0ZXJuLCBpKSB7XG5cdFx0aWYgKGlzTmVnYXRpdmUocGF0dGVybikpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR2YXIgaWdub3JlID0gcGF0dGVybnMuc2xpY2UoaSkuZmlsdGVyKGlzTmVnYXRpdmUpLm1hcChmdW5jdGlvbiAocGF0dGVybikge1xuXHRcdFx0cmV0dXJuIHBhdHRlcm4uc2xpY2UoMSk7XG5cdFx0fSk7XG5cblx0XHRnbG9iVGFza3MucHVzaCh7XG5cdFx0XHRwYXR0ZXJuOiBwYXR0ZXJuLFxuXHRcdFx0b3B0czogb2JqZWN0QXNzaWduKHt9LCBvcHRzLCB7XG5cdFx0XHRcdGlnbm9yZTogb3B0cy5pZ25vcmUuY29uY2F0KGlnbm9yZSlcblx0XHRcdH0pXG5cdFx0fSk7XG5cdH0pO1xuXG5cdHJldHVybiBnbG9iVGFza3M7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKHBhdHRlcm5zLCBvcHRzKSB7XG5cdHZhciBnbG9iVGFza3MgPSBnZW5lcmF0ZUdsb2JUYXNrcyhwYXR0ZXJucywgb3B0cyk7XG5cblx0cmV0dXJuIFByb21pc2UuYWxsKGdsb2JUYXNrcy5tYXAoZnVuY3Rpb24gKHRhc2spIHtcblx0XHRyZXR1cm4gZ2xvYlAodGFzay5wYXR0ZXJuLCB0YXNrLm9wdHMpO1xuXHR9KSkudGhlbihmdW5jdGlvbiAocGF0aHMpIHtcblx0XHRyZXR1cm4gYXJyYXlVbmlvbi5hcHBseShudWxsLCBwYXRocyk7XG5cdH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMuc3luYyA9IGZ1bmN0aW9uIChwYXR0ZXJucywgb3B0cykge1xuXHR2YXIgZ2xvYlRhc2tzID0gZ2VuZXJhdGVHbG9iVGFza3MocGF0dGVybnMsIG9wdHMpO1xuXG5cdHJldHVybiBnbG9iVGFza3MucmVkdWNlKGZ1bmN0aW9uIChtYXRjaGVzLCB0YXNrKSB7XG5cdFx0cmV0dXJuIGFycmF5VW5pb24obWF0Y2hlcywgZ2xvYi5zeW5jKHRhc2sucGF0dGVybiwgdGFzay5vcHRzKSk7XG5cdH0sIFtdKTtcbn07XG5cbm1vZHVsZS5leHBvcnRzLmdlbmVyYXRlR2xvYlRhc2tzID0gZ2VuZXJhdGVHbG9iVGFza3M7XG4iXX0=