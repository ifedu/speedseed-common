/*istanbul ignore start*/ 'use strict';
exports.__esModule = true;
exports.jsonDiff = undefined;
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };
exports.diffJson = diffJson;
/*istanbul ignore start*/ exports.canonicalize = canonicalize;
var /*istanbul ignore start*/ _base = require('./base') /*istanbul ignore end*/;
/*istanbul ignore start*/
var _base2 = _interopRequireDefault(_base);
/*istanbul ignore end*/
var /*istanbul ignore start*/ _line = require('./line') /*istanbul ignore end*/;
/*istanbul ignore start*/
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
/*istanbul ignore end*/
var objectPrototypeToString = Object.prototype.toString;
var jsonDiff = exports.jsonDiff = new _base2.default() /*istanbul ignore end*/;
// Discriminate between two lines of pretty-printed, serialized JSON where one of them has a
// dangling comma and the other doesn't. Turns out including the dangling comma yields the nicest output:
jsonDiff.useLongestToken = true;
jsonDiff.tokenize = /*istanbul ignore start*/ _line.lineDiff.tokenize;
jsonDiff.castInput = function (value) {
    return typeof value === 'string' ? value : JSON.stringify(canonicalize(value), undefined, '  ');
};
jsonDiff.equals = function (left, right) {
    return (_base2.default.prototype.equals(left.replace(/,([\r\n])/g, '$1'), right.replace(/,([\r\n])/g, '$1')));
};
function diffJson(oldObj, newObj, callback) {
    return jsonDiff.diff(oldObj, newObj, callback);
}
// This function handles the presence of circular references by bailing out when encountering an
// object that is already on the "stack" of items being processed.
function canonicalize(obj, stack, replacementStack) {
    stack = stack || [];
    replacementStack = replacementStack || [];
    var i = void 0 /*istanbul ignore end*/;
    for (i = 0; i < stack.length; i += 1) {
        if (stack[i] === obj) {
            return replacementStack[i];
        }
    }
    var canonicalizedObj = void 0 /*istanbul ignore end*/;
    if ('[object Array]' === objectPrototypeToString.call(obj)) {
        stack.push(obj);
        canonicalizedObj = new Array(obj.length);
        replacementStack.push(canonicalizedObj);
        for (i = 0; i < obj.length; i += 1) {
            canonicalizedObj[i] = canonicalize(obj[i], stack, replacementStack);
        }
        stack.pop();
        replacementStack.pop();
        return canonicalizedObj;
    }
    if (obj && obj.toJSON) {
        obj = obj.toJSON();
    }
    if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) === 'object' && obj !== null) {
        stack.push(obj);
        canonicalizedObj = {};
        replacementStack.push(canonicalizedObj);
        var sortedKeys = [], key = void 0 /*istanbul ignore end*/;
        for (key in obj) {
            /* istanbul ignore else */
            if (obj.hasOwnProperty(key)) {
                sortedKeys.push(key);
            }
        }
        sortedKeys.sort();
        for (i = 0; i < sortedKeys.length; i += 1) {
            key = sortedKeys[i];
            canonicalizedObj[key] = canonicalize(obj[key], stack, replacementStack);
        }
        stack.pop();
        replacementStack.pop();
    }
    else {
        canonicalizedObj = obj;
    }
    return canonicalizedObj;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFx5ZW9tYW4tZW52aXJvbm1lbnRcXG5vZGVfbW9kdWxlc1xcZGlmZlxcbGliXFxkaWZmXFxqc29uLmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGlmZWR1XFxBcHBEYXRhXFxSb2FtaW5nXFxudm1cXHY4LjQuMFxcbm9kZV9tb2R1bGVzXFxnZW5lcmF0b3Itc3BlZWRzZWVkXFxub2RlX21vZHVsZXNcXHllb21hbi1lbnZpcm9ubWVudFxcbm9kZV9tb2R1bGVzXFxkaWZmXFxsaWJcXGRpZmZcXGpzb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEseUJBQXlCLENBQUEsWUFBWSxDQUFDO0FBRXRDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0FBQzFCLE9BQU8sQ0FBQyxRQUFRLEdBQUcsU0FBUyxDQUFDO0FBRTdCLElBQUksT0FBTyxHQUFHLE9BQU8sTUFBTSxLQUFLLFVBQVUsSUFBSSxPQUFPLE1BQU0sQ0FBQyxRQUFRLEtBQUssUUFBUSxHQUFHLFVBQVUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxVQUFVLEdBQUcsSUFBSSxNQUFNLENBQUMsR0FBRyxJQUFJLE9BQU8sTUFBTSxLQUFLLFVBQVUsSUFBSSxHQUFHLENBQUMsV0FBVyxLQUFLLE1BQU0sR0FBRyxRQUFRLEdBQUcsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFalAsT0FBTyxDQUF5QixRQUFRLEdBQUcsUUFBUSxDQUFDO0FBQ3BELHlCQUF5QixDQUFBLE9BQU8sQ0FBeUIsWUFBWSxHQUFHLFlBQVksQ0FBQztBQUVyRixJQUFJLHlCQUF5QixDQUFBLEtBQUssR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsdUJBQXVCLENBQUM7QUFFL0Us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LENBQUM7UUFDbEIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDMUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQixnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFDRCxLQUFLLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDWixnQkFBZ0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixnQkFBZ0IsR0FBRyxHQUFHLENBQUM7SUFDekIsQ0FBQztJQUNELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztBQUMxQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyppc3RhbmJ1bCBpZ25vcmUgc3RhcnQqLyd1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHMuanNvbkRpZmYgPSB1bmRlZmluZWQ7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG5leHBvcnRzLiAvKmlzdGFuYnVsIGlnbm9yZSBlbmQqL2RpZmZKc29uID0gZGlmZkpzb247XG4vKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovZXhwb3J0cy4gLyppc3RhbmJ1bCBpZ25vcmUgZW5kKi9jYW5vbmljYWxpemUgPSBjYW5vbmljYWxpemU7XG5cbnZhciAvKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovX2Jhc2UgPSByZXF1aXJlKCcuL2Jhc2UnKSAvKmlzdGFuYnVsIGlnbm9yZSBlbmQqLztcblxuLyppc3RhbmJ1bCBpZ25vcmUgc3RhcnQqL1xudmFyIF9iYXNlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2Jhc2UpO1xuXG4vKmlzdGFuYnVsIGlnbm9yZSBlbmQqL1xudmFyIC8qaXN0YW5idWwgaWdub3JlIHN0YXJ0Ki9fbGluZSA9IHJlcXVpcmUoJy4vbGluZScpIC8qaXN0YW5idWwgaWdub3JlIGVuZCovO1xuXG4vKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG4vKmlzdGFuYnVsIGlnbm9yZSBlbmQqL1xuXG52YXIgb2JqZWN0UHJvdG90eXBlVG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nO1xuXG52YXIganNvbkRpZmYgPSAvKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovZXhwb3J0cy4gLyppc3RhbmJ1bCBpZ25vcmUgZW5kKi9qc29uRGlmZiA9IG5ldyAvKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovX2Jhc2UyLmRlZmF1bHQoKSAvKmlzdGFuYnVsIGlnbm9yZSBlbmQqLztcbi8vIERpc2NyaW1pbmF0ZSBiZXR3ZWVuIHR3byBsaW5lcyBvZiBwcmV0dHktcHJpbnRlZCwgc2VyaWFsaXplZCBKU09OIHdoZXJlIG9uZSBvZiB0aGVtIGhhcyBhXG4vLyBkYW5nbGluZyBjb21tYSBhbmQgdGhlIG90aGVyIGRvZXNuJ3QuIFR1cm5zIG91dCBpbmNsdWRpbmcgdGhlIGRhbmdsaW5nIGNvbW1hIHlpZWxkcyB0aGUgbmljZXN0IG91dHB1dDpcbmpzb25EaWZmLnVzZUxvbmdlc3RUb2tlbiA9IHRydWU7XG5cbmpzb25EaWZmLnRva2VuaXplID0gLyppc3RhbmJ1bCBpZ25vcmUgc3RhcnQqL19saW5lLmxpbmVEaWZmLiAvKmlzdGFuYnVsIGlnbm9yZSBlbmQqL3Rva2VuaXplO1xuanNvbkRpZmYuY2FzdElucHV0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gdmFsdWUgOiBKU09OLnN0cmluZ2lmeShjYW5vbmljYWxpemUodmFsdWUpLCB1bmRlZmluZWQsICcgICcpO1xufTtcbmpzb25EaWZmLmVxdWFscyA9IGZ1bmN0aW9uIChsZWZ0LCByaWdodCkge1xuICByZXR1cm4gKC8qaXN0YW5idWwgaWdub3JlIHN0YXJ0Ki9fYmFzZTIuZGVmYXVsdC4gLyppc3RhbmJ1bCBpZ25vcmUgZW5kKi9wcm90b3R5cGUuZXF1YWxzKGxlZnQucmVwbGFjZSgvLChbXFxyXFxuXSkvZywgJyQxJyksIHJpZ2h0LnJlcGxhY2UoLywoW1xcclxcbl0pL2csICckMScpKVxuICApO1xufTtcblxuZnVuY3Rpb24gZGlmZkpzb24ob2xkT2JqLCBuZXdPYmosIGNhbGxiYWNrKSB7XG4gIHJldHVybiBqc29uRGlmZi5kaWZmKG9sZE9iaiwgbmV3T2JqLCBjYWxsYmFjayk7XG59XG5cbi8vIFRoaXMgZnVuY3Rpb24gaGFuZGxlcyB0aGUgcHJlc2VuY2Ugb2YgY2lyY3VsYXIgcmVmZXJlbmNlcyBieSBiYWlsaW5nIG91dCB3aGVuIGVuY291bnRlcmluZyBhblxuLy8gb2JqZWN0IHRoYXQgaXMgYWxyZWFkeSBvbiB0aGUgXCJzdGFja1wiIG9mIGl0ZW1zIGJlaW5nIHByb2Nlc3NlZC5cbmZ1bmN0aW9uIGNhbm9uaWNhbGl6ZShvYmosIHN0YWNrLCByZXBsYWNlbWVudFN0YWNrKSB7XG4gIHN0YWNrID0gc3RhY2sgfHwgW107XG4gIHJlcGxhY2VtZW50U3RhY2sgPSByZXBsYWNlbWVudFN0YWNrIHx8IFtdO1xuXG4gIHZhciBpID0gLyppc3RhbmJ1bCBpZ25vcmUgc3RhcnQqL3ZvaWQgMCAvKmlzdGFuYnVsIGlnbm9yZSBlbmQqLztcblxuICBmb3IgKGkgPSAwOyBpIDwgc3RhY2subGVuZ3RoOyBpICs9IDEpIHtcbiAgICBpZiAoc3RhY2tbaV0gPT09IG9iaikge1xuICAgICAgcmV0dXJuIHJlcGxhY2VtZW50U3RhY2tbaV07XG4gICAgfVxuICB9XG5cbiAgdmFyIGNhbm9uaWNhbGl6ZWRPYmogPSAvKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovdm9pZCAwIC8qaXN0YW5idWwgaWdub3JlIGVuZCovO1xuXG4gIGlmICgnW29iamVjdCBBcnJheV0nID09PSBvYmplY3RQcm90b3R5cGVUb1N0cmluZy5jYWxsKG9iaikpIHtcbiAgICBzdGFjay5wdXNoKG9iaik7XG4gICAgY2Fub25pY2FsaXplZE9iaiA9IG5ldyBBcnJheShvYmoubGVuZ3RoKTtcbiAgICByZXBsYWNlbWVudFN0YWNrLnB1c2goY2Fub25pY2FsaXplZE9iaik7XG4gICAgZm9yIChpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgY2Fub25pY2FsaXplZE9ialtpXSA9IGNhbm9uaWNhbGl6ZShvYmpbaV0sIHN0YWNrLCByZXBsYWNlbWVudFN0YWNrKTtcbiAgICB9XG4gICAgc3RhY2sucG9wKCk7XG4gICAgcmVwbGFjZW1lbnRTdGFjay5wb3AoKTtcbiAgICByZXR1cm4gY2Fub25pY2FsaXplZE9iajtcbiAgfVxuXG4gIGlmIChvYmogJiYgb2JqLnRvSlNPTikge1xuICAgIG9iaiA9IG9iai50b0pTT04oKTtcbiAgfVxuXG4gIGlmICggLyppc3RhbmJ1bCBpZ25vcmUgc3RhcnQqLyh0eXBlb2YgLyppc3RhbmJ1bCBpZ25vcmUgZW5kKi9vYmogPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG9iaikpID09PSAnb2JqZWN0JyAmJiBvYmogIT09IG51bGwpIHtcbiAgICBzdGFjay5wdXNoKG9iaik7XG4gICAgY2Fub25pY2FsaXplZE9iaiA9IHt9O1xuICAgIHJlcGxhY2VtZW50U3RhY2sucHVzaChjYW5vbmljYWxpemVkT2JqKTtcbiAgICB2YXIgc29ydGVkS2V5cyA9IFtdLFxuICAgICAgICBrZXkgPSAvKmlzdGFuYnVsIGlnbm9yZSBzdGFydCovdm9pZCAwIC8qaXN0YW5idWwgaWdub3JlIGVuZCovO1xuICAgIGZvciAoa2V5IGluIG9iaikge1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICBzb3J0ZWRLZXlzLnB1c2goa2V5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgc29ydGVkS2V5cy5zb3J0KCk7XG4gICAgZm9yIChpID0gMDsgaSA8IHNvcnRlZEtleXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGtleSA9IHNvcnRlZEtleXNbaV07XG4gICAgICBjYW5vbmljYWxpemVkT2JqW2tleV0gPSBjYW5vbmljYWxpemUob2JqW2tleV0sIHN0YWNrLCByZXBsYWNlbWVudFN0YWNrKTtcbiAgICB9XG4gICAgc3RhY2sucG9wKCk7XG4gICAgcmVwbGFjZW1lbnRTdGFjay5wb3AoKTtcbiAgfSBlbHNlIHtcbiAgICBjYW5vbmljYWxpemVkT2JqID0gb2JqO1xuICB9XG4gIHJldHVybiBjYW5vbmljYWxpemVkT2JqO1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZGF0YTphcHBsaWNhdGlvbi9qc29uO2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKemIzVnlZMlZ6SWpwYklpNHVMeTR1TDNOeVl5OWthV1ptTDJwemIyNHVhbk1pWFN3aWJtRnRaWE1pT2x0ZExDSnRZWEJ3YVc1bmN5STZJanM3T3pzN096dG5RMEZ0UW1kQ08zbEVRVXRCT3p0QlFYaENhRUk3T3pzN096dEJRVU5CT3pzN096czdPMEZCUlVFc1NVRkJUU3d3UWtGQk1FSXNUMEZCVHl4VFFVRlFMRU5CUVdsQ0xGRkJRV3BDT3p0QlFVZDZRaXhKUVVGTkxDdEZRVUZYTEhGRlFVRllPenM3UVVGSFlpeFRRVUZUTEdWQlFWUXNSMEZCTWtJc1NVRkJNMEk3TzBGQlJVRXNVMEZCVXl4UlFVRlVMRWRCUVc5Q0xHZEZRVUZUTEZGQlFWUTdRVUZEY0VJc1UwRkJVeXhUUVVGVUxFZEJRWEZDTEZWQlFWTXNTMEZCVkN4RlFVRm5RanRCUVVOdVF5eFRRVUZQTEU5QlFVOHNTMEZCVUN4TFFVRnBRaXhSUVVGcVFpeEhRVUUwUWl4TFFVRTFRaXhIUVVGdlF5eExRVUZMTEZOQlFVd3NRMEZCWlN4aFFVRmhMRXRCUVdJc1EwRkJaaXhGUVVGdlF5eFRRVUZ3UXl4RlFVRXJReXhKUVVFdlF5eERRVUZ3UXl4RFFVUTBRanREUVVGb1FqdEJRVWR5UWl4VFFVRlRMRTFCUVZRc1IwRkJhMElzVlVGQlV5eEpRVUZVTEVWQlFXVXNTMEZCWml4RlFVRnpRanRCUVVOMFF5eFRRVUZQTEdsRlFVRkxMRk5CUVV3c1EwRkJaU3hOUVVGbUxFTkJRWE5DTEV0QlFVc3NUMEZCVEN4RFFVRmhMRmxCUVdJc1JVRkJNa0lzU1VGQk0wSXNRMEZCZEVJc1JVRkJkMFFzVFVGQlRTeFBRVUZPTEVOQlFXTXNXVUZCWkN4RlFVRTBRaXhKUVVFMVFpeERRVUY0UkN4RFFVRlFPMGxCUkhORE8wTkJRWFJDT3p0QlFVbFlMRk5CUVZNc1VVRkJWQ3hEUVVGclFpeE5RVUZzUWl4RlFVRXdRaXhOUVVFeFFpeEZRVUZyUXl4UlFVRnNReXhGUVVFMFF6dEJRVUZGTEZOQlFVOHNVMEZCVXl4SlFVRlVMRU5CUVdNc1RVRkJaQ3hGUVVGelFpeE5RVUYwUWl4RlFVRTRRaXhSUVVFNVFpeERRVUZRTEVOQlFVWTdRMEZCTlVNN096czdRVUZMUVN4VFFVRlRMRmxCUVZRc1EwRkJjMElzUjBGQmRFSXNSVUZCTWtJc1MwRkJNMElzUlVGQmEwTXNaMEpCUVd4RExFVkJRVzlFTzBGQlEzcEVMRlZCUVZFc1UwRkJVeXhGUVVGVUxFTkJSR2xFTzBGQlJYcEVMSEZDUVVGdFFpeHZRa0ZCYjBJc1JVRkJjRUlzUTBGR2MwTTdPMEZCU1hwRUxFMUJRVWtzTWtSQlFVb3NRMEZLZVVRN08wRkJUWHBFTEU5QlFVc3NTVUZCU1N4RFFVRktMRVZCUVU4c1NVRkJTU3hOUVVGTkxFMUJRVTRzUlVGQll5eExRVUZMTEVOQlFVd3NSVUZCVVR0QlFVTndReXhSUVVGSkxFMUJRVTBzUTBGQlRpeE5RVUZoTEVkQlFXSXNSVUZCYTBJN1FVRkRjRUlzWVVGQlR5eHBRa0ZCYVVJc1EwRkJha0lzUTBGQlVDeERRVVJ2UWp0TFFVRjBRanRIUVVSR096dEJRVTFCTEUxQlFVa3NNRVZCUVVvc1EwRmFlVVE3TzBGQlkzcEVMRTFCUVVrc2NVSkJRWEZDTEhkQ1FVRjNRaXhKUVVGNFFpeERRVUUyUWl4SFFVRTNRaXhEUVVGeVFpeEZRVUYzUkR0QlFVTXhSQ3hWUVVGTkxFbEJRVTRzUTBGQlZ5eEhRVUZZTEVWQlJEQkVPMEZCUlRGRUxIVkNRVUZ0UWl4SlFVRkpMRXRCUVVvc1EwRkJWU3hKUVVGSkxFMUJRVW9zUTBGQk4wSXNRMEZHTUVRN1FVRkhNVVFzY1VKQlFXbENMRWxCUVdwQ0xFTkJRWE5DTEdkQ1FVRjBRaXhGUVVnd1JEdEJRVWt4UkN4VFFVRkxMRWxCUVVrc1EwRkJTaXhGUVVGUExFbEJRVWtzU1VGQlNTeE5RVUZLTEVWQlFWa3NTMEZCU3l4RFFVRk1MRVZCUVZFN1FVRkRiRU1zZFVKQlFXbENMRU5CUVdwQ0xFbEJRWE5DTEdGQlFXRXNTVUZCU1N4RFFVRktMRU5CUVdJc1JVRkJjVUlzUzBGQmNrSXNSVUZCTkVJc1owSkJRVFZDTEVOQlFYUkNMRU5CUkd0RE8wdEJRWEJETzBGQlIwRXNWVUZCVFN4SFFVRk9MRWRCVURCRU8wRkJVVEZFTEhGQ1FVRnBRaXhIUVVGcVFpeEhRVkl3UkR0QlFWTXhSQ3hYUVVGUExHZENRVUZRTEVOQlZEQkVPMGRCUVRWRU96dEJRVmxCTEUxQlFVa3NUMEZCVHl4SlFVRkpMRTFCUVVvc1JVRkJXVHRCUVVOeVFpeFZRVUZOTEVsQlFVa3NUVUZCU2l4RlFVRk9MRU5CUkhGQ08wZEJRWFpDT3p0QlFVbEJMRTFCUVVrc2VVUkJRVThzYVVSQlFWQXNTMEZCWlN4UlFVRm1MRWxCUVRKQ0xGRkJRVkVzU1VGQlVpeEZRVUZqTzBGQlF6TkRMRlZCUVUwc1NVRkJUaXhEUVVGWExFZEJRVmdzUlVGRU1rTTdRVUZGTTBNc2RVSkJRVzFDTEVWQlFXNUNMRU5CUmpKRE8wRkJSek5ETEhGQ1FVRnBRaXhKUVVGcVFpeERRVUZ6UWl4blFrRkJkRUlzUlVGSU1rTTdRVUZKTTBNc1VVRkJTU3hoUVVGaExFVkJRV0k3VVVGRFFTdzJSRUZFU2l4RFFVb3lRenRCUVUwelF5eFRRVUZMTEVkQlFVd3NTVUZCV1N4SFFVRmFMRVZCUVdsQ096dEJRVVZtTEZWQlFVa3NTVUZCU1N4alFVRktMRU5CUVcxQ0xFZEJRVzVDTEVOQlFVb3NSVUZCTmtJN1FVRkRNMElzYlVKQlFWY3NTVUZCV0N4RFFVRm5RaXhIUVVGb1FpeEZRVVF5UWp0UFFVRTNRanRMUVVaR08wRkJUVUVzWlVGQlZ5eEpRVUZZTEVkQldqSkRPMEZCWVRORExGTkJRVXNzU1VGQlNTeERRVUZLTEVWQlFVOHNTVUZCU1N4WFFVRlhMRTFCUVZnc1JVRkJiVUlzUzBGQlN5eERRVUZNTEVWQlFWRTdRVUZEZWtNc1dVRkJUU3hYUVVGWExFTkJRVmdzUTBGQlRpeERRVVI1UXp0QlFVVjZReXgxUWtGQmFVSXNSMEZCYWtJc1NVRkJkMElzWVVGQllTeEpRVUZKTEVkQlFVb3NRMEZCWWl4RlFVRjFRaXhMUVVGMlFpeEZRVUU0UWl4blFrRkJPVUlzUTBGQmVFSXNRMEZHZVVNN1MwRkJNME03UVVGSlFTeFZRVUZOTEVkQlFVNHNSMEZxUWpKRE8wRkJhMEl6UXl4eFFrRkJhVUlzUjBGQmFrSXNSMEZzUWpKRE8wZEJRVGRETEUxQmJVSlBPMEZCUTB3c2RVSkJRVzFDTEVkQlFXNUNMRU5CUkVzN1IwRnVRbEE3UVVGelFrRXNVMEZCVHl4blFrRkJVQ3hEUVhCRWVVUTdRMEZCY0VRaUxDSm1hV3hsSWpvaWFuTnZiaTVxY3lJc0luTnZkWEpqWlhORGIyNTBaVzUwSWpwYkltbHRjRzl5ZENCRWFXWm1JR1p5YjIwZ0p5NHZZbUZ6WlNjN1hHNXBiWEJ2Y25RZ2UyeHBibVZFYVdabWZTQm1jbTl0SUNjdUwyeHBibVVuTzF4dVhHNWpiMjV6ZENCdlltcGxZM1JRY205MGIzUjVjR1ZVYjFOMGNtbHVaeUE5SUU5aWFtVmpkQzV3Y205MGIzUjVjR1V1ZEc5VGRISnBibWM3WEc1Y2JseHVaWGh3YjNKMElHTnZibk4wSUdwemIyNUVhV1ptSUQwZ2JtVjNJRVJwWm1Zb0tUdGNiaTh2SUVScGMyTnlhVzFwYm1GMFpTQmlaWFIzWldWdUlIUjNieUJzYVc1bGN5QnZaaUJ3Y21WMGRIa3RjSEpwYm5SbFpDd2djMlZ5YVdGc2FYcGxaQ0JLVTA5T0lIZG9aWEpsSUc5dVpTQnZaaUIwYUdWdElHaGhjeUJoWEc0dkx5QmtZVzVuYkdsdVp5QmpiMjF0WVNCaGJtUWdkR2hsSUc5MGFHVnlJR1J2WlhOdUozUXVJRlIxY201eklHOTFkQ0JwYm1Oc2RXUnBibWNnZEdobElHUmhibWRzYVc1bklHTnZiVzFoSUhscFpXeGtjeUIwYUdVZ2JtbGpaWE4wSUc5MWRIQjFkRHBjYm1wemIyNUVhV1ptTG5WelpVeHZibWRsYzNSVWIydGxiaUE5SUhSeWRXVTdYRzVjYm1wemIyNUVhV1ptTG5SdmEyVnVhWHBsSUQwZ2JHbHVaVVJwWm1ZdWRHOXJaVzVwZW1VN1hHNXFjMjl1UkdsbVppNWpZWE4wU1c1d2RYUWdQU0JtZFc1amRHbHZiaWgyWVd4MVpTa2dlMXh1SUNCeVpYUjFjbTRnZEhsd1pXOW1JSFpoYkhWbElEMDlQU0FuYzNSeWFXNW5KeUEvSUhaaGJIVmxJRG9nU2xOUFRpNXpkSEpwYm1kcFpua29ZMkZ1YjI1cFkyRnNhWHBsS0haaGJIVmxLU3dnZFc1a1pXWnBibVZrTENBbklDQW5LVHRjYm4wN1hHNXFjMjl1UkdsbVppNWxjWFZoYkhNZ1BTQm1kVzVqZEdsdmJpaHNaV1owTENCeWFXZG9kQ2tnZTF4dUlDQnlaWFIxY200Z1JHbG1aaTV3Y205MGIzUjVjR1V1WlhGMVlXeHpLR3hsWm5RdWNtVndiR0ZqWlNndkxDaGJYRnh5WEZ4dVhTa3ZaeXdnSnlReEp5a3NJSEpwWjJoMExuSmxjR3hoWTJVb0x5d29XMXhjY2x4Y2JsMHBMMmNzSUNja01TY3BLVHRjYm4wN1hHNWNibVY0Y0c5eWRDQm1kVzVqZEdsdmJpQmthV1ptU25OdmJpaHZiR1JQWW1vc0lHNWxkMDlpYWl3Z1kyRnNiR0poWTJzcElIc2djbVYwZFhKdUlHcHpiMjVFYVdabUxtUnBabVlvYjJ4a1QySnFMQ0J1WlhkUFltb3NJR05oYkd4aVlXTnJLVHNnZlZ4dVhHNWNiaTh2SUZSb2FYTWdablZ1WTNScGIyNGdhR0Z1Wkd4bGN5QjBhR1VnY0hKbGMyVnVZMlVnYjJZZ1kybHlZM1ZzWVhJZ2NtVm1aWEpsYm1ObGN5QmllU0JpWVdsc2FXNW5JRzkxZENCM2FHVnVJR1Z1WTI5MWJuUmxjbWx1WnlCaGJseHVMeThnYjJKcVpXTjBJSFJvWVhRZ2FYTWdZV3h5WldGa2VTQnZiaUIwYUdVZ1hDSnpkR0ZqYTF3aUlHOW1JR2wwWlcxeklHSmxhVzVuSUhCeWIyTmxjM05sWkM1Y2JtVjRjRzl5ZENCbWRXNWpkR2x2YmlCallXNXZibWxqWVd4cGVtVW9iMkpxTENCemRHRmpheXdnY21Wd2JHRmpaVzFsYm5SVGRHRmpheWtnZTF4dUlDQnpkR0ZqYXlBOUlITjBZV05ySUh4OElGdGRPMXh1SUNCeVpYQnNZV05sYldWdWRGTjBZV05ySUQwZ2NtVndiR0ZqWlcxbGJuUlRkR0ZqYXlCOGZDQmJYVHRjYmx4dUlDQnNaWFFnYVR0Y2JseHVJQ0JtYjNJZ0tHa2dQU0F3T3lCcElEd2djM1JoWTJzdWJHVnVaM1JvT3lCcElDczlJREVwSUh0Y2JpQWdJQ0JwWmlBb2MzUmhZMnRiYVYwZ1BUMDlJRzlpYWlrZ2UxeHVJQ0FnSUNBZ2NtVjBkWEp1SUhKbGNHeGhZMlZ0Wlc1MFUzUmhZMnRiYVYwN1hHNGdJQ0FnZlZ4dUlDQjlYRzVjYmlBZ2JHVjBJR05oYm05dWFXTmhiR2w2WldSUFltbzdYRzVjYmlBZ2FXWWdLQ2RiYjJKcVpXTjBJRUZ5Y21GNVhTY2dQVDA5SUc5aWFtVmpkRkJ5YjNSdmRIbHdaVlJ2VTNSeWFXNW5MbU5oYkd3b2IySnFLU2tnZTF4dUlDQWdJSE4wWVdOckxuQjFjMmdvYjJKcUtUdGNiaUFnSUNCallXNXZibWxqWVd4cGVtVmtUMkpxSUQwZ2JtVjNJRUZ5Y21GNUtHOWlhaTVzWlc1bmRHZ3BPMXh1SUNBZ0lISmxjR3hoWTJWdFpXNTBVM1JoWTJzdWNIVnphQ2hqWVc1dmJtbGpZV3hwZW1Wa1QySnFLVHRjYmlBZ0lDQm1iM0lnS0drZ1BTQXdPeUJwSUR3Z2IySnFMbXhsYm1kMGFEc2dhU0FyUFNBeEtTQjdYRzRnSUNBZ0lDQmpZVzV2Ym1sallXeHBlbVZrVDJKcVcybGRJRDBnWTJGdWIyNXBZMkZzYVhwbEtHOWlhbHRwWFN3Z2MzUmhZMnNzSUhKbGNHeGhZMlZ0Wlc1MFUzUmhZMnNwTzF4dUlDQWdJSDFjYmlBZ0lDQnpkR0ZqYXk1d2IzQW9LVHRjYmlBZ0lDQnlaWEJzWVdObGJXVnVkRk4wWVdOckxuQnZjQ2dwTzF4dUlDQWdJSEpsZEhWeWJpQmpZVzV2Ym1sallXeHBlbVZrVDJKcU8xeHVJQ0I5WEc1Y2JpQWdhV1lnS0c5aWFpQW1KaUJ2WW1vdWRHOUtVMDlPS1NCN1hHNGdJQ0FnYjJKcUlEMGdiMkpxTG5SdlNsTlBUaWdwTzF4dUlDQjlYRzVjYmlBZ2FXWWdLSFI1Y0dWdlppQnZZbW9nUFQwOUlDZHZZbXBsWTNRbklDWW1JRzlpYWlBaFBUMGdiblZzYkNrZ2UxeHVJQ0FnSUhOMFlXTnJMbkIxYzJnb2IySnFLVHRjYmlBZ0lDQmpZVzV2Ym1sallXeHBlbVZrVDJKcUlEMGdlMzA3WEc0Z0lDQWdjbVZ3YkdGalpXMWxiblJUZEdGamF5NXdkWE5vS0dOaGJtOXVhV05oYkdsNlpXUlBZbW9wTzF4dUlDQWdJR3hsZENCemIzSjBaV1JMWlhseklEMGdXMTBzWEc0Z0lDQWdJQ0FnSUd0bGVUdGNiaUFnSUNCbWIzSWdLR3RsZVNCcGJpQnZZbW9wSUh0Y2JpQWdJQ0FnSUM4cUlHbHpkR0Z1WW5Wc0lHbG5ibTl5WlNCbGJITmxJQ292WEc0Z0lDQWdJQ0JwWmlBb2IySnFMbWhoYzA5M2JsQnliM0JsY25SNUtHdGxlU2twSUh0Y2JpQWdJQ0FnSUNBZ2MyOXlkR1ZrUzJWNWN5NXdkWE5vS0d0bGVTazdYRzRnSUNBZ0lDQjlYRzRnSUNBZ2ZWeHVJQ0FnSUhOdmNuUmxaRXRsZVhNdWMyOXlkQ2dwTzF4dUlDQWdJR1p2Y2lBb2FTQTlJREE3SUdrZ1BDQnpiM0owWldSTFpYbHpMbXhsYm1kMGFEc2dhU0FyUFNBeEtTQjdYRzRnSUNBZ0lDQnJaWGtnUFNCemIzSjBaV1JMWlhselcybGRPMXh1SUNBZ0lDQWdZMkZ1YjI1cFkyRnNhWHBsWkU5aWFsdHJaWGxkSUQwZ1kyRnViMjVwWTJGc2FYcGxLRzlpYWx0clpYbGRMQ0J6ZEdGamF5d2djbVZ3YkdGalpXMWxiblJUZEdGamF5azdYRzRnSUNBZ2ZWeHVJQ0FnSUhOMFlXTnJMbkJ2Y0NncE8xeHVJQ0FnSUhKbGNHeGhZMlZ0Wlc1MFUzUmhZMnN1Y0c5d0tDazdYRzRnSUgwZ1pXeHpaU0I3WEc0Z0lDQWdZMkZ1YjI1cFkyRnNhWHBsWkU5aWFpQTlJRzlpYWp0Y2JpQWdmVnh1SUNCeVpYUjFjbTRnWTJGdWIyNXBZMkZzYVhwbFpFOWlhanRjYm4xY2JpSmRmUT09XG4iXX0=