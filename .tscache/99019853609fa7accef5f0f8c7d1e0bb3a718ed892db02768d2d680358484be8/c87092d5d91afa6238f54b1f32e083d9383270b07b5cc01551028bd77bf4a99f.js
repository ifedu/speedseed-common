'use strict';
var events = require('events');
var path = require('path');
var util = require('util');
var vinylFile = require('vinyl-file');
var File = require('vinyl');
var through = require('through2');
exports.create = function () {
    var store = {};
    function load(filepath) {
        var file;
        try {
            file = vinylFile.readSync(filepath);
        }
        catch (err) {
            file = new File({
                cwd: process.cwd(),
                base: process.cwd(),
                path: filepath,
                contents: null
            });
        }
        store[filepath] = file;
        return file;
    }
    var Store = function () {
        events.EventEmitter.apply(this, arguments);
    };
    util.inherits(Store, events.EventEmitter);
    Store.prototype.get = function (filepath) {
        filepath = path.resolve(filepath);
        return store[filepath] || load(filepath);
    };
    Store.prototype.add = function (file) {
        store[file.path] = file;
        this.emit('change');
        return this;
    };
    Store.prototype.each = function (onEach) {
        Object.keys(store).forEach(function (key, index) {
            onEach(store[key], index);
        });
        return this;
    };
    Store.prototype.stream = function () {
        var stream = through.obj();
        setImmediate(function () {
            this.each(stream.write.bind(stream));
            stream.end();
        }.bind(this));
        return stream;
    };
    return new Store();
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxtZW0tZnNcXGluZGV4LmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGlmZWR1XFxBcHBEYXRhXFxSb2FtaW5nXFxudm1cXHY4LjQuMFxcbm9kZV9tb2R1bGVzXFxnZW5lcmF0b3Itc3BlZWRzZWVkXFxub2RlX21vZHVsZXNcXG1lbS1mc1xcaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBQ2IsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9CLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDM0IsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3RDLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM1QixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFbEMsT0FBTyxDQUFDLE1BQU0sR0FBRztJQUNmLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUVmLGNBQWMsUUFBUTtRQUNwQixJQUFJLElBQUksQ0FBQztRQUNULElBQUksQ0FBQztZQUNILElBQUksR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RDLENBQUM7UUFBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDO2dCQUNkLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRyxFQUFFO2dCQUNsQixJQUFJLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRTtnQkFDbkIsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7UUFDTCxDQUFDO1FBQ0QsS0FBSyxDQUFDLFFBQVEsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELElBQUksS0FBSyxHQUFHO1FBQ1YsTUFBTSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQztJQUNGLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUxQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxVQUFVLFFBQVE7UUFDdEMsUUFBUSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDO0lBRUYsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsVUFBVSxJQUFJO1FBQ2xDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQztJQUVGLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxHQUFHLFVBQVUsTUFBTTtRQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsRUFBRSxLQUFLO1lBQzdDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDNUIsQ0FBQyxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO0lBRUYsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUc7UUFDdkIsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzNCLFlBQVksQ0FBQztZQUNYLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNyQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDZixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDZCxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2hCLENBQUMsQ0FBQztJQUVGLE1BQU0sQ0FBQyxJQUFJLEtBQUssRUFBRSxDQUFDO0FBQ3JCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbnZhciBldmVudHMgPSByZXF1aXJlKCdldmVudHMnKTtcbnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xudmFyIHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG52YXIgdmlueWxGaWxlID0gcmVxdWlyZSgndmlueWwtZmlsZScpO1xudmFyIEZpbGUgPSByZXF1aXJlKCd2aW55bCcpO1xudmFyIHRocm91Z2ggPSByZXF1aXJlKCd0aHJvdWdoMicpO1xuXG5leHBvcnRzLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHN0b3JlID0ge307XG5cbiAgZnVuY3Rpb24gbG9hZChmaWxlcGF0aCkge1xuICAgIHZhciBmaWxlO1xuICAgIHRyeSB7XG4gICAgICBmaWxlID0gdmlueWxGaWxlLnJlYWRTeW5jKGZpbGVwYXRoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGZpbGUgPSBuZXcgRmlsZSh7XG4gICAgICAgIGN3ZDogcHJvY2Vzcy5jd2QoKSxcbiAgICAgICAgYmFzZTogcHJvY2Vzcy5jd2QoKSxcbiAgICAgICAgcGF0aDogZmlsZXBhdGgsXG4gICAgICAgIGNvbnRlbnRzOiBudWxsXG4gICAgICB9KTtcbiAgICB9XG4gICAgc3RvcmVbZmlsZXBhdGhdID0gZmlsZTtcbiAgICByZXR1cm4gZmlsZTtcbiAgfVxuXG4gIHZhciBTdG9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBldmVudHMuRXZlbnRFbWl0dGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH07XG4gIHV0aWwuaW5oZXJpdHMoU3RvcmUsIGV2ZW50cy5FdmVudEVtaXR0ZXIpO1xuXG4gIFN0b3JlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoZmlsZXBhdGgpIHtcbiAgICBmaWxlcGF0aCA9IHBhdGgucmVzb2x2ZShmaWxlcGF0aCk7XG4gICAgcmV0dXJuIHN0b3JlW2ZpbGVwYXRoXSB8fCBsb2FkKGZpbGVwYXRoKTtcbiAgfTtcblxuICBTdG9yZS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKGZpbGUpIHtcbiAgICBzdG9yZVtmaWxlLnBhdGhdID0gZmlsZTtcbiAgICB0aGlzLmVtaXQoJ2NoYW5nZScpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFN0b3JlLnByb3RvdHlwZS5lYWNoID0gZnVuY3Rpb24gKG9uRWFjaCkge1xuICAgIE9iamVjdC5rZXlzKHN0b3JlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIGluZGV4KSB7XG4gICAgICBvbkVhY2goc3RvcmVba2V5XSwgaW5kZXgpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIFN0b3JlLnByb3RvdHlwZS5zdHJlYW0gPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHN0cmVhbSA9IHRocm91Z2gub2JqKCk7XG4gICAgc2V0SW1tZWRpYXRlKGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZWFjaChzdHJlYW0ud3JpdGUuYmluZChzdHJlYW0pKTtcbiAgICAgIHN0cmVhbS5lbmQoKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICAgIHJldHVybiBzdHJlYW07XG4gIH07XG5cbiAgcmV0dXJuIG5ldyBTdG9yZSgpO1xufTtcbiJdfQ==