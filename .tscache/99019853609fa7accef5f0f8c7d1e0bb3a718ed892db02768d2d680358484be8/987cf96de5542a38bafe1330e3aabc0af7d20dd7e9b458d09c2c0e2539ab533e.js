'use strict';
var path = require('path');
var fs = require('fs');
var _ = require('lodash');
var table = require('text-table');
var pathExists = require('path-exists');
/**
 * @mixin
 * @alias actions/help
 */
var help = module.exports;
/**
 * Tries to get the description from a USAGE file one folder above the
 * source root otherwise uses a default description.
 */
help.help = function () {
    var filepath = path.join(this.sourceRoot(), '../USAGE');
    var exists = pathExists.sync(filepath);
    var out = [
        'Usage:',
        '  ' + this.usage(),
        ''
    ];
    // Build options
    if (Object.keys(this._options).length > 0) {
        out = out.concat([
            'Options:',
            this.optionsHelp(),
            ''
        ]);
    }
    // Build arguments
    if (this._arguments.length > 0) {
        out = out.concat([
            'Arguments:',
            this.argumentsHelp(),
            ''
        ]);
    }
    // Append USAGE file is any
    if (exists) {
        out.push(fs.readFileSync(filepath, 'utf8'));
    }
    return out.join('\n');
};
function formatArg(config) {
    var arg = '<' + config.name + '>';
    if (!config.required) {
        arg = '[' + arg + ']';
    }
    return arg;
}
/**
 * Output usage information for this given generator, depending on its arguments
 * or options.
 */
help.usage = function () {
    var options = Object.keys(this._options).length ? '[options]' : '';
    var name = ' ' + this.options.namespace;
    var args = '';
    if (this._arguments.length > 0) {
        args = this._arguments.map(formatArg).join(' ');
    }
    name = name.replace(/^yeoman:/, '');
    var out = 'yo' + name + ' ' + options + ' ' + args;
    if (this.description) {
        out += '\n\n' + this.description;
    }
    return out;
};
/**
 * Simple setter for custom `description` to append on help output.
 *
 * @param {String} description
 */
help.desc = function (description) {
    this.description = description || '';
    return this;
};
/**
 * Get help text for arguments
 * @returns {String} Text of options in formatted table
 */
help.argumentsHelp = function () {
    var rows = this._arguments.map(function (config) {
        return [
            '',
            config.name ? config.name : '',
            config.description ? '# ' + config.description : '',
            config.type ? 'Type: ' + config.type.name : '',
            'Required: ' + config.required
        ];
    });
    return table(rows);
};
/**
 * Get help text for options
 * @returns {String} Text of options in formatted table
 */
help.optionsHelp = function () {
    var options = _.reject(this._options, function (el) {
        return el.hide;
    });
    var rows = options.map(function (opt) {
        return [
            '',
            opt.alias ? '-' + opt.alias + ', ' : '',
            '--' + opt.name,
            opt.description ? '# ' + opt.description : '',
            (opt.default !== undefined && opt.default !== null && opt.default !== '') ? 'Default: ' + opt.default : ''
        ];
    });
    return table(rows);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFx5ZW9tYW4tZ2VuZXJhdG9yXFxsaWJcXGFjdGlvbnNcXGhlbHAuanMiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcaWZlZHVcXEFwcERhdGFcXFJvYW1pbmdcXG52bVxcdjguNC4wXFxub2RlX21vZHVsZXNcXGdlbmVyYXRvci1zcGVlZHNlZWRcXG5vZGVfbW9kdWxlc1xceWVvbWFuLWdlbmVyYXRvclxcbGliXFxhY3Rpb25zXFxoZWxwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUNiLElBQUksSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMzQixJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdkIsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzFCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztBQUNsQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7QUFFeEM7OztHQUdHO0FBQ0gsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUUxQjs7O0dBR0c7QUFFSCxJQUFJLENBQUMsSUFBSSxHQUFHO0lBQ1YsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDeEQsSUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2QyxJQUFJLEdBQUcsR0FBRztRQUNSLFFBQVE7UUFDUixJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNuQixFQUFFO0tBQ0gsQ0FBQztJQUVGLGdC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c291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG52YXIgZnMgPSByZXF1aXJlKCdmcycpO1xudmFyIF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbnZhciB0YWJsZSA9IHJlcXVpcmUoJ3RleHQtdGFibGUnKTtcbnZhciBwYXRoRXhpc3RzID0gcmVxdWlyZSgncGF0aC1leGlzdHMnKTtcblxuLyoqXG4gKiBAbWl4aW5cbiAqIEBhbGlhcyBhY3Rpb25zL2hlbHBcbiAqL1xudmFyIGhlbHAgPSBtb2R1bGUuZXhwb3J0cztcblxuLyoqXG4gKiBUcmllcyB0byBnZXQgdGhlIGRlc2NyaXB0aW9uIGZyb20gYSBVU0FHRSBmaWxlIG9uZSBmb2xkZXIgYWJvdmUgdGhlXG4gKiBzb3VyY2Ugcm9vdCBvdGhlcndpc2UgdXNlcyBhIGRlZmF1bHQgZGVzY3JpcHRpb24uXG4gKi9cblxuaGVscC5oZWxwID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZmlsZXBhdGggPSBwYXRoLmpvaW4odGhpcy5zb3VyY2VSb290KCksICcuLi9VU0FHRScpO1xuICB2YXIgZXhpc3RzID0gcGF0aEV4aXN0cy5zeW5jKGZpbGVwYXRoKTtcbiAgdmFyIG91dCA9IFtcbiAgICAnVXNhZ2U6JyxcbiAgICAnICAnICsgdGhpcy51c2FnZSgpLFxuICAgICcnXG4gIF07XG5cbiAgLy8gQnVpbGQgb3B0aW9uc1xuICBpZiAoT2JqZWN0LmtleXModGhpcy5fb3B0aW9ucykubGVuZ3RoID4gMCkge1xuICAgIG91dCA9IG91dC5jb25jYXQoW1xuICAgICAgJ09wdGlvbnM6JyxcbiAgICAgIHRoaXMub3B0aW9uc0hlbHAoKSxcbiAgICAgICcnXG4gICAgXSk7XG4gIH1cblxuICAvLyBCdWlsZCBhcmd1bWVudHNcbiAgaWYgKHRoaXMuX2FyZ3VtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgb3V0ID0gb3V0LmNvbmNhdChbXG4gICAgICAnQXJndW1lbnRzOicsXG4gICAgICB0aGlzLmFyZ3VtZW50c0hlbHAoKSxcbiAgICAgICcnXG4gICAgXSk7XG4gIH1cblxuICAvLyBBcHBlbmQgVVNBR0UgZmlsZSBpcyBhbnlcbiAgaWYgKGV4aXN0cykge1xuICAgIG91dC5wdXNoKGZzLnJlYWRGaWxlU3luYyhmaWxlcGF0aCwgJ3V0ZjgnKSk7XG4gIH1cblxuICByZXR1cm4gb3V0LmpvaW4oJ1xcbicpO1xufTtcblxuZnVuY3Rpb24gZm9ybWF0QXJnKGNvbmZpZykge1xuICB2YXIgYXJnID0gJzwnICsgY29uZmlnLm5hbWUgKyAnPic7XG5cbiAgaWYgKCFjb25maWcucmVxdWlyZWQpIHtcbiAgICBhcmcgPSAnWycgKyBhcmcgKyAnXSc7XG4gIH1cblxuICByZXR1cm4gYXJnO1xufVxuXG4vKipcbiAqIE91dHB1dCB1c2FnZSBpbmZvcm1hdGlvbiBmb3IgdGhpcyBnaXZlbiBnZW5lcmF0b3IsIGRlcGVuZGluZyBvbiBpdHMgYXJndW1lbnRzXG4gKiBvciBvcHRpb25zLlxuICovXG5cbmhlbHAudXNhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBvcHRpb25zID0gT2JqZWN0LmtleXModGhpcy5fb3B0aW9ucykubGVuZ3RoID8gJ1tvcHRpb25zXScgOiAnJztcbiAgdmFyIG5hbWUgPSAnICcgKyB0aGlzLm9wdGlvbnMubmFtZXNwYWNlO1xuICB2YXIgYXJncyA9ICcnO1xuXG4gIGlmICh0aGlzLl9hcmd1bWVudHMubGVuZ3RoID4gMCkge1xuICAgIGFyZ3MgPSB0aGlzLl9hcmd1bWVudHMubWFwKGZvcm1hdEFyZykuam9pbignICcpO1xuICB9XG5cbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvXnllb21hbjovLCAnJyk7XG4gIHZhciBvdXQgPSAneW8nICsgbmFtZSArICcgJyArIG9wdGlvbnMgKyAnICcgKyBhcmdzO1xuXG4gIGlmICh0aGlzLmRlc2NyaXB0aW9uKSB7XG4gICAgb3V0ICs9ICdcXG5cXG4nICsgdGhpcy5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59O1xuXG4vKipcbiAqIFNpbXBsZSBzZXR0ZXIgZm9yIGN1c3RvbSBgZGVzY3JpcHRpb25gIHRvIGFwcGVuZCBvbiBoZWxwIG91dHB1dC5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gZGVzY3JpcHRpb25cbiAqL1xuXG5oZWxwLmRlc2MgPSBmdW5jdGlvbiAoZGVzY3JpcHRpb24pIHtcbiAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uIHx8ICcnO1xuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogR2V0IGhlbHAgdGV4dCBmb3IgYXJndW1lbnRzXG4gKiBAcmV0dXJucyB7U3RyaW5nfSBUZXh0IG9mIG9wdGlvbnMgaW4gZm9ybWF0dGVkIHRhYmxlXG4gKi9cbmhlbHAuYXJndW1lbnRzSGVscCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJvd3MgPSB0aGlzLl9hcmd1bWVudHMubWFwKGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICByZXR1cm4gW1xuICAgICAgJycsXG4gICAgICBjb25maWcubmFtZSA/IGNvbmZpZy5uYW1lIDogJycsXG4gICAgICBjb25maWcuZGVzY3JpcHRpb24gPyAnIyAnICsgY29uZmlnLmRlc2NyaXB0aW9uIDogJycsXG4gICAgICBjb25maWcudHlwZSA/ICdUeXBlOiAnICsgY29uZmlnLnR5cGUubmFtZSA6ICcnLFxuICAgICAgJ1JlcXVpcmVkOiAnICsgY29uZmlnLnJlcXVpcmVkXG4gICAgXTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRhYmxlKHJvd3MpO1xufTtcblxuLyoqXG4gKiBHZXQgaGVscCB0ZXh0IGZvciBvcHRpb25zXG4gKiBAcmV0dXJucyB7U3RyaW5nfSBUZXh0IG9mIG9wdGlvbnMgaW4gZm9ybWF0dGVkIHRhYmxlXG4gKi9cbmhlbHAub3B0aW9uc0hlbHAgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBvcHRpb25zID0gXy5yZWplY3QodGhpcy5fb3B0aW9ucywgZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIGVsLmhpZGU7XG4gIH0pO1xuXG4gIHZhciByb3dzID0gb3B0aW9ucy5tYXAoZnVuY3Rpb24gKG9wdCkge1xuICAgIHJldHVybiBbXG4gICAgICAnJyxcbiAgICAgIG9wdC5hbGlhcyA/ICctJyArIG9wdC5hbGlhcyArICcsICcgOiAnJyxcbiAgICAgICctLScgKyBvcHQubmFtZSxcbiAgICAgIG9wdC5kZXNjcmlwdGlvbiA/ICcjICcgKyBvcHQuZGVzY3JpcHRpb24gOiAnJyxcbiAgICAgIChvcHQuZGVmYXVsdCAhPT0gdW5kZWZpbmVkICYmIG9wdC5kZWZhdWx0ICE9PSBudWxsICYmIG9wdC5kZWZhdWx0ICE9PSAnJykgPyAnRGVmYXVsdDogJyArIG9wdC5kZWZhdWx0IDogJydcbiAgICBdO1xuICB9KTtcblxuICByZXR1cm4gdGFibGUocm93cyk7XG59O1xuIl19