var licenseIDs = require('spdx-license-ids');
function valid(string) {
    return licenseIDs.indexOf(string) > -1;
}
// Common transpositions of license identifier acronyms
var transpositions = [
    ['APGL', 'AGPL'],
    ['Gpl', 'GPL'],
    ['GLP', 'GPL'],
    ['APL', 'Apache'],
    ['ISD', 'ISC'],
    ['GLP', 'GPL'],
    ['IST', 'ISC'],
    ['Claude', 'Clause'],
    [' or later', '+'],
    [' International', ''],
    ['GNU', 'GPL'],
    ['GUN', 'GPL'],
    ['+', ''],
    ['GNU GPL', 'GPL'],
    ['GNU/GPL', 'GPL'],
    ['GNU GLP', 'GPL'],
    ['GNU General Public License', 'GPL'],
    ['Gnu public license', 'GPL'],
    ['GNU Public License', 'GPL'],
    ['GNU GENERAL PUBLIC LICENSE', 'GPL'],
    ['MTI', 'MIT'],
    ['Mozilla Public License', 'MPL'],
    ['WTH', 'WTF'],
    ['-License', '']
];
var TRANSPOSED = 0;
var CORRECT = 1;
// Simple corrections to nearly valid identifiers.
var transforms = [
    // e.g. 'mit'
    function (argument) {
        return argument.toUpperCase();
    },
    // e.g. 'MIT '
    function (argument) {
        return argument.trim();
    },
    // e.g. 'M.I.T.'
    function (argument) {
        return argument.replace(/\./g, '');
    },
    // e.g. 'Apache- 2.0'
    function (argument) {
        return argument.replace(/\s+/g, '');
    },
    // e.g. 'CC BY 4.0''
    function (argument) {
        return argument.replace(/\s+/g, '-');
    },
    // e.g. 'LGPLv2.1'
    function (argument) {
        return argument.replace('v', '-');
    },
    // e.g. 'Apache 2.0'
    function (argument) {
        return argument.replace(/,?\s*(\d)/, '-$1');
    },
    // e.g. 'GPL 2'
    function (argument) {
        return argument.replace(/,?\s*(\d)/, '-$1.0');
    },
    // e.g. 'Apache Version 2.0'
    function (argument) {
        return argument.replace(/,?\s*(V\.|v\.|V|v|Version|version)\s*(\d)/, '-$2');
    },
    // e.g. 'Apache Version 2'
    function (argument) {
        return argument.replace(/,?\s*(V\.|v\.|V|v|Version|version)\s*(\d)/, '-$2.0');
    },
    // e.g. 'ZLIB'
    function (argument) {
        return argument[0].toUpperCase() + argument.slice(1);
    },
    // e.g. 'MPL/2.0'
    function (argument) {
        return argument.replace('/', '-');
    },
    // e.g. 'Apache 2'
    function (argument) {
        return argument
            .replace(/\s*V\s*(\d)/, '-$1')
            .replace(/(\d)$/, '$1.0');
    },
    // e.g. 'GPL-2.0-'
    function (argument) {
        return argument.slice(0, argument.length - 1);
    },
    // e.g. 'GPL2'
    function (argument) {
        return argument.replace(/(\d)$/, '-$1.0');
    },
    // e.g. 'BSD 3'
    function (argument) {
        return argument.replace(/(-| )?(\d)$/, '-$2-Clause');
    },
    // e.g. 'BSD clause 3'
    function (argument) {
        return argument.replace(/(-| )clause(-| )(\d)/, '-$3-Clause');
    },
    // e.g. 'BY-NC-4.0'
    function (argument) {
        return 'CC-' + argument;
    },
    // e.g. 'BY-NC'
    function (argument) {
        return 'CC-' + argument + '-4.0';
    },
    // e.g. 'Attribution-NonCommercial'
    function (argument) {
        return argument
            .replace('Attribution', 'BY')
            .replace('NonCommercial', 'NC')
            .replace('NoDerivatives', 'ND')
            .replace(/ (\d)/, '-$1')
            .replace(/ ?International/, '');
    },
    // e.g. 'Attribution-NonCommercial'
    function (argument) {
        return 'CC-' +
            argument
                .replace('Attribution', 'BY')
                .replace('NonCommercial', 'NC')
                .replace('NoDerivatives', 'ND')
                .replace(/ (\d)/, '-$1')
                .replace(/ ?International/, '') +
            '-4.0';
    }
];
// If all else fails, guess that strings containing certain substrings
// meant to identify certain licenses.
var lastResorts = [
    ['UNLI', 'Unlicense'],
    ['WTF', 'WTFPL'],
    ['2 CLAUSE', 'BSD-2-Clause'],
    ['2-CLAUSE', 'BSD-2-Clause'],
    ['3 CLAUSE', 'BSD-3-Clause'],
    ['3-CLAUSE', 'BSD-3-Clause'],
    ['AFFERO', 'AGPL-3.0'],
    ['AGPL', 'AGPL-3.0'],
    ['APACHE', 'Apache-2.0'],
    ['ARTISTIC', 'Artistic-2.0'],
    ['Affero', 'AGPL-3.0'],
    ['BEER', 'Beerware'],
    ['BOOST', 'BSL-1.0'],
    ['BSD', 'BSD-2-Clause'],
    ['ECLIPSE', 'EPL-1.0'],
    ['FUCK', 'WTFPL'],
    ['GNU', 'GPL-3.0'],
    ['LGPL', 'LGPL-3.0'],
    ['GPL', 'GPL-3.0'],
    ['MIT', 'MIT'],
    ['MPL', 'MPL-2.0'],
    ['X11', 'X11'],
    ['ZLIB', 'Zlib']
];
var SUBSTRING = 0;
var IDENTIFIER = 1;
var validTransformation = function (identifier) {
    for (var i = 0; i < transforms.length; i++) {
        var transformed = transforms[i](identifier);
        if (transformed !== identifier && valid(transformed)) {
            return transformed;
        }
    }
    return null;
};
var validLastResort = function (identifier) {
    var upperCased = identifier.toUpperCase();
    for (var i = 0; i < lastResorts.length; i++) {
        var lastResort = lastResorts[i];
        if (upperCased.indexOf(lastResort[SUBSTRING]) > -1) {
            return lastResort[IDENTIFIER];
        }
    }
    return null;
};
var anyCorrection = function (identifier, check) {
    for (var i = 0; i < transpositions.length; i++) {
        var transposition = transpositions[i];
        var transposed = transposition[TRANSPOSED];
        if (identifier.indexOf(transposed) > -1) {
            var corrected = identifier.replace(transposed, transposition[CORRECT]);
            var checked = check(corrected);
            if (checked !== null) {
                return checked;
            }
        }
    }
    return null;
};
module.exports = function (identifier) {
    identifier = identifier.replace(/\+$/, '');
    if (valid(identifier)) {
        return identifier;
    }
    var transformed = validTransformation(identifier);
    if (transformed !== null) {
        return transformed;
    }
    transformed = anyCorrection(identifier, function (argument) {
        if (valid(argument)) {
            return argument;
        }
        return validTransformation(argument);
    });
    if (transformed !== null) {
        return transformed;
    }
    transformed = validLastResort(identifier);
    if (transformed !== null) {
        return transformed;
    }
    transformed = anyCorrection(identifier, validLastResort);
    if (transformed !== null) {
        return transformed;
    }
    return null;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxzcGR4LWNvcnJlY3RcXGluZGV4LmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGlmZWR1XFxBcHBEYXRhXFxSb2FtaW5nXFxudm1cXHY4LjQuMFxcbm9kZV9tb2R1bGVzXFxnZW5lcmF0b3Itc3BlZWRzZWVkXFxub2RlX21vZHVsZXNcXHNwZHgtY29ycmVjdFxcaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFFN0MsZUFBZSxNQUFNO0lBQ25CLE1BQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRCx1REFBdUQ7QUFDdkQsSUFBSSxjQUFjLEdBQUc7SUFDbkIsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO0lBQ2hCLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQztJQUNqQixDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7SUFDZCxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7SUFDZCxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7SUFDZCxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUM7SUFDcEIsQ0FBQyxXQUFXLEVBQUUsR0FBRyxDQUFDO0lBQ2xCLENBQUMsZ0JBQWdCLEVBQUUsRUFBRSxDQUFDO0lBQ3RCLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztJQUNULENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQztJQUNsQixDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUM7SUFDbEIsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDO0lBQ2xCLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDO0lBQ3JDLENBQUMsb0JBQW9CLEVBQUUsS0FBSyxDQUFDO0lBQzdCLENBQUMsb0JBQW9CLEVBQUUsS0FBSyxDQUFDO0lBQzdCLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDO0lBQ3JDLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsd0JBQXdCLEVBQUUsS0FBSyxDQUFDO0lBQ2pDLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQztJQUNkLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQztDQUNqQixDQUFDO0FBRUYsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBQ25CLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQztBQUVoQixrREFBa0Q7QUFDbEQsSUFBSSxVQUFVLEdBQUc7SUFDZixhQUFhO0lBQ2IsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNoQyxDQUFDO0lBQ0QsY0FBYztJQUNkLFVBQVMsUUFBUTtRQUNmLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUNELGdCQUFnQjtJQUNoQixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUNELHFCQUFxQjtJQUNyQixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUNELG9CQUFvQjtJQUNwQixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUNELGtCQUFrQjtJQUNsQixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUNELG9CQUFvQjtJQUNwQixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNELGVBQWU7SUFDZixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUNELDRCQUE0QjtJQUM1QixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQywyQ0FBMkMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM5RSxDQUFDO0lBQ0QsMEJBQTBCO0lBQzFCLFVBQVMsUUFBUTtRQUNmLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLDJDQUEyQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ2hGLENBQUM7SUFDRCxjQUFjO0lBQ2QsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFDRCxpQkFBaUI7SUFDakIsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFDRCxrQkFBa0I7SUFDbEIsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVE7YUFDWixPQUFPLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQzthQUM3QixPQUFPLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxrQkFBa0I7SUFDbEIsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUNELGNBQWM7SUFDZCxVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUNELGVBQWU7SUFDZixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUNELHNCQUFzQjtJQUN0QixVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxZQUFZLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBQ0QsbUJBQW1CO0lBQ25CLFVBQVMsUUFBUTtRQUNmLE1BQU0sQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO0lBQzFCLENBQUM7SUFDRCxlQUFlO0lBQ2YsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLEtBQUssR0FBRyxRQUFRLEdBQUcsTUFBTSxDQUFDO0lBQ25DLENBQUM7SUFDRCxtQ0FBbUM7SUFDbkMsVUFBUyxRQUFRO1FBQ2YsTUFBTSxDQUFDLFFBQVE7YUFDWixPQUFPLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQzthQUM1QixPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQzthQUM5QixPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQzthQUM5QixPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQzthQUN2QixPQUFPLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUNELG1DQUFtQztJQUNuQyxVQUFTLFFBQVE7UUFDZixNQUFNLENBQUMsS0FBSztZQUNWLFFBQVE7aUJBQ1AsT0FBTyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUM7aUJBQzVCLE9BQU8sQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDO2lCQUM5QixPQUFPLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQztpQkFDOUIsT0FBTyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUM7aUJBQ3ZCLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxFQUFFLENBQUM7WUFDL0IsTUFBTSxDQUFDO0lBQ1gsQ0FBQztDQUNGLENBQUM7QUFFRixzRUFBc0U7QUFDdEUsc0NBQXNDO0FBQ3RDLElBQUksV0FBVyxHQUFHO0lBQ2hCLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQztJQUNyQixDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7SUFDaEIsQ0FBQyxVQUFVLEVBQUUsY0FBYyxDQUFDO0lBQzVCLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQztJQUM1QixDQUFDLFVBQVUsRUFBRSxjQUFjLENBQUM7SUFDNUIsQ0FBQyxVQUFVLEVBQUUsY0FBYyxDQUFDO0lBQzVCLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQztJQUN0QixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUM7SUFDcEIsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDO0lBQ3hCLENBQUMsVUFBVSxFQUFFLGNBQWMsQ0FBQztJQUM1QixDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUM7SUFDdEIsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDO0lBQ3BCLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQztJQUNwQixDQUFDLEtBQUssRUFBRSxjQUFjLENBQUM7SUFDdkIsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDO0lBQ3RCLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQztJQUNqQixDQUFDLEtBQUssRUFBRSxTQUFTLENBQUM7SUFDbEIsQ0FBQyxNQUFNLEVBQUUsVUFBVSxDQUFDO0lBQ3BCLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQztJQUNsQixDQUFDLEtBQUssRUFBRSxLQUFLLENBQUM7SUFDZCxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUM7SUFDbEIsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDO0lBQ2QsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO0NBQ2pCLENBQUM7QUFFRixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7QUFDbEIsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO0FBRW5CLElBQUksbUJBQW1CLEdBQUcsVUFBUyxVQUFVO0lBQzNDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzNDLElBQUksV0FBVyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUM1QyxFQUFFLENBQUMsQ0FBQyxXQUFXLEtBQUssVUFBVSxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckQsTUFBTSxDQUFDLFdBQVcsQ0FBQztRQUNyQixDQUFDO0lBQ0gsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUM7QUFFRixJQUFJLGVBQWUsR0FBRyxVQUFTLFVBQVU7SUFDdkMsSUFBSSxVQUFVLEdBQUcsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzVDLElBQUksVUFBVSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hDLENBQUM7SUFDSCxDQUFDO0lBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUMsQ0FBQztBQUVGLElBQUksYUFBYSxHQUFHLFVBQVMsVUFBVSxFQUFFLEtBQUs7SUFDNUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxjQUFjLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDL0MsSUFBSSxhQUFhLEdBQUcsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLElBQUksVUFBVSxHQUFHLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzQyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QyxJQUFJLFNBQVMsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUNoQyxVQUFVLEVBQ1YsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUN2QixDQUFDO1lBQ0YsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQy9CLEVBQUUsQ0FBQyxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixNQUFNLENBQUMsT0FBTyxDQUFDO1lBQ2pCLENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUM7QUFFRixNQUFNLENBQUMsT0FBTyxHQUFHLFVBQVMsVUFBVTtJQUNsQyxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDM0MsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0QixNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFDRCxJQUFJLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNsRCxFQUFFLENBQUMsQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN6QixNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3JCLENBQUM7SUFDRCxXQUFXLEdBQUcsYUFBYSxDQUFDLFVBQVUsRUFBRSxVQUFTLFFBQVE7UUFDdkQsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQixNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2xCLENBQUM7UUFDRCxNQUFNLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDSCxFQUFFLENBQUMsQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN6QixNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3JCLENBQUM7SUFDRCxXQUFXLEdBQUcsZUFBZSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzFDLEVBQUUsQ0FBQyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUNELFdBQVcsR0FBRyxhQUFhLENBQUMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBQ3pELEVBQUUsQ0FBQyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgbGljZW5zZUlEcyA9IHJlcXVpcmUoJ3NwZHgtbGljZW5zZS1pZHMnKTtcblxuZnVuY3Rpb24gdmFsaWQoc3RyaW5nKSB7XG4gIHJldHVybiBsaWNlbnNlSURzLmluZGV4T2Yoc3RyaW5nKSA+IC0xO1xufVxuXG4vLyBDb21tb24gdHJhbnNwb3NpdGlvbnMgb2YgbGljZW5zZSBpZGVudGlmaWVyIGFjcm9ueW1zXG52YXIgdHJhbnNwb3NpdGlvbnMgPSBbXG4gIFsnQVBHTCcsICdBR1BMJ10sXG4gIFsnR3BsJywgJ0dQTCddLFxuICBbJ0dMUCcsICdHUEwnXSxcbiAgWydBUEwnLCAnQXBhY2hlJ10sXG4gIFsnSVNEJywgJ0lTQyddLFxuICBbJ0dMUCcsICdHUEwnXSxcbiAgWydJU1QnLCAnSVNDJ10sXG4gIFsnQ2xhdWRlJywgJ0NsYXVzZSddLFxuICBbJyBvciBsYXRlcicsICcrJ10sXG4gIFsnIEludGVybmF0aW9uYWwnLCAnJ10sXG4gIFsnR05VJywgJ0dQTCddLFxuICBbJ0dVTicsICdHUEwnXSxcbiAgWycrJywgJyddLFxuICBbJ0dOVSBHUEwnLCAnR1BMJ10sXG4gIFsnR05VL0dQTCcsICdHUEwnXSxcbiAgWydHTlUgR0xQJywgJ0dQTCddLFxuICBbJ0dOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlJywgJ0dQTCddLFxuICBbJ0dudSBwdWJsaWMgbGljZW5zZScsICdHUEwnXSxcbiAgWydHTlUgUHVibGljIExpY2Vuc2UnLCAnR1BMJ10sXG4gIFsnR05VIEdFTkVSQUwgUFVCTElDIExJQ0VOU0UnLCAnR1BMJ10sXG4gIFsnTVRJJywgJ01JVCddLFxuICBbJ01vemlsbGEgUHVibGljIExpY2Vuc2UnLCAnTVBMJ10sXG4gIFsnV1RIJywgJ1dURiddLFxuICBbJy1MaWNlbnNlJywgJyddXG5dO1xuXG52YXIgVFJBTlNQT1NFRCA9IDA7XG52YXIgQ09SUkVDVCA9IDE7XG5cbi8vIFNpbXBsZSBjb3JyZWN0aW9ucyB0byBuZWFybHkgdmFsaWQgaWRlbnRpZmllcnMuXG52YXIgdHJhbnNmb3JtcyA9IFtcbiAgLy8gZS5nLiAnbWl0J1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC50b1VwcGVyQ2FzZSgpO1xuICB9LFxuICAvLyBlLmcuICdNSVQgJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC50cmltKCk7XG4gIH0sXG4gIC8vIGUuZy4gJ00uSS5ULidcbiAgZnVuY3Rpb24oYXJndW1lbnQpIHtcbiAgICByZXR1cm4gYXJndW1lbnQucmVwbGFjZSgvXFwuL2csICcnKTtcbiAgfSxcbiAgLy8gZS5nLiAnQXBhY2hlLSAyLjAnXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50LnJlcGxhY2UoL1xccysvZywgJycpO1xuICB9LFxuICAvLyBlLmcuICdDQyBCWSA0LjAnJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC5yZXBsYWNlKC9cXHMrL2csICctJyk7XG4gIH0sXG4gIC8vIGUuZy4gJ0xHUEx2Mi4xJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC5yZXBsYWNlKCd2JywgJy0nKTtcbiAgfSxcbiAgLy8gZS5nLiAnQXBhY2hlIDIuMCdcbiAgZnVuY3Rpb24oYXJndW1lbnQpIHtcbiAgICByZXR1cm4gYXJndW1lbnQucmVwbGFjZSgvLD9cXHMqKFxcZCkvLCAnLSQxJyk7XG4gIH0sXG4gIC8vIGUuZy4gJ0dQTCAyJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC5yZXBsYWNlKC8sP1xccyooXFxkKS8sICctJDEuMCcpO1xuICB9LFxuICAvLyBlLmcuICdBcGFjaGUgVmVyc2lvbiAyLjAnXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50LnJlcGxhY2UoLyw/XFxzKihWXFwufHZcXC58Vnx2fFZlcnNpb258dmVyc2lvbilcXHMqKFxcZCkvLCAnLSQyJyk7XG4gIH0sXG4gIC8vIGUuZy4gJ0FwYWNoZSBWZXJzaW9uIDInXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50LnJlcGxhY2UoLyw/XFxzKihWXFwufHZcXC58Vnx2fFZlcnNpb258dmVyc2lvbilcXHMqKFxcZCkvLCAnLSQyLjAnKTtcbiAgfSxcbiAgLy8gZS5nLiAnWkxJQidcbiAgZnVuY3Rpb24oYXJndW1lbnQpIHtcbiAgICByZXR1cm4gYXJndW1lbnRbMF0udG9VcHBlckNhc2UoKSArIGFyZ3VtZW50LnNsaWNlKDEpO1xuICB9LFxuICAvLyBlLmcuICdNUEwvMi4wJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC5yZXBsYWNlKCcvJywgJy0nKTtcbiAgfSxcbiAgLy8gZS5nLiAnQXBhY2hlIDInXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50XG4gICAgICAucmVwbGFjZSgvXFxzKlZcXHMqKFxcZCkvLCAnLSQxJylcbiAgICAgIC5yZXBsYWNlKC8oXFxkKSQvLCAnJDEuMCcpO1xuICB9LFxuICAvLyBlLmcuICdHUEwtMi4wLSdcbiAgZnVuY3Rpb24oYXJndW1lbnQpIHtcbiAgICByZXR1cm4gYXJndW1lbnQuc2xpY2UoMCwgYXJndW1lbnQubGVuZ3RoIC0gMSk7XG4gIH0sXG4gIC8vIGUuZy4gJ0dQTDInXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuIGFyZ3VtZW50LnJlcGxhY2UoLyhcXGQpJC8sICctJDEuMCcpO1xuICB9LFxuICAvLyBlLmcuICdCU0QgMydcbiAgZnVuY3Rpb24oYXJndW1lbnQpIHtcbiAgICByZXR1cm4gYXJndW1lbnQucmVwbGFjZSgvKC18ICk/KFxcZCkkLywgJy0kMi1DbGF1c2UnKTtcbiAgfSxcbiAgLy8gZS5nLiAnQlNEIGNsYXVzZSAzJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudC5yZXBsYWNlKC8oLXwgKWNsYXVzZSgtfCApKFxcZCkvLCAnLSQzLUNsYXVzZScpO1xuICB9LFxuICAvLyBlLmcuICdCWS1OQy00LjAnXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuICdDQy0nICsgYXJndW1lbnQ7XG4gIH0sXG4gIC8vIGUuZy4gJ0JZLU5DJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiAnQ0MtJyArIGFyZ3VtZW50ICsgJy00LjAnO1xuICB9LFxuICAvLyBlLmcuICdBdHRyaWJ1dGlvbi1Ob25Db21tZXJjaWFsJ1xuICBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIHJldHVybiBhcmd1bWVudFxuICAgICAgLnJlcGxhY2UoJ0F0dHJpYnV0aW9uJywgJ0JZJylcbiAgICAgIC5yZXBsYWNlKCdOb25Db21tZXJjaWFsJywgJ05DJylcbiAgICAgIC5yZXBsYWNlKCdOb0Rlcml2YXRpdmVzJywgJ05EJylcbiAgICAgIC5yZXBsYWNlKC8gKFxcZCkvLCAnLSQxJylcbiAgICAgIC5yZXBsYWNlKC8gP0ludGVybmF0aW9uYWwvLCAnJyk7XG4gIH0sXG4gIC8vIGUuZy4gJ0F0dHJpYnV0aW9uLU5vbkNvbW1lcmNpYWwnXG4gIGZ1bmN0aW9uKGFyZ3VtZW50KSB7XG4gICAgcmV0dXJuICdDQy0nICtcbiAgICAgIGFyZ3VtZW50XG4gICAgICAucmVwbGFjZSgnQXR0cmlidXRpb24nLCAnQlknKVxuICAgICAgLnJlcGxhY2UoJ05vbkNvbW1lcmNpYWwnLCAnTkMnKVxuICAgICAgLnJlcGxhY2UoJ05vRGVyaXZhdGl2ZXMnLCAnTkQnKVxuICAgICAgLnJlcGxhY2UoLyAoXFxkKS8sICctJDEnKVxuICAgICAgLnJlcGxhY2UoLyA/SW50ZXJuYXRpb25hbC8sICcnKSArXG4gICAgICAnLTQuMCc7XG4gIH1cbl07XG5cbi8vIElmIGFsbCBlbHNlIGZhaWxzLCBndWVzcyB0aGF0IHN0cmluZ3MgY29udGFpbmluZyBjZXJ0YWluIHN1YnN0cmluZ3Ncbi8vIG1lYW50IHRvIGlkZW50aWZ5IGNlcnRhaW4gbGljZW5zZXMuXG52YXIgbGFzdFJlc29ydHMgPSBbXG4gIFsnVU5MSScsICdVbmxpY2Vuc2UnXSxcbiAgWydXVEYnLCAnV1RGUEwnXSxcbiAgWycyIENMQVVTRScsICdCU0QtMi1DbGF1c2UnXSxcbiAgWycyLUNMQVVTRScsICdCU0QtMi1DbGF1c2UnXSxcbiAgWyczIENMQVVTRScsICdCU0QtMy1DbGF1c2UnXSxcbiAgWyczLUNMQVVTRScsICdCU0QtMy1DbGF1c2UnXSxcbiAgWydBRkZFUk8nLCAnQUdQTC0zLjAnXSxcbiAgWydBR1BMJywgJ0FHUEwtMy4wJ10sXG4gIFsnQVBBQ0hFJywgJ0FwYWNoZS0yLjAnXSxcbiAgWydBUlRJU1RJQycsICdBcnRpc3RpYy0yLjAnXSxcbiAgWydBZmZlcm8nLCAnQUdQTC0zLjAnXSxcbiAgWydCRUVSJywgJ0JlZXJ3YXJlJ10sXG4gIFsnQk9PU1QnLCAnQlNMLTEuMCddLFxuICBbJ0JTRCcsICdCU0QtMi1DbGF1c2UnXSxcbiAgWydFQ0xJUFNFJywgJ0VQTC0xLjAnXSxcbiAgWydGVUNLJywgJ1dURlBMJ10sXG4gIFsnR05VJywgJ0dQTC0zLjAnXSxcbiAgWydMR1BMJywgJ0xHUEwtMy4wJ10sXG4gIFsnR1BMJywgJ0dQTC0zLjAnXSxcbiAgWydNSVQnLCAnTUlUJ10sXG4gIFsnTVBMJywgJ01QTC0yLjAnXSxcbiAgWydYMTEnLCAnWDExJ10sXG4gIFsnWkxJQicsICdabGliJ11cbl07XG5cbnZhciBTVUJTVFJJTkcgPSAwO1xudmFyIElERU5USUZJRVIgPSAxO1xuXG52YXIgdmFsaWRUcmFuc2Zvcm1hdGlvbiA9IGZ1bmN0aW9uKGlkZW50aWZpZXIpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0cmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHRyYW5zZm9ybWVkID0gdHJhbnNmb3Jtc1tpXShpZGVudGlmaWVyKTtcbiAgICBpZiAodHJhbnNmb3JtZWQgIT09IGlkZW50aWZpZXIgJiYgdmFsaWQodHJhbnNmb3JtZWQpKSB7XG4gICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgfVxuICB9XG4gIHJldHVybiBudWxsO1xufTtcblxudmFyIHZhbGlkTGFzdFJlc29ydCA9IGZ1bmN0aW9uKGlkZW50aWZpZXIpIHtcbiAgdmFyIHVwcGVyQ2FzZWQgPSBpZGVudGlmaWVyLnRvVXBwZXJDYXNlKCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbGFzdFJlc29ydHMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgbGFzdFJlc29ydCA9IGxhc3RSZXNvcnRzW2ldO1xuICAgIGlmICh1cHBlckNhc2VkLmluZGV4T2YobGFzdFJlc29ydFtTVUJTVFJJTkddKSA+IC0xKSB7XG4gICAgICByZXR1cm4gbGFzdFJlc29ydFtJREVOVElGSUVSXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG52YXIgYW55Q29ycmVjdGlvbiA9IGZ1bmN0aW9uKGlkZW50aWZpZXIsIGNoZWNrKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhbnNwb3NpdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgdHJhbnNwb3NpdGlvbiA9IHRyYW5zcG9zaXRpb25zW2ldO1xuICAgIHZhciB0cmFuc3Bvc2VkID0gdHJhbnNwb3NpdGlvbltUUkFOU1BPU0VEXTtcbiAgICBpZiAoaWRlbnRpZmllci5pbmRleE9mKHRyYW5zcG9zZWQpID4gLTEpIHtcbiAgICAgIHZhciBjb3JyZWN0ZWQgPSBpZGVudGlmaWVyLnJlcGxhY2UoXG4gICAgICAgIHRyYW5zcG9zZWQsXG4gICAgICAgIHRyYW5zcG9zaXRpb25bQ09SUkVDVF1cbiAgICAgICk7XG4gICAgICB2YXIgY2hlY2tlZCA9IGNoZWNrKGNvcnJlY3RlZCk7XG4gICAgICBpZiAoY2hlY2tlZCAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gY2hlY2tlZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGlkZW50aWZpZXIpIHtcbiAgaWRlbnRpZmllciA9IGlkZW50aWZpZXIucmVwbGFjZSgvXFwrJC8sICcnKTtcbiAgaWYgKHZhbGlkKGlkZW50aWZpZXIpKSB7XG4gICAgcmV0dXJuIGlkZW50aWZpZXI7XG4gIH1cbiAgdmFyIHRyYW5zZm9ybWVkID0gdmFsaWRUcmFuc2Zvcm1hdGlvbihpZGVudGlmaWVyKTtcbiAgaWYgKHRyYW5zZm9ybWVkICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICB9XG4gIHRyYW5zZm9ybWVkID0gYW55Q29ycmVjdGlvbihpZGVudGlmaWVyLCBmdW5jdGlvbihhcmd1bWVudCkge1xuICAgIGlmICh2YWxpZChhcmd1bWVudCkpIHtcbiAgICAgIHJldHVybiBhcmd1bWVudDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbGlkVHJhbnNmb3JtYXRpb24oYXJndW1lbnQpO1xuICB9KTtcbiAgaWYgKHRyYW5zZm9ybWVkICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICB9XG4gIHRyYW5zZm9ybWVkID0gdmFsaWRMYXN0UmVzb3J0KGlkZW50aWZpZXIpO1xuICBpZiAodHJhbnNmb3JtZWQgIT09IG51bGwpIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gIH1cbiAgdHJhbnNmb3JtZWQgPSBhbnlDb3JyZWN0aW9uKGlkZW50aWZpZXIsIHZhbGlkTGFzdFJlc29ydCk7XG4gIGlmICh0cmFuc2Zvcm1lZCAhPT0gbnVsbCkge1xuICAgIHJldHVybiB0cmFuc2Zvcm1lZDtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn07XG4iXX0=