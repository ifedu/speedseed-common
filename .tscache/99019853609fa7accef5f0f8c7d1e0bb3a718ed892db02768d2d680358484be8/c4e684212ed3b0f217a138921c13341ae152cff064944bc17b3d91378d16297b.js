"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var _1 = require("../");
var Prompter = /** @class */ (function () {
    function Prompter() {
        var _this = this;
        this.answers = {};
        this.optionExcludeChoice = function (option, choice) {
            if (!choice || !choice.exclude)
                return;
            for (var prop in choice.exclude) {
                _1.core.setOptions();
                var promptChoiced = _1.core.options[prop];
                var optionExcluded = option.choices[option.i];
                choice.exclude[prop].forEach(_this.optionExcludeChoiceExclude.bind(_this, promptChoiced, option));
            }
        };
        this.optionExcludeChoiceExclude = function (promptChoiced, option, choiceExclude) {
            if (promptChoiced === choiceExclude) {
                option.choices.splice(option.i, 1);
                option.i--;
            }
        };
    }
    Prompter.prototype.getProject = function (name) {
        return {
            default: _1.core.yo.config.get(name) || 'myproject',
            message: 'Project Name?',
            name: name,
            type: 'input',
        };
    };
    Prompter.prototype.getTemplate = function (name) {
        return {
            default: _1.core.yo.config.get(name) || 0,
            message: 'Template?',
            name: name,
            type: 'list',
            choices: this.generators,
        };
    };
    Prompter.prototype.getTemplateFiles = function (name) {
        return {
            default: ((_1.core.yo.config.get(name) === false)
                ? 1
                : 0)
                || 0,
            message: 'Template files?',
            name: name,
            type: 'list',
            choices: [
                {
                    name: 'yes',
                    value: true,
                }, {
                    name: 'no',
                    value: false,
                }
            ]
        };
    };
    Prompter.prototype.setGenerator = function (generators) {
        this.generators = generators;
    };
    Prompter.prototype.setOptions = function (promptings, cb) {
        this.cb = cb;
        this.setOption(promptings.options, 0);
    };
    Prompter.prototype.setTemplateChoices = function (template) {
        if (process.argv[3] === undefined) {
            template.choices = this.generators;
        }
        else {
            var param = process.argv[3].replace('--tpl=', '');
            template.choices = {
                choices: [{
                        name: "generator-" + param,
                        value: param
                    }]
            };
        }
    };
    Prompter.prototype.setOption = function (options, i) {
        var option = options[i];
        this.configOptions(option);
        if (option.choices && option.choices.length === 1) {
            var choice = option.choices[0];
            this.setOptionAnswer(options, i, (_a = {},
                _a[option.name] = choice.value,
                _a));
        }
        else {
            _1.core.yo
                .prompt(option)
                .then(this.setOptionAnswer.bind(this, options, i));
        }
        var _a;
    };
    Prompter.prototype.configOptions = function (option) {
        if (!option)
            return;
        if (!option.type)
            option.type = 'list';
        this.optionExclude(option);
        var name = _1.core.yo.config.get(option.name);
        option.default = (name)
            ? name
            : option.default || 0;
    };
    Prompter.prototype.optionExclude = function (option) {
        if (!option.choices)
            return;
        var length = option.choices.length;
        for (option.i = 0; option.i < length; option.i++) {
            this.optionExcludeChoice(option, option.choices[option.i]);
        }
    };
    Prompter.prototype.setOptionAnswer = function (options, i, answer) {
        var promptKey = this.getKey(answer);
        var promptVal = answer[promptKey];
        this.answers[promptKey] = promptVal;
        _1.core.yo.config.set(promptKey, promptVal);
        this.searchInChoices(options[i].choices, promptKey, promptVal);
        (options[i + 1])
            ? this.setOption(options, i + 1)
            : this.cb();
    };
    Prompter.prototype.getKey = function (obj) {
        return Object.keys(obj)[0];
    };
    Prompter.prototype.searchInChoices = function (choices, promptKey, promptVal) {
        if (choices) {
            for (var prop in choices) {
                this.choicedHaveExtra(choices[prop], promptKey, promptVal);
            }
        }
    };
    Prompter.prototype.choicedHaveExtra = function (choice, promptKey, promptVal) {
        if (choice.value === promptVal && choice.extra) {
            _1.core.yo.config.set(promptKey + "Extra", choice.extra);
        }
    };
    return Prompter;
}());
exports.default = Prompter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxzcGVlZHNlZWRcXHNyY1xccHJvbXB0ZXIudHMiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcaWZlZHVcXEFwcERhdGFcXFJvYW1pbmdcXG52bVxcdjguNC4wXFxub2RlX21vZHVsZXNcXGdlbmVyYXRvci1zcGVlZHNlZWRcXG5vZGVfbW9kdWxlc1xcc3BlZWRzZWVkXFxzcmNcXHByb21wdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0JBQTBCO0FBRTFCO0lBQUE7UUFBQSxpQkF5S0M7UUF4S0csWUFBTyxHQUFRLEVBQUUsQ0FBQTtRQWlIVCx3QkFBbUIsR0FBRyxVQUFDLE1BQVcsRUFBRSxNQUFXO1lBQ25ELEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQztnQkFBQyxNQUFNLENBQUE7WUFFdEMsR0FBRyxDQUFDLENBQUMsSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLE9BQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQTtnQkFFakIsSUFBTSxhQUFhLEdBQUcsT0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtnQkFFeEMsSUFBTSxjQUFjLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUE7Z0JBRS9DLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxDQUN4QixLQUFJLENBQUMsMEJBQTBCLENBQUMsSUFBSSxDQUFDLEtBQUksRUFBRSxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQ3BFLENBQUE7WUFDTCxDQUFDO1FBQ0wsQ0FBQyxDQUFBO1FBRU8sK0JBQTBCLEdBQUcsVUFBQyxhQUFrQixFQUFFLE1BQVcs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QUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNWLEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFBO1lBQzlELENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQUVPLG1DQUFnQixHQUF4QixVQUF5QixNQUFXLEVBQUUsU0FBaUIsRUFBRSxTQUFpQjtRQUN0RSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM3QyxPQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUksU0FBUyxVQUFPLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFBO1FBQ3pELENBQUM7SUFDTCxDQUFDO0lBQ0wsZUFBQztBQUFELENBQUMsQUF6S0QsSUF5S0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi4vJ1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUHJvbXB0ZXIge1xyXG4gICAgYW5zd2VyczogYW55ID0ge31cclxuXHJcbiAgICBwcml2YXRlIGNiOiBhbnlcclxuICAgIHByaXZhdGUgZ2VuZXJhdG9yczogYW55XHJcblxyXG4gICAgZ2V0UHJvamVjdChuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiBjb3JlLnlvLmNvbmZpZy5nZXQobmFtZSkgfHwgJ215cHJvamVjdCcsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdQcm9qZWN0IE5hbWU/JyxcclxuICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgdHlwZTogJ2lucHV0JyxcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VGVtcGxhdGUobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZGVmYXVsdDogY29yZS55by5jb25maWcuZ2V0KG5hbWUpIHx8IDAsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdUZW1wbGF0ZT8nLFxyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiAnbGlzdCcsXHJcblxyXG4gICAgICAgICAgICBjaG9pY2VzOiB0aGlzLmdlbmVyYXRvcnMsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGdldFRlbXBsYXRlRmlsZXMobmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgZGVmYXVsdDogKChjb3JlLnlvLmNvbmZpZy5nZXQobmFtZSkgPT09IGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgPyAxXHJcbiAgICAgICAgICAgICAgICA6IDApXHJcbiAgICAgICAgICAgICAgICB8fCAwLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVGVtcGxhdGUgZmlsZXM/JyxcclxuICAgICAgICAgICAgbmFtZSxcclxuICAgICAgICAgICAgdHlwZTogJ2xpc3QnLFxyXG5cclxuICAgICAgICAgICAgY2hvaWNlczogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd5ZXMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSwge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICdubycsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHNldEdlbmVyYXRvcihnZW5lcmF0b3JzOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmdlbmVyYXRvcnMgPSBnZW5lcmF0b3JzXHJcbiAgICB9XHJcblxyXG4gICAgc2V0T3B0aW9ucyhwcm9tcHRpbmdzOiBhbnksIGNiOiBhbnkpIHtcclxuICAgICAgICB0aGlzLmNiID0gY2JcclxuXHJcbiAgICAgICAgdGhpcy5zZXRPcHRpb24ocHJvbXB0aW5ncy5vcHRpb25zLCAwKVxyXG4gICAgfVxyXG5cclxuICAgIHNldFRlbXBsYXRlQ2hvaWNlcyh0ZW1wbGF0ZTogYW55KSB7XHJcbiAgICAgICAgaWYgKHByb2Nlc3MuYXJndlszXSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlLmNob2ljZXMgPSB0aGlzLmdlbmVyYXRvcnNcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJhbSA9IHByb2Nlc3MuYXJndlszXS5yZXBsYWNlKCctLXRwbD0nLCAnJylcclxuXHJcbiAgICAgICAgICAgIHRlbXBsYXRlLmNob2ljZXMgPSB7XHJcbiAgICAgICAgICAgICAgICBjaG9pY2VzOiBbe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGBnZW5lcmF0b3ItJHtwYXJhbX1gLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwYXJhbVxyXG4gICAgICAgICAgICAgICAgfV1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldE9wdGlvbihvcHRpb25zOiBhbnksIGk6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IG9wdGlvbiA9IG9wdGlvbnNbaV1cclxuXHJcbiAgICAgICAgdGhpcy5jb25maWdPcHRpb25zKG9wdGlvbilcclxuXHJcbiAgICAgICAgaWYgKG9wdGlvbi5jaG9pY2VzICYmIG9wdGlvbi5jaG9pY2VzLmxlbmd0aCA9PT0gMSkge1xyXG4gICAgICAgICAgICBjb25zdCBjaG9pY2UgPSBvcHRpb24uY2hvaWNlc1swXVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXRPcHRpb25BbnN3ZXIob3B0aW9ucywgaSwge1xyXG4gICAgICAgICAgICAgICAgW29wdGlvbi5uYW1lXTogY2hvaWNlLnZhbHVlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY29yZS55b1xyXG4gICAgICAgICAgICAucHJvbXB0KG9wdGlvbilcclxuICAgICAgICAgICAgLnRoZW4odGhpcy5zZXRPcHRpb25BbnN3ZXIuYmluZCh0aGlzLCBvcHRpb25zLCBpKSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjb25maWdPcHRpb25zKG9wdGlvbjogYW55KSB7XHJcbiAgICAgICAgaWYgKCFvcHRpb24pIHJldHVyblxyXG5cclxuICAgICAgICBpZiAoIW9wdGlvbi50eXBlKSBvcHRpb24udHlwZSA9ICdsaXN0J1xyXG5cclxuICAgICAgICB0aGlzLm9wdGlvbkV4Y2x1ZGUob3B0aW9uKVxyXG5cclxuICAgICAgICBjb25zdCBuYW1lID0gY29yZS55by5jb25maWcuZ2V0KG9wdGlvbi5uYW1lKVxyXG5cclxuICAgICAgICBvcHRpb24uZGVmYXVsdCA9IChuYW1lKVxyXG4gICAgICAgICAgICA/IG5hbWVcclxuICAgICAgICAgICAgOiBvcHRpb24uZGVmYXVsdCB8fCAwXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvcHRpb25FeGNsdWRlKG9wdGlvbjogYW55KSB7XHJcbiAgICAgICAgaWYgKCFvcHRpb24uY2hvaWNlcykgcmV0dXJuXHJcblxyXG4gICAgICAgIGxldCBsZW5ndGggPSBvcHRpb24uY2hvaWNlcy5sZW5ndGhcclxuICAgICAgICBmb3IgKG9wdGlvbi5pID0gMDsgb3B0aW9uLmkgPCBsZW5ndGg7IG9wdGlvbi5pKyspIHtcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25FeGNsdWRlQ2hvaWNlKG9wdGlvbiwgb3B0aW9uLmNob2ljZXNbb3B0aW9uLmldKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG9wdGlvbkV4Y2x1ZGVDaG9pY2UgPSAob3B0aW9uOiBhbnksIGNob2ljZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKCFjaG9pY2UgfHwgIWNob2ljZS5leGNsdWRlKSByZXR1cm5cclxuXHJcbiAgICAgICAgZm9yIChsZXQgcHJvcCBpbiBjaG9pY2UuZXhjbHVkZSkge1xyXG4gICAgICAgICAgICBjb3JlLnNldE9wdGlvbnMoKVxyXG5cclxuICAgICAgICAgICAgY29uc3QgcHJvbXB0Q2hvaWNlZCA9IGNvcmUub3B0aW9uc1twcm9wXVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgb3B0aW9uRXhjbHVkZWQgPSBvcHRpb24uY2hvaWNlc1tvcHRpb24uaV1cclxuXHJcbiAgICAgICAgICAgIGNob2ljZS5leGNsdWRlW3Byb3BdLmZvckVhY2goXHJcbiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbkV4Y2x1ZGVDaG9pY2VFeGNsdWRlLmJpbmQodGhpcywgcHJvbXB0Q2hvaWNlZCwgb3B0aW9uKVxyXG4gICAgICAgICAgICApXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb3B0aW9uRXhjbHVkZUNob2ljZUV4Y2x1ZGUgPSAocHJvbXB0Q2hvaWNlZDogYW55LCBvcHRpb246IGFueSwgY2hvaWNlRXhjbHVkZTogYW55KSA9PiB7XHJcbiAgICAgICAgaWYgKHByb21wdENob2ljZWQgPT09IGNob2ljZUV4Y2x1ZGUpIHtcclxuICAgICAgICAgICAgb3B0aW9uLmNob2ljZXMuc3BsaWNlKG9wdGlvbi5pLCAxKVxyXG5cclxuICAgICAgICAgICAgb3B0aW9uLmktLVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHNldE9wdGlvbkFuc3dlcihvcHRpb25zOiBhbnksIGk6IG51bWJlciwgYW5zd2VyOiBhbnkpIHtcclxuICAgICAgICBjb25zdCBwcm9tcHRLZXkgPSB0aGlzLmdldEtleShhbnN3ZXIpXHJcbiAgICAgICAgY29uc3QgcHJvbXB0VmFsID0gYW5zd2VyW3Byb21wdEtleV1cclxuXHJcbiAgICAgICAgdGhpcy5hbnN3ZXJzW3Byb21wdEtleV0gPSBwcm9tcHRWYWxcclxuICAgICAgICBjb3JlLnlvLmNvbmZpZy5zZXQocHJvbXB0S2V5LCBwcm9tcHRWYWwpXHJcblxyXG4gICAgICAgIHRoaXMuc2VhcmNoSW5DaG9pY2VzKG9wdGlvbnNbaV0uY2hvaWNlcywgcHJvbXB0S2V5LCBwcm9tcHRWYWwpXHJcblxyXG4gICAgICAgIDsob3B0aW9uc1tpKzFdKVxyXG4gICAgICAgICAgICA/IHRoaXMuc2V0T3B0aW9uKG9wdGlvbnMsIGkrMSlcclxuICAgICAgICAgICAgOiB0aGlzLmNiKClcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldEtleShvYmo6IGFueSkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopWzBdXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBzZWFyY2hJbkNob2ljZXMoY2hvaWNlczogYW55LCBwcm9tcHRLZXk6c3RyaW5nLCBwcm9tcHRWYWw6IHN0cmluZykge1xyXG4gICAgICAgIGlmIChjaG9pY2VzKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHByb3AgaW4gY2hvaWNlcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaG9pY2VkSGF2ZUV4dHJhKGNob2ljZXNbcHJvcF0sIHByb21wdEtleSwgcHJvbXB0VmFsKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2hvaWNlZEhhdmVFeHRyYShjaG9pY2U6IGFueSwgcHJvbXB0S2V5OiBzdHJpbmcsIHByb21wdFZhbDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYgKGNob2ljZS52YWx1ZSA9PT0gcHJvbXB0VmFsICYmIGNob2ljZS5leHRyYSkge1xyXG4gICAgICAgICAgICBjb3JlLnlvLmNvbmZpZy5zZXQoYCR7cHJvbXB0S2V5fUV4dHJhYCwgY2hvaWNlLmV4dHJhKVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXX0=