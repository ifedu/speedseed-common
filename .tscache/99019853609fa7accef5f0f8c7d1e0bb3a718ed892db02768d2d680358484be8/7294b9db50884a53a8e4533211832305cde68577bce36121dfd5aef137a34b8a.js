var semver = require("semver");
var validateLicense = require('validate-npm-package-license');
var hostedGitInfo = require("hosted-git-info");
var isBuiltinModule = require("is-builtin-module");
var depTypes = ["dependencies", "devDependencies", "optionalDependencies"];
var extractDescription = require("./extract_description");
var url = require("url");
var typos = require("./typos.json");
var fixer = module.exports = {
    // default warning function
    warn: function () { },
    fixRepositoryField: function (data) {
        if (data.repositories) {
            this.warn("repositories");
            data.repository = data.repositories[0];
        }
        if (!data.repository)
            return this.warn("missingRepository");
        if (typeof data.repository === "string") {
            data.repository = {
                type: "git",
                url: data.repository
            };
        }
        var r = data.repository.url || "";
        if (r) {
            var hosted = hostedGitInfo.fromUrl(r);
            if (hosted) {
                r = data.repository.url
                    = hosted.getDefaultRepresentation() == "shortcut" ? hosted.https() : hosted.toString();
            }
        }
        if (r.match(/github.com\/[^\/]+\/[^\/]+\.git\.git$/)) {
            this.warn("brokenGitUrl", r);
        }
    },
    fixTypos: function (data) {
        Object.keys(typos.topLevel).forEach(function (d) {
            if (data.hasOwnProperty(d)) {
                this.warn("typo", d, typos.topLevel[d]);
            }
        }, this);
    },
    fixScriptsField: function (data) {
        if (!data.scripts)
            return;
        if (typeof data.scripts !== "object") {
            this.warn("nonObjectScripts");
            delete data.scripts;
            return;
        }
        Object.keys(data.scripts).forEach(function (k) {
            if (typeof data.scripts[k] !== "string") {
                this.warn("nonStringScript");
                delete data.scripts[k];
            }
            else if (typos.script[k] && !data.scripts[typos.script[k]]) {
                this.warn("typo", k, typos.script[k], "scripts");
            }
        }, this);
    },
    fixFilesField: function (data) {
        var files = data.files;
        if (files && !Array.isArray(files)) {
            this.warn("nonArrayFiles");
            delete data.files;
        }
        else if (data.files) {
            data.files = data.files.filter(function (file) {
                if (!file || typeof file !== "string") {
                    this.warn("invalidFilename", file);
                    return false;
                }
                else {
                    return true;
                }
            }, this);
        }
    },
    fixBinField: function (data) {
        if (!data.bin)
            return;
        if (typeof data.bin === "string") {
            var b = {};
            var match;
            if (match = data.name.match(/^@[^/]+[/](.*)$/)) {
                b[match[1]] = data.bin;
            }
            else {
                b[data.name] = data.bin;
            }
            data.bin = b;
        }
    },
    fixManField: function (data) {
        if (!data.man)
            return;
        if (typeof data.man === "string") {
            data.man = [data.man];
        }
    },
    fixBundleDependenciesField: function (data) {
        var bdd = "bundledDependencies";
        var bd = "bundleDependencies";
        if (data[bdd] && !data[bd]) {
            data[bd] = data[bdd];
            delete data[bdd];
        }
        if (data[bd] && !Array.isArray(data[bd])) {
            this.warn("nonArrayBundleDependencies");
            delete data[bd];
        }
        else if (data[bd]) {
            data[bd] = data[bd].filter(function (bd) {
                if (!bd || typeof bd !== 'string') {
                    this.warn("nonStringBundleDependency", bd);
                    return false;
                }
                else {
                    if (!data.dependencies) {
                        data.dependencies = {};
                    }
                    if (!data.dependencies.hasOwnProperty(bd)) {
                        this.warn("nonDependencyBundleDependency", bd);
                        data.dependencies[bd] = "*";
                    }
                    return true;
                }
            }, this);
        }
    },
    fixDependencies: function (data, strict) {
        var loose = !strict;
        objectifyDeps(data, this.warn);
        addOptionalDepsToDeps(data, this.warn);
        this.fixBundleDependenciesField(data);
        ['dependencies', 'devDependencies'].forEach(function (deps) {
            if (!(deps in data))
                return;
            if (!data[deps] || typeof data[deps] !== "object") {
                this.warn("nonObjectDependencies", deps);
                delete data[deps];
                return;
            }
            Object.keys(data[deps]).forEach(function (d) {
                var r = data[deps][d];
                if (typeof r !== 'string') {
                    this.warn("nonStringDependency", d, JSON.stringify(r));
                    delete data[deps][d];
                }
                var hosted = hostedGitInfo.fromUrl(data[deps][d]);
                if (hosted)
                    data[deps][d] = hosted.toString();
            }, this);
        }, this);
    },
    fixModulesField: function (data) {
        if (data.modules) {
            this.warn("deprecatedModules");
            delete data.modules;
        }
    },
    fixKeywordsField: function (data) {
        if (typeof data.keywords === "string") {
            data.keywords = data.keywords.split(/,\s+/);
        }
        if (data.keywords && !Array.isArray(data.keywords)) {
            delete data.keywords;
            this.warn("nonArrayKeywords");
        }
        else if (data.keywords) {
            data.keywords = data.keywords.filter(function (kw) {
                if (typeof kw !== "string" || !kw) {
                    this.warn("nonStringKeyword");
                    return false;
                }
                else {
                    return true;
                }
            }, this);
        }
    },
    fixVersionField: function (data, strict) {
        // allow "loose" semver 1.0 versions in non-strict mode
        // enforce strict semver 2.0 compliance in strict mode
        var loose = !strict;
        if (!data.version) {
            data.version = "";
            return true;
        }
        if (!semver.valid(data.version, loose)) {
            throw new Error('Invalid version: "' + data.version + '"');
        }
        data.version = semver.clean(data.version, loose);
        return true;
    },
    fixPeople: function (data) {
        modifyPeople(data, unParsePerson);
        modifyPeople(data, parsePerson);
    },
    fixNameField: function (data, options) {
        if (typeof options === "boolean")
            options = { strict: options };
        else if (typeof options === "undefined")
            options = {};
        var strict = options.strict;
        if (!data.name && !strict) {
            data.name = "";
            return;
        }
        if (typeof data.name !== "string") {
            throw new Error("name field must be a string.");
        }
        if (!strict)
            data.name = data.name.trim();
        ensureValidName(data.name, strict, options.allowLegacyCase);
        if (isBuiltinModule(data.name))
            this.warn("conflictingName", data.name);
    },
    fixDescriptionField: function (data) {
        if (data.description && typeof data.description !== 'string') {
            this.warn("nonStringDescription");
            delete data.description;
        }
        if (data.readme && !data.description)
            data.description = extractDescription(data.readme);
        if (data.description === undefined)
            delete data.description;
        if (!data.description)
            this.warn("missingDescription");
    },
    fixReadmeField: function (data) {
        if (!data.readme) {
            this.warn("missingReadme");
            data.readme = "ERROR: No README data found!";
        }
    },
    fixBugsField: function (data) {
        if (!data.bugs && data.repository && data.repository.url) {
            var hosted = hostedGitInfo.fromUrl(data.repository.url);
            if (hosted && hosted.bugs()) {
                data.bugs = { url: hosted.bugs() };
            }
        }
        else if (data.bugs) {
            var emailRe = /^.+@.*\..+$/;
            if (typeof data.bugs == "string") {
                if (emailRe.test(data.bugs))
                    data.bugs = { email: data.bugs };
                else if (url.parse(data.bugs).protocol)
                    data.bugs = { url: data.bugs };
                else
                    this.warn("nonEmailUrlBugsString");
            }
            else {
                bugsTypos(data.bugs, this.warn);
                var oldBugs = data.bugs;
                data.bugs = {};
                if (oldBugs.url) {
                    if (typeof (oldBugs.url) == "string" && url.parse(oldBugs.url).protocol)
                        data.bugs.url = oldBugs.url;
                    else
                        this.warn("nonUrlBugsUrlField");
                }
                if (oldBugs.email) {
                    if (typeof (oldBugs.email) == "string" && emailRe.test(oldBugs.email))
                        data.bugs.email = oldBugs.email;
                    else
                        this.warn("nonEmailBugsEmailField");
                }
            }
            if (!data.bugs.email && !data.bugs.url) {
                delete data.bugs;
                this.warn("emptyNormalizedBugs");
            }
        }
    },
    fixHomepageField: function (data) {
        if (!data.homepage && data.repository && data.repository.url) {
            var hosted = hostedGitInfo.fromUrl(data.repository.url);
            if (hosted && hosted.docs())
                data.homepage = hosted.docs();
        }
        if (!data.homepage)
            return;
        if (typeof data.homepage !== "string") {
            this.warn("nonUrlHomepage");
            return delete data.homepage;
        }
        if (!url.parse(data.homepage).protocol) {
            data.homepage = "http://" + data.homepage;
        }
    },
    fixLicenseField: function (data) {
        if (!data.license) {
            return this.warn("missingLicense");
        }
        else {
            if (typeof (data.license) !== 'string' ||
                data.license.length < 1) {
                this.warn("invalidLicense");
            }
            else {
                if (!validateLicense(data.license).validForNewPackages)
                    this.warn("invalidLicense");
            }
        }
    }
};
function isValidScopedPackageName(spec) {
    if (spec.charAt(0) !== '@')
        return false;
    var rest = spec.slice(1).split('/');
    if (rest.length !== 2)
        return false;
    return rest[0] && rest[1] &&
        rest[0] === encodeURIComponent(rest[0]) &&
        rest[1] === encodeURIComponent(rest[1]);
}
function isCorrectlyEncodedName(spec) {
    return !spec.match(/[\/@\s\+%:]/) &&
        spec === encodeURIComponent(spec);
}
function ensureValidName(name, strict, allowLegacyCase) {
    if (name.charAt(0) === "." ||
        !(isValidScopedPackageName(name) || isCorrectlyEncodedName(name)) ||
        (strict && (!allowLegacyCase) && name !== name.toLowerCase()) ||
        name.toLowerCase() === "node_modules" ||
        name.toLowerCase() === "favicon.ico") {
        throw new Error("Invalid name: " + JSON.stringify(name));
    }
}
function modifyPeople(data, fn) {
    if (data.author)
        data.author = fn(data.author);
    ["maintainers", "contributors"].forEach(function (set) {
        if (!Array.isArray(data[set]))
            return;
        data[set] = data[set].map(fn);
    });
    return data;
}
function unParsePerson(person) {
    if (typeof person === "string")
        return person;
    var name = person.name || "";
    var u = person.url || person.web;
    var url = u ? (" (" + u + ")") : "";
    var e = person.email || person.mail;
    var email = e ? (" <" + e + ">") : "";
    return name + email + url;
}
function parsePerson(person) {
    if (typeof person !== "string")
        return person;
    var name = person.match(/^([^\(<]+)/);
    var url = person.match(/\(([^\)]+)\)/);
    var email = person.match(/<([^>]+)>/);
    var obj = {};
    if (name && name[0].trim())
        obj.name = name[0].trim();
    if (email)
        obj.email = email[1];
    if (url)
        obj.url = url[1];
    return obj;
}
function addOptionalDepsToDeps(data, warn) {
    var o = data.optionalDependencies;
    if (!o)
        return;
    var d = data.dependencies || {};
    Object.keys(o).forEach(function (k) {
        d[k] = o[k];
    });
    data.dependencies = d;
}
function depObjectify(deps, type, warn) {
    if (!deps)
        return {};
    if (typeof deps === "string") {
        deps = deps.trim().split(/[\n\r\s\t ,]+/);
    }
    if (!Array.isArray(deps))
        return deps;
    warn("deprecatedArrayDependencies", type);
    var o = {};
    deps.filter(function (d) {
        return typeof d === "string";
    }).forEach(function (d) {
        d = d.trim().split(/(:?[@\s><=])/);
        var dn = d.shift();
        var dv = d.join("");
        dv = dv.trim();
        dv = dv.replace(/^@/, "");
        o[dn] = dv;
    });
    return o;
}
function objectifyDeps(data, warn) {
    depTypes.forEach(function (type) {
        if (!data[type])
            return;
        data[type] = depObjectify(data[type], type, warn);
    });
}
function bugsTypos(bugs, warn) {
    if (!bugs)
        return;
    Object.keys(bugs).forEach(function (k) {
        if (typos.bugs[k]) {
            warn("typo", k, typos.bugs[k], "bugs");
            bugs[typos.bugs[k]] = bugs[k];
            delete bugs[k];
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxub3JtYWxpemUtcGFja2FnZS1kYXRhXFxsaWJcXGZpeGVyLmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGlmZWR1XFxBcHBEYXRhXFxSb2FtaW5nXFxudm1cXHY4LjQuMFxcbm9kZV9tb2R1bGVzXFxnZW5lcmF0b3Itc3BlZWRzZWVkXFxub2RlX21vZHVsZXNcXG5vcm1hbGl6ZS1wYWNrYWdlLWRhdGFcXGxpYlxcZml4ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQzlCLElBQUksZUFBZSxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQzlELElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFBO0FBQzlDLElBQUksZUFBZSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO0FBQ2xELElBQUksUUFBUSxHQUFHLENBQUMsY0FBYyxFQUFDLGlCQUFpQixFQUFDLHNCQUFzQixDQUFDLENBQUE7QUFDeEUsSUFBSSxrQkFBa0IsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQTtBQUN6RCxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7QUFDeEIsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBRW5DLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEdBQUc7SUFDM0IsMkJBQTJCO0lBQzNCLElBQUksRUFBRSxjQUFZLENBQUM7SUFFbkIsa0JBQWtCLEVBQUUsVUFBUyxJQUFJO1FBQy9CLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FB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SUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ2hCLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgc2VtdmVyID0gcmVxdWlyZShcInNlbXZlclwiKVxudmFyIHZhbGlkYXRlTGljZW5zZSA9IHJlcXVpcmUoJ3ZhbGlkYXRlLW5wbS1wYWNrYWdlLWxpY2Vuc2UnKTtcbnZhciBob3N0ZWRHaXRJbmZvID0gcmVxdWlyZShcImhvc3RlZC1naXQtaW5mb1wiKVxudmFyIGlzQnVpbHRpbk1vZHVsZSA9IHJlcXVpcmUoXCJpcy1idWlsdGluLW1vZHVsZVwiKVxudmFyIGRlcFR5cGVzID0gW1wiZGVwZW5kZW5jaWVzXCIsXCJkZXZEZXBlbmRlbmNpZXNcIixcIm9wdGlvbmFsRGVwZW5kZW5jaWVzXCJdXG52YXIgZXh0cmFjdERlc2NyaXB0aW9uID0gcmVxdWlyZShcIi4vZXh0cmFjdF9kZXNjcmlwdGlvblwiKVxudmFyIHVybCA9IHJlcXVpcmUoXCJ1cmxcIilcbnZhciB0eXBvcyA9IHJlcXVpcmUoXCIuL3R5cG9zLmpzb25cIilcblxudmFyIGZpeGVyID0gbW9kdWxlLmV4cG9ydHMgPSB7XG4gIC8vIGRlZmF1bHQgd2FybmluZyBmdW5jdGlvblxuICB3YXJuOiBmdW5jdGlvbigpIHt9LFxuXG4gIGZpeFJlcG9zaXRvcnlGaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIGlmIChkYXRhLnJlcG9zaXRvcmllcykge1xuICAgICAgdGhpcy53YXJuKFwicmVwb3NpdG9yaWVzXCIpO1xuICAgICAgZGF0YS5yZXBvc2l0b3J5ID0gZGF0YS5yZXBvc2l0b3JpZXNbMF1cbiAgICB9XG4gICAgaWYgKCFkYXRhLnJlcG9zaXRvcnkpIHJldHVybiB0aGlzLndhcm4oXCJtaXNzaW5nUmVwb3NpdG9yeVwiKVxuICAgIGlmICh0eXBlb2YgZGF0YS5yZXBvc2l0b3J5ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBkYXRhLnJlcG9zaXRvcnkgPSB7XG4gICAgICAgIHR5cGU6IFwiZ2l0XCIsXG4gICAgICAgIHVybDogZGF0YS5yZXBvc2l0b3J5XG4gICAgICB9XG4gICAgfVxuICAgIHZhciByID0gZGF0YS5yZXBvc2l0b3J5LnVybCB8fCBcIlwiXG4gICAgaWYgKHIpIHtcbiAgICAgIHZhciBob3N0ZWQgPSBob3N0ZWRHaXRJbmZvLmZyb21VcmwocilcbiAgICAgIGlmIChob3N0ZWQpIHtcbiAgICAgICAgciA9IGRhdGEucmVwb3NpdG9yeS51cmxcbiAgICAgICAgICA9IGhvc3RlZC5nZXREZWZhdWx0UmVwcmVzZW50YXRpb24oKSA9PSBcInNob3J0Y3V0XCIgPyBob3N0ZWQuaHR0cHMoKSA6IGhvc3RlZC50b1N0cmluZygpXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHIubWF0Y2goL2dpdGh1Yi5jb21cXC9bXlxcL10rXFwvW15cXC9dK1xcLmdpdFxcLmdpdCQvKSkge1xuICAgICAgdGhpcy53YXJuKFwiYnJva2VuR2l0VXJsXCIsIHIpXG4gICAgfVxuICB9XG5cbiwgZml4VHlwb3M6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBPYmplY3Qua2V5cyh0eXBvcy50b3BMZXZlbCkuZm9yRWFjaChmdW5jdGlvbiAoZCkge1xuICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoZCkpIHtcbiAgICAgICAgdGhpcy53YXJuKFwidHlwb1wiLCBkLCB0eXBvcy50b3BMZXZlbFtkXSlcbiAgICAgIH1cbiAgICB9LCB0aGlzKVxuICB9XG5cbiwgZml4U2NyaXB0c0ZpZWxkOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgaWYgKCFkYXRhLnNjcmlwdHMpIHJldHVyblxuICAgIGlmICh0eXBlb2YgZGF0YS5zY3JpcHRzICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICB0aGlzLndhcm4oXCJub25PYmplY3RTY3JpcHRzXCIpXG4gICAgICBkZWxldGUgZGF0YS5zY3JpcHRzXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgT2JqZWN0LmtleXMoZGF0YS5zY3JpcHRzKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7XG4gICAgICBpZiAodHlwZW9mIGRhdGEuc2NyaXB0c1trXSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0aGlzLndhcm4oXCJub25TdHJpbmdTY3JpcHRcIilcbiAgICAgICAgZGVsZXRlIGRhdGEuc2NyaXB0c1trXVxuICAgICAgfSBlbHNlIGlmICh0eXBvcy5zY3JpcHRba10gJiYgIWRhdGEuc2NyaXB0c1t0eXBvcy5zY3JpcHRba11dKSB7XG4gICAgICAgIHRoaXMud2FybihcInR5cG9cIiwgaywgdHlwb3Muc2NyaXB0W2tdLCBcInNjcmlwdHNcIilcbiAgICAgIH1cbiAgICB9LCB0aGlzKVxuICB9XG5cbiwgZml4RmlsZXNGaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIHZhciBmaWxlcyA9IGRhdGEuZmlsZXNcbiAgICBpZiAoZmlsZXMgJiYgIUFycmF5LmlzQXJyYXkoZmlsZXMpKSB7XG4gICAgICB0aGlzLndhcm4oXCJub25BcnJheUZpbGVzXCIpXG4gICAgICBkZWxldGUgZGF0YS5maWxlc1xuICAgIH0gZWxzZSBpZiAoZGF0YS5maWxlcykge1xuICAgICAgZGF0YS5maWxlcyA9IGRhdGEuZmlsZXMuZmlsdGVyKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgaWYgKCFmaWxlIHx8IHR5cGVvZiBmaWxlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgdGhpcy53YXJuKFwiaW52YWxpZEZpbGVuYW1lXCIsIGZpbGUpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcylcbiAgICB9XG4gIH1cblxuLCBmaXhCaW5GaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIGlmICghZGF0YS5iaW4pIHJldHVybjtcbiAgICBpZiAodHlwZW9mIGRhdGEuYmluID09PSBcInN0cmluZ1wiKSB7XG4gICAgICB2YXIgYiA9IHt9XG4gICAgICB2YXIgbWF0Y2hcbiAgICAgIGlmIChtYXRjaCA9IGRhdGEubmFtZS5tYXRjaCgvXkBbXi9dK1svXSguKikkLykpIHtcbiAgICAgICAgYlttYXRjaFsxXV0gPSBkYXRhLmJpblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYltkYXRhLm5hbWVdID0gZGF0YS5iaW5cbiAgICAgIH1cbiAgICAgIGRhdGEuYmluID0gYlxuICAgIH1cbiAgfVxuXG4sIGZpeE1hbkZpZWxkOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgaWYgKCFkYXRhLm1hbikgcmV0dXJuO1xuICAgIGlmICh0eXBlb2YgZGF0YS5tYW4gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIGRhdGEubWFuID0gWyBkYXRhLm1hbiBdXG4gICAgfVxuICB9XG4sIGZpeEJ1bmRsZURlcGVuZGVuY2llc0ZpZWxkOiBmdW5jdGlvbihkYXRhKSB7XG4gICAgdmFyIGJkZCA9IFwiYnVuZGxlZERlcGVuZGVuY2llc1wiXG4gICAgdmFyIGJkID0gXCJidW5kbGVEZXBlbmRlbmNpZXNcIlxuICAgIGlmIChkYXRhW2JkZF0gJiYgIWRhdGFbYmRdKSB7XG4gICAgICBkYXRhW2JkXSA9IGRhdGFbYmRkXVxuICAgICAgZGVsZXRlIGRhdGFbYmRkXVxuICAgIH1cbiAgICBpZiAoZGF0YVtiZF0gJiYgIUFycmF5LmlzQXJyYXkoZGF0YVtiZF0pKSB7XG4gICAgICB0aGlzLndhcm4oXCJub25BcnJheUJ1bmRsZURlcGVuZGVuY2llc1wiKVxuICAgICAgZGVsZXRlIGRhdGFbYmRdXG4gICAgfSBlbHNlIGlmIChkYXRhW2JkXSkge1xuICAgICAgZGF0YVtiZF0gPSBkYXRhW2JkXS5maWx0ZXIoZnVuY3Rpb24oYmQpIHtcbiAgICAgICAgaWYgKCFiZCB8fCB0eXBlb2YgYmQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgdGhpcy53YXJuKFwibm9uU3RyaW5nQnVuZGxlRGVwZW5kZW5jeVwiLCBiZClcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIWRhdGEuZGVwZW5kZW5jaWVzKSB7XG4gICAgICAgICAgICBkYXRhLmRlcGVuZGVuY2llcyA9IHt9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghZGF0YS5kZXBlbmRlbmNpZXMuaGFzT3duUHJvcGVydHkoYmQpKSB7XG4gICAgICAgICAgICB0aGlzLndhcm4oXCJub25EZXBlbmRlbmN5QnVuZGxlRGVwZW5kZW5jeVwiLCBiZClcbiAgICAgICAgICAgIGRhdGEuZGVwZW5kZW5jaWVzW2JkXSA9IFwiKlwiXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMpXG4gICAgfVxuICB9XG5cbiwgZml4RGVwZW5kZW5jaWVzOiBmdW5jdGlvbihkYXRhLCBzdHJpY3QpIHtcbiAgICB2YXIgbG9vc2UgPSAhc3RyaWN0XG4gICAgb2JqZWN0aWZ5RGVwcyhkYXRhLCB0aGlzLndhcm4pXG4gICAgYWRkT3B0aW9uYWxEZXBzVG9EZXBzKGRhdGEsIHRoaXMud2FybilcbiAgICB0aGlzLmZpeEJ1bmRsZURlcGVuZGVuY2llc0ZpZWxkKGRhdGEpXG5cbiAgICA7WydkZXBlbmRlbmNpZXMnLCdkZXZEZXBlbmRlbmNpZXMnXS5mb3JFYWNoKGZ1bmN0aW9uKGRlcHMpIHtcbiAgICAgIGlmICghKGRlcHMgaW4gZGF0YSkpIHJldHVyblxuICAgICAgaWYgKCFkYXRhW2RlcHNdIHx8IHR5cGVvZiBkYXRhW2RlcHNdICE9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIHRoaXMud2FybihcIm5vbk9iamVjdERlcGVuZGVuY2llc1wiLCBkZXBzKVxuICAgICAgICBkZWxldGUgZGF0YVtkZXBzXVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIE9iamVjdC5rZXlzKGRhdGFbZGVwc10pLmZvckVhY2goZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIHIgPSBkYXRhW2RlcHNdW2RdXG4gICAgICAgIGlmICh0eXBlb2YgciAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aGlzLndhcm4oXCJub25TdHJpbmdEZXBlbmRlbmN5XCIsIGQsIEpTT04uc3RyaW5naWZ5KHIpKVxuICAgICAgICAgIGRlbGV0ZSBkYXRhW2RlcHNdW2RdXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhvc3RlZCA9IGhvc3RlZEdpdEluZm8uZnJvbVVybChkYXRhW2RlcHNdW2RdKVxuICAgICAgICBpZiAoaG9zdGVkKSBkYXRhW2RlcHNdW2RdID0gaG9zdGVkLnRvU3RyaW5nKClcbiAgICAgIH0sIHRoaXMpXG4gICAgfSwgdGhpcylcbiAgfVxuXG4sIGZpeE1vZHVsZXNGaWVsZDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAoZGF0YS5tb2R1bGVzKSB7XG4gICAgICB0aGlzLndhcm4oXCJkZXByZWNhdGVkTW9kdWxlc1wiKVxuICAgICAgZGVsZXRlIGRhdGEubW9kdWxlc1xuICAgIH1cbiAgfVxuXG4sIGZpeEtleXdvcmRzRmllbGQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKHR5cGVvZiBkYXRhLmtleXdvcmRzID09PSBcInN0cmluZ1wiKSB7XG4gICAgICBkYXRhLmtleXdvcmRzID0gZGF0YS5rZXl3b3Jkcy5zcGxpdCgvLFxccysvKVxuICAgIH1cbiAgICBpZiAoZGF0YS5rZXl3b3JkcyAmJiAhQXJyYXkuaXNBcnJheShkYXRhLmtleXdvcmRzKSkge1xuICAgICAgZGVsZXRlIGRhdGEua2V5d29yZHNcbiAgICAgIHRoaXMud2FybihcIm5vbkFycmF5S2V5d29yZHNcIilcbiAgICB9IGVsc2UgaWYgKGRhdGEua2V5d29yZHMpIHtcbiAgICAgIGRhdGEua2V5d29yZHMgPSBkYXRhLmtleXdvcmRzLmZpbHRlcihmdW5jdGlvbihrdykge1xuICAgICAgICBpZiAodHlwZW9mIGt3ICE9PSBcInN0cmluZ1wiIHx8ICFrdykge1xuICAgICAgICAgIHRoaXMud2FybihcIm5vblN0cmluZ0tleXdvcmRcIik7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcylcbiAgICB9XG4gIH1cblxuLCBmaXhWZXJzaW9uRmllbGQ6IGZ1bmN0aW9uKGRhdGEsIHN0cmljdCkge1xuICAgIC8vIGFsbG93IFwibG9vc2VcIiBzZW12ZXIgMS4wIHZlcnNpb25zIGluIG5vbi1zdHJpY3QgbW9kZVxuICAgIC8vIGVuZm9yY2Ugc3RyaWN0IHNlbXZlciAyLjAgY29tcGxpYW5jZSBpbiBzdHJpY3QgbW9kZVxuICAgIHZhciBsb29zZSA9ICFzdHJpY3RcbiAgICBpZiAoIWRhdGEudmVyc2lvbikge1xuICAgICAgZGF0YS52ZXJzaW9uID0gXCJcIlxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgaWYgKCFzZW12ZXIudmFsaWQoZGF0YS52ZXJzaW9uLCBsb29zZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB2ZXJzaW9uOiBcIicrIGRhdGEudmVyc2lvbiArICdcIicpXG4gICAgfVxuICAgIGRhdGEudmVyc2lvbiA9IHNlbXZlci5jbGVhbihkYXRhLnZlcnNpb24sIGxvb3NlKVxuICAgIHJldHVybiB0cnVlXG4gIH1cblxuLCBmaXhQZW9wbGU6IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICBtb2RpZnlQZW9wbGUoZGF0YSwgdW5QYXJzZVBlcnNvbilcbiAgICBtb2RpZnlQZW9wbGUoZGF0YSwgcGFyc2VQZXJzb24pXG4gIH1cblxuLCBmaXhOYW1lRmllbGQ6IGZ1bmN0aW9uKGRhdGEsIG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwiYm9vbGVhblwiKSBvcHRpb25zID0ge3N0cmljdDogb3B0aW9uc31cbiAgICBlbHNlIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gXCJ1bmRlZmluZWRcIikgb3B0aW9ucyA9IHt9XG4gICAgdmFyIHN0cmljdCA9IG9wdGlvbnMuc3RyaWN0XG4gICAgaWYgKCFkYXRhLm5hbWUgJiYgIXN0cmljdCkge1xuICAgICAgZGF0YS5uYW1lID0gXCJcIlxuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGlmICh0eXBlb2YgZGF0YS5uYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJuYW1lIGZpZWxkIG11c3QgYmUgYSBzdHJpbmcuXCIpXG4gICAgfVxuICAgIGlmICghc3RyaWN0KVxuICAgICAgZGF0YS5uYW1lID0gZGF0YS5uYW1lLnRyaW0oKVxuICAgIGVuc3VyZVZhbGlkTmFtZShkYXRhLm5hbWUsIHN0cmljdCwgb3B0aW9ucy5hbGxvd0xlZ2FjeUNhc2UpXG4gICAgaWYgKGlzQnVpbHRpbk1vZHVsZShkYXRhLm5hbWUpKVxuICAgICAgdGhpcy53YXJuKFwiY29uZmxpY3RpbmdOYW1lXCIsIGRhdGEubmFtZSlcbiAgfVxuXG5cbiwgZml4RGVzY3JpcHRpb25GaWVsZDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBpZiAoZGF0YS5kZXNjcmlwdGlvbiAmJiB0eXBlb2YgZGF0YS5kZXNjcmlwdGlvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgIHRoaXMud2FybihcIm5vblN0cmluZ0Rlc2NyaXB0aW9uXCIpXG4gICAgICBkZWxldGUgZGF0YS5kZXNjcmlwdGlvblxuICAgIH1cbiAgICBpZiAoZGF0YS5yZWFkbWUgJiYgIWRhdGEuZGVzY3JpcHRpb24pXG4gICAgICBkYXRhLmRlc2NyaXB0aW9uID0gZXh0cmFjdERlc2NyaXB0aW9uKGRhdGEucmVhZG1lKVxuICAgICAgaWYoZGF0YS5kZXNjcmlwdGlvbiA9PT0gdW5kZWZpbmVkKSBkZWxldGUgZGF0YS5kZXNjcmlwdGlvbjtcbiAgICBpZiAoIWRhdGEuZGVzY3JpcHRpb24pIHRoaXMud2FybihcIm1pc3NpbmdEZXNjcmlwdGlvblwiKVxuICB9XG5cbiwgZml4UmVhZG1lRmllbGQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgaWYgKCFkYXRhLnJlYWRtZSkge1xuICAgICAgdGhpcy53YXJuKFwibWlzc2luZ1JlYWRtZVwiKVxuICAgICAgZGF0YS5yZWFkbWUgPSBcIkVSUk9SOiBObyBSRUFETUUgZGF0YSBmb3VuZCFcIlxuICAgIH1cbiAgfVxuXG4sIGZpeEJ1Z3NGaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIGlmICghZGF0YS5idWdzICYmIGRhdGEucmVwb3NpdG9yeSAmJiBkYXRhLnJlcG9zaXRvcnkudXJsKSB7XG4gICAgICB2YXIgaG9zdGVkID0gaG9zdGVkR2l0SW5mby5mcm9tVXJsKGRhdGEucmVwb3NpdG9yeS51cmwpXG4gICAgICBpZihob3N0ZWQgJiYgaG9zdGVkLmJ1Z3MoKSkge1xuICAgICAgICBkYXRhLmJ1Z3MgPSB7dXJsOiBob3N0ZWQuYnVncygpfVxuICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmKGRhdGEuYnVncykge1xuICAgICAgdmFyIGVtYWlsUmUgPSAvXi4rQC4qXFwuLiskL1xuICAgICAgaWYodHlwZW9mIGRhdGEuYnVncyA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlmKGVtYWlsUmUudGVzdChkYXRhLmJ1Z3MpKVxuICAgICAgICAgIGRhdGEuYnVncyA9IHtlbWFpbDpkYXRhLmJ1Z3N9XG4gICAgICAgIGVsc2UgaWYodXJsLnBhcnNlKGRhdGEuYnVncykucHJvdG9jb2wpXG4gICAgICAgICAgZGF0YS5idWdzID0ge3VybDogZGF0YS5idWdzfVxuICAgICAgICBlbHNlXG4gICAgICAgICAgdGhpcy53YXJuKFwibm9uRW1haWxVcmxCdWdzU3RyaW5nXCIpXG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgYnVnc1R5cG9zKGRhdGEuYnVncywgdGhpcy53YXJuKVxuICAgICAgICB2YXIgb2xkQnVncyA9IGRhdGEuYnVnc1xuICAgICAgICBkYXRhLmJ1Z3MgPSB7fVxuICAgICAgICBpZihvbGRCdWdzLnVybCkge1xuICAgICAgICAgIGlmKHR5cGVvZihvbGRCdWdzLnVybCkgPT0gXCJzdHJpbmdcIiAmJiB1cmwucGFyc2Uob2xkQnVncy51cmwpLnByb3RvY29sKVxuICAgICAgICAgICAgZGF0YS5idWdzLnVybCA9IG9sZEJ1Z3MudXJsXG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgdGhpcy53YXJuKFwibm9uVXJsQnVnc1VybEZpZWxkXCIpXG4gICAgICAgIH1cbiAgICAgICAgaWYob2xkQnVncy5lbWFpbCkge1xuICAgICAgICAgIGlmKHR5cGVvZihvbGRCdWdzLmVtYWlsKSA9PSBcInN0cmluZ1wiICYmIGVtYWlsUmUudGVzdChvbGRCdWdzLmVtYWlsKSlcbiAgICAgICAgICAgIGRhdGEuYnVncy5lbWFpbCA9IG9sZEJ1Z3MuZW1haWxcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLndhcm4oXCJub25FbWFpbEJ1Z3NFbWFpbEZpZWxkXCIpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCFkYXRhLmJ1Z3MuZW1haWwgJiYgIWRhdGEuYnVncy51cmwpIHtcbiAgICAgICAgZGVsZXRlIGRhdGEuYnVnc1xuICAgICAgICB0aGlzLndhcm4oXCJlbXB0eU5vcm1hbGl6ZWRCdWdzXCIpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiwgZml4SG9tZXBhZ2VGaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIGlmICghZGF0YS5ob21lcGFnZSAmJiBkYXRhLnJlcG9zaXRvcnkgJiYgZGF0YS5yZXBvc2l0b3J5LnVybCkge1xuICAgICAgdmFyIGhvc3RlZCA9IGhvc3RlZEdpdEluZm8uZnJvbVVybChkYXRhLnJlcG9zaXRvcnkudXJsKVxuICAgICAgaWYgKGhvc3RlZCAmJiBob3N0ZWQuZG9jcygpKSBkYXRhLmhvbWVwYWdlID0gaG9zdGVkLmRvY3MoKVxuICAgIH1cbiAgICBpZiAoIWRhdGEuaG9tZXBhZ2UpIHJldHVyblxuXG4gICAgaWYodHlwZW9mIGRhdGEuaG9tZXBhZ2UgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMud2FybihcIm5vblVybEhvbWVwYWdlXCIpXG4gICAgICByZXR1cm4gZGVsZXRlIGRhdGEuaG9tZXBhZ2VcbiAgICB9XG4gICAgaWYoIXVybC5wYXJzZShkYXRhLmhvbWVwYWdlKS5wcm90b2NvbCkge1xuICAgICAgZGF0YS5ob21lcGFnZSA9IFwiaHR0cDovL1wiICsgZGF0YS5ob21lcGFnZVxuICAgIH1cbiAgfVxuXG4sIGZpeExpY2Vuc2VGaWVsZDogZnVuY3Rpb24oZGF0YSkge1xuICAgIGlmICghZGF0YS5saWNlbnNlKSB7XG4gICAgICByZXR1cm4gdGhpcy53YXJuKFwibWlzc2luZ0xpY2Vuc2VcIilcbiAgICB9IGVsc2V7XG4gICAgICBpZiAoXG4gICAgICAgIHR5cGVvZihkYXRhLmxpY2Vuc2UpICE9PSAnc3RyaW5nJyB8fFxuICAgICAgICBkYXRhLmxpY2Vuc2UubGVuZ3RoIDwgMVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMud2FybihcImludmFsaWRMaWNlbnNlXCIpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIXZhbGlkYXRlTGljZW5zZShkYXRhLmxpY2Vuc2UpLnZhbGlkRm9yTmV3UGFja2FnZXMpXG4gICAgICAgICAgdGhpcy53YXJuKFwiaW52YWxpZExpY2Vuc2VcIilcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNWYWxpZFNjb3BlZFBhY2thZ2VOYW1lKHNwZWMpIHtcbiAgaWYgKHNwZWMuY2hhckF0KDApICE9PSAnQCcpIHJldHVybiBmYWxzZVxuXG4gIHZhciByZXN0ID0gc3BlYy5zbGljZSgxKS5zcGxpdCgnLycpXG4gIGlmIChyZXN0Lmxlbmd0aCAhPT0gMikgcmV0dXJuIGZhbHNlXG5cbiAgcmV0dXJuIHJlc3RbMF0gJiYgcmVzdFsxXSAmJlxuICAgIHJlc3RbMF0gPT09IGVuY29kZVVSSUNvbXBvbmVudChyZXN0WzBdKSAmJlxuICAgIHJlc3RbMV0gPT09IGVuY29kZVVSSUNvbXBvbmVudChyZXN0WzFdKVxufVxuXG5mdW5jdGlvbiBpc0NvcnJlY3RseUVuY29kZWROYW1lKHNwZWMpIHtcbiAgcmV0dXJuICFzcGVjLm1hdGNoKC9bXFwvQFxcc1xcKyU6XS8pICYmXG4gICAgc3BlYyA9PT0gZW5jb2RlVVJJQ29tcG9uZW50KHNwZWMpXG59XG5cbmZ1bmN0aW9uIGVuc3VyZVZhbGlkTmFtZSAobmFtZSwgc3RyaWN0LCBhbGxvd0xlZ2FjeUNhc2UpIHtcbiAgaWYgKG5hbWUuY2hhckF0KDApID09PSBcIi5cIiB8fFxuICAgICAgIShpc1ZhbGlkU2NvcGVkUGFja2FnZU5hbWUobmFtZSkgfHwgaXNDb3JyZWN0bHlFbmNvZGVkTmFtZShuYW1lKSkgfHxcbiAgICAgIChzdHJpY3QgJiYgKCFhbGxvd0xlZ2FjeUNhc2UpICYmIG5hbWUgIT09IG5hbWUudG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgIG5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJub2RlX21vZHVsZXNcIiB8fFxuICAgICAgbmFtZS50b0xvd2VyQ2FzZSgpID09PSBcImZhdmljb24uaWNvXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBuYW1lOiBcIiArIEpTT04uc3RyaW5naWZ5KG5hbWUpKVxuICB9XG59XG5cbmZ1bmN0aW9uIG1vZGlmeVBlb3BsZSAoZGF0YSwgZm4pIHtcbiAgaWYgKGRhdGEuYXV0aG9yKSBkYXRhLmF1dGhvciA9IGZuKGRhdGEuYXV0aG9yKVxuICA7W1wibWFpbnRhaW5lcnNcIiwgXCJjb250cmlidXRvcnNcIl0uZm9yRWFjaChmdW5jdGlvbiAoc2V0KSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGRhdGFbc2V0XSkpIHJldHVybjtcbiAgICBkYXRhW3NldF0gPSBkYXRhW3NldF0ubWFwKGZuKVxuICB9KVxuICByZXR1cm4gZGF0YVxufVxuXG5mdW5jdGlvbiB1blBhcnNlUGVyc29uIChwZXJzb24pIHtcbiAgaWYgKHR5cGVvZiBwZXJzb24gPT09IFwic3RyaW5nXCIpIHJldHVybiBwZXJzb25cbiAgdmFyIG5hbWUgPSBwZXJzb24ubmFtZSB8fCBcIlwiXG4gIHZhciB1ID0gcGVyc29uLnVybCB8fCBwZXJzb24ud2ViXG4gIHZhciB1cmwgPSB1ID8gKFwiIChcIit1K1wiKVwiKSA6IFwiXCJcbiAgdmFyIGUgPSBwZXJzb24uZW1haWwgfHwgcGVyc29uLm1haWxcbiAgdmFyIGVtYWlsID0gZSA/IChcIiA8XCIrZStcIj5cIikgOiBcIlwiXG4gIHJldHVybiBuYW1lK2VtYWlsK3VybFxufVxuXG5mdW5jdGlvbiBwYXJzZVBlcnNvbiAocGVyc29uKSB7XG4gIGlmICh0eXBlb2YgcGVyc29uICE9PSBcInN0cmluZ1wiKSByZXR1cm4gcGVyc29uXG4gIHZhciBuYW1lID0gcGVyc29uLm1hdGNoKC9eKFteXFwoPF0rKS8pXG4gIHZhciB1cmwgPSBwZXJzb24ubWF0Y2goL1xcKChbXlxcKV0rKVxcKS8pXG4gIHZhciBlbWFpbCA9IHBlcnNvbi5tYXRjaCgvPChbXj5dKyk+LylcbiAgdmFyIG9iaiA9IHt9XG4gIGlmIChuYW1lICYmIG5hbWVbMF0udHJpbSgpKSBvYmoubmFtZSA9IG5hbWVbMF0udHJpbSgpXG4gIGlmIChlbWFpbCkgb2JqLmVtYWlsID0gZW1haWxbMV07XG4gIGlmICh1cmwpIG9iai51cmwgPSB1cmxbMV07XG4gIHJldHVybiBvYmpcbn1cblxuZnVuY3Rpb24gYWRkT3B0aW9uYWxEZXBzVG9EZXBzIChkYXRhLCB3YXJuKSB7XG4gIHZhciBvID0gZGF0YS5vcHRpb25hbERlcGVuZGVuY2llc1xuICBpZiAoIW8pIHJldHVybjtcbiAgdmFyIGQgPSBkYXRhLmRlcGVuZGVuY2llcyB8fCB7fVxuICBPYmplY3Qua2V5cyhvKS5mb3JFYWNoKGZ1bmN0aW9uIChrKSB7XG4gICAgZFtrXSA9IG9ba11cbiAgfSlcbiAgZGF0YS5kZXBlbmRlbmNpZXMgPSBkXG59XG5cbmZ1bmN0aW9uIGRlcE9iamVjdGlmeSAoZGVwcywgdHlwZSwgd2Fybikge1xuICBpZiAoIWRlcHMpIHJldHVybiB7fVxuICBpZiAodHlwZW9mIGRlcHMgPT09IFwic3RyaW5nXCIpIHtcbiAgICBkZXBzID0gZGVwcy50cmltKCkuc3BsaXQoL1tcXG5cXHJcXHNcXHQgLF0rLylcbiAgfVxuICBpZiAoIUFycmF5LmlzQXJyYXkoZGVwcykpIHJldHVybiBkZXBzXG4gIHdhcm4oXCJkZXByZWNhdGVkQXJyYXlEZXBlbmRlbmNpZXNcIiwgdHlwZSlcbiAgdmFyIG8gPSB7fVxuICBkZXBzLmZpbHRlcihmdW5jdGlvbiAoZCkge1xuICAgIHJldHVybiB0eXBlb2YgZCA9PT0gXCJzdHJpbmdcIlxuICB9KS5mb3JFYWNoKGZ1bmN0aW9uKGQpIHtcbiAgICBkID0gZC50cmltKCkuc3BsaXQoLyg6P1tAXFxzPjw9XSkvKVxuICAgIHZhciBkbiA9IGQuc2hpZnQoKVxuICAgIHZhciBkdiA9IGQuam9pbihcIlwiKVxuICAgIGR2ID0gZHYudHJpbSgpXG4gICAgZHYgPSBkdi5yZXBsYWNlKC9eQC8sIFwiXCIpXG4gICAgb1tkbl0gPSBkdlxuICB9KVxuICByZXR1cm4gb1xufVxuXG5mdW5jdGlvbiBvYmplY3RpZnlEZXBzIChkYXRhLCB3YXJuKSB7XG4gIGRlcFR5cGVzLmZvckVhY2goZnVuY3Rpb24gKHR5cGUpIHtcbiAgICBpZiAoIWRhdGFbdHlwZV0pIHJldHVybjtcbiAgICBkYXRhW3R5cGVdID0gZGVwT2JqZWN0aWZ5KGRhdGFbdHlwZV0sIHR5cGUsIHdhcm4pXG4gIH0pXG59XG5cbmZ1bmN0aW9uIGJ1Z3NUeXBvcyhidWdzLCB3YXJuKSB7XG4gIGlmICghYnVncykgcmV0dXJuXG4gIE9iamVjdC5rZXlzKGJ1Z3MpLmZvckVhY2goZnVuY3Rpb24gKGspIHtcbiAgICBpZiAodHlwb3MuYnVnc1trXSkge1xuICAgICAgd2FybihcInR5cG9cIiwgaywgdHlwb3MuYnVnc1trXSwgXCJidWdzXCIpXG4gICAgICBidWdzW3R5cG9zLmJ1Z3Nba11dID0gYnVnc1trXVxuICAgICAgZGVsZXRlIGJ1Z3Nba11cbiAgICB9XG4gIH0pXG59XG4iXX0=