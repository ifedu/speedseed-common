'use strict';
var EventEmitter = require('events');
var http = require('http');
var https = require('https');
var PassThrough = require('stream').PassThrough;
var urlLib = require('url');
var querystring = require('querystring');
var duplexer3 = require('duplexer3');
var isStream = require('is-stream');
var getStream = require('get-stream');
var timedOut = require('timed-out');
var urlParseLax = require('url-parse-lax');
var lowercaseKeys = require('lowercase-keys');
var isRedirect = require('is-redirect');
var unzipResponse = require('unzip-response');
var createErrorClass = require('create-error-class');
var isRetryAllowed = require('is-retry-allowed');
var Buffer = require('safe-buffer').Buffer;
var pkg = require('./package');
function requestAsEventEmitter(opts) {
    opts = opts || {};
    var ee = new EventEmitter();
    var requestUrl = opts.href || urlLib.resolve(urlLib.format(opts), opts.path);
    var redirectCount = 0;
    var retryCount = 0;
    var redirectUrl;
    var get = function (opts) {
        var fn = opts.protocol === 'https:' ? https : http;
        var req = fn.request(opts, function (res) {
            var statusCode = res.statusCode;
            if (isRedirect(statusCode) && opts.followRedirect && 'location' in res.headers && (opts.method === 'GET' || opts.method === 'HEAD')) {
                res.resume();
                if (++redirectCount > 10) {
                    ee.emit('error', new got.MaxRedirectsError(statusCode, opts), null, res);
                    return;
                }
                var bufferString = Buffer.from(res.headers.location, 'binary').toString();
                redirectUrl = urlLib.resolve(urlLib.format(opts), bufferString);
                var redirectOpts = Object.assign({}, opts, urlLib.parse(redirectUrl));
                ee.emit('redirect', res, redirectOpts);
                get(redirectOpts);
                return;
            }
            setImmediate(function () {
                var response = typeof unzipResponse === 'function' && req.method !== 'HEAD' ? unzipResponse(res) : res;
                response.url = redirectUrl || requestUrl;
                response.requestUrl = requestUrl;
                ee.emit('response', response);
            });
        });
        req.once('error', function (err) {
            var backoff = opts.retries(++retryCount, err);
            if (backoff) {
                setTimeout(get, backoff, opts);
                return;
            }
            ee.emit('error', new got.RequestError(err, opts));
        });
        if (opts.gotTimeout) {
            timedOut(req, opts.gotTimeout);
        }
        setImmediate(function () {
            ee.emit('request', req);
        });
    };
    get(opts);
    return ee;
}
function asPromise(opts) {
    return new Promise(function (resolve, reject) {
        var ee = requestAsEventEmitter(opts);
        ee.on('request', function (req) {
            if (isStream(opts.body)) {
                opts.body.pipe(req);
                opts.body = undefined;
                return;
            }
            req.end(opts.body);
        });
        ee.on('response', function (res) {
            var stream = opts.encoding === null ? getStream.buffer(res) : getStream(res, opts);
            stream
                .catch(function (err) { return reject(new got.ReadError(err, opts)); })
                .then(function (data) {
                var statusCode = res.statusCode;
                var limitStatusCode = opts.followRedirect ? 299 : 399;
                res.body = data;
                if (opts.json && res.body) {
                    try {
                        res.body = JSON.parse(res.body);
                    }
                    catch (e) {
                        throw new got.ParseError(e, statusCode, opts, data);
                    }
                }
                if (statusCode < 200 || statusCode > limitStatusCode) {
                    throw new got.HTTPError(statusCode, opts);
                }
                resolve(res);
            })
                .catch(function (err) {
                Object.defineProperty(err, 'response', { value: res });
                reject(err);
            });
        });
        ee.on('error', reject);
    });
}
function asStream(opts) {
    var input = new PassThrough();
    var output = new PassThrough();
    var proxy = duplexer3(input, output);
    if (opts.json) {
        throw new Error('got can not be used as stream when options.json is used');
    }
    if (opts.body) {
        proxy.write = function () {
            throw new Error('got\'s stream is not writable when options.body is used');
        };
    }
    var ee = requestAsEventEmitter(opts);
    ee.on('request', function (req) {
        proxy.emit('request', req);
        if (isStream(opts.body)) {
            opts.body.pipe(req);
            return;
        }
        if (opts.body) {
            req.end(opts.body);
            return;
        }
        if (opts.method === 'POST' || opts.method === 'PUT' || opts.method === 'PATCH') {
            input.pipe(req);
            return;
        }
        req.end();
    });
    ee.on('response', function (res) {
        var statusCode = res.statusCode;
        res.pipe(output);
        if (statusCode < 200 || statusCode > 299) {
            proxy.emit('error', new got.HTTPError(statusCode, opts), null, res);
            return;
        }
        proxy.emit('response', res);
    });
    ee.on('redirect', proxy.emit.bind(proxy, 'redirect'));
    ee.on('error', proxy.emit.bind(proxy, 'error'));
    return proxy;
}
function normalizeArguments(url, opts) {
    if (typeof url !== 'string' && typeof url !== 'object') {
        throw new Error("Parameter `url` must be a string or object, not " + typeof url);
    }
    if (typeof url === 'string') {
        url = url.replace(/^unix:/, 'http://$&');
        url = urlParseLax(url);
        if (url.auth) {
            throw new Error('Basic authentication must be done with auth option');
        }
    }
    opts = Object.assign({
        protocol: 'http:',
        path: '',
        retries: 5
    }, url, opts);
    opts.headers = Object.assign({
        'user-agent': pkg.name + "/" + pkg.version + " (https://github.com/sindresorhus/got)",
        'accept-encoding': 'gzip,deflate'
    }, lowercaseKeys(opts.headers));
    var query = opts.query;
    if (query) {
        if (typeof query !== 'string') {
            opts.query = querystring.stringify(query);
        }
        opts.path = opts.path.split('?')[0] + "?" + opts.query;
        delete opts.query;
    }
    if (opts.json && opts.headers.accept === undefined) {
        opts.headers.accept = 'application/json';
    }
    var body = opts.body;
    if (body) {
        if (typeof body !== 'string' && !(body !== null && typeof body === 'object')) {
            throw new Error('options.body must be a ReadableStream, string, Buffer or plain Object');
        }
        opts.method = opts.method || 'POST';
        if (isStream(body) && typeof body.getBoundary === 'function') {
            // Special case for https://github.com/form-data/form-data
            opts.headers['content-type'] = opts.headers['content-type'] || "multipart/form-data; boundary=" + body.getBoundary();
        }
        else if (body !== null && typeof body === 'object' && !Buffer.isBuffer(body) && !isStream(body)) {
            opts.headers['content-type'] = opts.headers['content-type'] || 'application/x-www-form-urlencoded';
            body = opts.body = querystring.stringify(body);
        }
        if (opts.headers['content-length'] === undefined && opts.headers['transfer-encoding'] === undefined && !isStream(body)) {
            var length = typeof body === 'string' ? Buffer.byteLength(body) : body.length;
            opts.headers['content-length'] = length;
        }
    }
    opts.method = (opts.method || 'GET').toUpperCase();
    if (opts.hostname === 'unix') {
        var matches = /(.+):(.+)/.exec(opts.path);
        if (matches) {
            opts.socketPath = matches[1];
            opts.path = matches[2];
            opts.host = null;
        }
    }
    if (typeof opts.retries !== 'function') {
        var retries_1 = opts.retries;
        opts.retries = function (iter, err) {
            if (iter > retries_1 || !isRetryAllowed(err)) {
                return 0;
            }
            var noise = Math.random() * 100;
            return ((1 << iter) * 1000) + noise;
        };
    }
    if (opts.followRedirect === undefined) {
        opts.followRedirect = true;
    }
    if (opts.timeout) {
        opts.gotTimeout = opts.timeout;
        delete opts.timeout;
    }
    return opts;
}
function got(url, opts) {
    try {
        return asPromise(normalizeArguments(url, opts));
    }
    catch (err) {
        return Promise.reject(err);
    }
}
var helpers = [
    'get',
    'post',
    'put',
    'patch',
    'head',
    'delete'
];
helpers.forEach(function (el) {
    got[el] = function (url, opts) { return got(url, Object.assign({}, opts, { method: el })); };
});
got.stream = function (url, opts) { return asStream(normalizeArguments(url, opts)); };
var _loop_1 = function (el) {
    got.stream[el] = function (url, opts) { return got.stream(url, Object.assign({}, opts, { method: el })); };
};
for (var _i = 0, helpers_1 = helpers; _i < helpers_1.length; _i++) {
    var el = helpers_1[_i];
    _loop_1(el);
}
function stdError(error, opts) {
    if (error.code !== undefined) {
        this.code = error.code;
    }
    Object.assign(this, {
        message: error.message,
        host: opts.host,
        hostname: opts.hostname,
        method: opts.method,
        path: opts.path
    });
}
got.RequestError = createErrorClass('RequestError', stdError);
got.ReadError = createErrorClass('ReadError', stdError);
got.ParseError = createErrorClass('ParseError', function (e, statusCode, opts, data) {
    stdError.call(this, e, opts);
    this.statusCode = statusCode;
    this.statusMessage = http.STATUS_CODES[this.statusCode];
    this.message = e.message + " in \"" + urlLib.format(opts) + "\": \n" + data.slice(0, 77) + "...";
});
got.HTTPError = createErrorClass('HTTPError', function (statusCode, opts) {
    stdError.call(this, {}, opts);
    this.statusCode = statusCode;
    this.statusMessage = http.STATUS_CODES[this.statusCode];
    this.message = "Response code " + this.statusCode + " (" + this.statusMessage + ")";
});
got.MaxRedirectsError = createErrorClass('MaxRedirectsError', function (statusCode, opts) {
    stdError.call(this, {}, opts);
    this.statusCode = statusCode;
    this.statusMessage = http.STATUS_CODES[this.statusCode];
    this.message = 'Redirected 10 times. Aborting.';
});
module.exports = got;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxpZmVkdVxcQXBwRGF0YVxcUm9hbWluZ1xcbnZtXFx2OC40LjBcXG5vZGVfbW9kdWxlc1xcZ2VuZXJhdG9yLXNwZWVkc2VlZFxcbm9kZV9tb2R1bGVzXFxnb3RcXGluZGV4LmpzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXGlmZWR1XFxBcHBEYXRhXFxSb2FtaW5nXFxudm1cXHY4LjQuMFxcbm9kZV9tb2R1bGVzXFxnZW5lcmF0b3Itc3BlZWRzZWVkXFxub2RlX21vZHVsZXNcXGdvdFxcaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBQ2IsSUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ3ZDLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUM3QixJQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDL0IsSUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFdBQVcsQ0FBQztBQUNsRCxJQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDOUIsSUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzNDLElBQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN2QyxJQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDdEMsSUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3hDLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUN0QyxJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDN0MsSUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7QUFDaEQsSUFBTSxVQUFVLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FB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QUksQ0FBQyxDQUFDO0lBQzlCLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0lBQzdCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDeEQsSUFBSSxDQUFDLE9BQU8sR0FBRyxnQ0FBZ0MsQ0FBQztBQUNqRCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnZXZlbnRzJyk7XG5jb25zdCBodHRwID0gcmVxdWlyZSgnaHR0cCcpO1xuY29uc3QgaHR0cHMgPSByZXF1aXJlKCdodHRwcycpO1xuY29uc3QgUGFzc1Rocm91Z2ggPSByZXF1aXJlKCdzdHJlYW0nKS5QYXNzVGhyb3VnaDtcbmNvbnN0IHVybExpYiA9IHJlcXVpcmUoJ3VybCcpO1xuY29uc3QgcXVlcnlzdHJpbmcgPSByZXF1aXJlKCdxdWVyeXN0cmluZycpO1xuY29uc3QgZHVwbGV4ZXIzID0gcmVxdWlyZSgnZHVwbGV4ZXIzJyk7XG5jb25zdCBpc1N0cmVhbSA9IHJlcXVpcmUoJ2lzLXN0cmVhbScpO1xuY29uc3QgZ2V0U3RyZWFtID0gcmVxdWlyZSgnZ2V0LXN0cmVhbScpO1xuY29uc3QgdGltZWRPdXQgPSByZXF1aXJlKCd0aW1lZC1vdXQnKTtcbmNvbnN0IHVybFBhcnNlTGF4ID0gcmVxdWlyZSgndXJsLXBhcnNlLWxheCcpO1xuY29uc3QgbG93ZXJjYXNlS2V5cyA9IHJlcXVpcmUoJ2xvd2VyY2FzZS1rZXlzJyk7XG5jb25zdCBpc1JlZGlyZWN0ID0gcmVxdWlyZSgnaXMtcmVkaXJlY3QnKTtcbmNvbnN0IHVuemlwUmVzcG9uc2UgPSByZXF1aXJlKCd1bnppcC1yZXNwb25zZScpO1xuY29uc3QgY3JlYXRlRXJyb3JDbGFzcyA9IHJlcXVpcmUoJ2NyZWF0ZS1lcnJvci1jbGFzcycpO1xuY29uc3QgaXNSZXRyeUFsbG93ZWQgPSByZXF1aXJlKCdpcy1yZXRyeS1hbGxvd2VkJyk7XG5jb25zdCBCdWZmZXIgPSByZXF1aXJlKCdzYWZlLWJ1ZmZlcicpLkJ1ZmZlcjtcbmNvbnN0IHBrZyA9IHJlcXVpcmUoJy4vcGFja2FnZScpO1xuXG5mdW5jdGlvbiByZXF1ZXN0QXNFdmVudEVtaXR0ZXIob3B0cykge1xuXHRvcHRzID0gb3B0cyB8fCB7fTtcblxuXHRjb25zdCBlZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcblx0Y29uc3QgcmVxdWVzdFVybCA9IG9wdHMuaHJlZiB8fCB1cmxMaWIucmVzb2x2ZSh1cmxMaWIuZm9ybWF0KG9wdHMpLCBvcHRzLnBhdGgpO1xuXHRsZXQgcmVkaXJlY3RDb3VudCA9IDA7XG5cdGxldCByZXRyeUNvdW50ID0gMDtcblx0bGV0IHJlZGlyZWN0VXJsO1xuXG5cdGNvbnN0IGdldCA9IG9wdHMgPT4ge1xuXHRcdGNvbnN0IGZuID0gb3B0cy5wcm90b2NvbCA9PT0gJ2h0dHBzOicgPyBodHRwcyA6IGh0dHA7XG5cblx0XHRjb25zdCByZXEgPSBmbi5yZXF1ZXN0KG9wdHMsIHJlcyA9PiB7XG5cdFx0XHRjb25zdCBzdGF0dXNDb2RlID0gcmVzLnN0YXR1c0NvZGU7XG5cblx0XHRcdGlmIChpc1JlZGlyZWN0KHN0YXR1c0NvZGUpICYmIG9wdHMuZm9sbG93UmVkaXJlY3QgJiYgJ2xvY2F0aW9uJyBpbiByZXMuaGVhZGVycyAmJiAob3B0cy5tZXRob2QgPT09ICdHRVQnIHx8IG9wdHMubWV0aG9kID09PSAnSEVBRCcpKSB7XG5cdFx0XHRcdHJlcy5yZXN1bWUoKTtcblxuXHRcdFx0XHRpZiAoKytyZWRpcmVjdENvdW50ID4gMTApIHtcblx0XHRcdFx0XHRlZS5lbWl0KCdlcnJvcicsIG5ldyBnb3QuTWF4UmVkaXJlY3RzRXJyb3Ioc3RhdHVzQ29kZSwgb3B0cyksIG51bGwsIHJlcyk7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Y29uc3QgYnVmZmVyU3RyaW5nID0gQnVmZmVyLmZyb20ocmVzLmhlYWRlcnMubG9jYXRpb24sICdiaW5hcnknKS50b1N0cmluZygpO1xuXG5cdFx0XHRcdHJlZGlyZWN0VXJsID0gdXJsTGliLnJlc29sdmUodXJsTGliLmZvcm1hdChvcHRzKSwgYnVmZmVyU3RyaW5nKTtcblx0XHRcdFx0Y29uc3QgcmVkaXJlY3RPcHRzID0gT2JqZWN0LmFzc2lnbih7fSwgb3B0cywgdXJsTGliLnBhcnNlKHJlZGlyZWN0VXJsKSk7XG5cblx0XHRcdFx0ZWUuZW1pdCgncmVkaXJlY3QnLCByZXMsIHJlZGlyZWN0T3B0cyk7XG5cblx0XHRcdFx0Z2V0KHJlZGlyZWN0T3B0cyk7XG5cblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRzZXRJbW1lZGlhdGUoKCkgPT4ge1xuXHRcdFx0XHRjb25zdCByZXNwb25zZSA9IHR5cGVvZiB1bnppcFJlc3BvbnNlID09PSAnZnVuY3Rpb24nICYmIHJlcS5tZXRob2QgIT09ICdIRUFEJyA/IHVuemlwUmVzcG9uc2UocmVzKSA6IHJlcztcblx0XHRcdFx0cmVzcG9uc2UudXJsID0gcmVkaXJlY3RVcmwgfHwgcmVxdWVzdFVybDtcblx0XHRcdFx0cmVzcG9uc2UucmVxdWVzdFVybCA9IHJlcXVlc3RVcmw7XG5cblx0XHRcdFx0ZWUuZW1pdCgncmVzcG9uc2UnLCByZXNwb25zZSk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdHJlcS5vbmNlKCdlcnJvcicsIGVyciA9PiB7XG5cdFx0XHRjb25zdCBiYWNrb2ZmID0gb3B0cy5yZXRyaWVzKCsrcmV0cnlDb3VudCwgZXJyKTtcblxuXHRcdFx0aWYgKGJhY2tvZmYpIHtcblx0XHRcdFx0c2V0VGltZW91dChnZXQsIGJhY2tvZmYsIG9wdHMpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGVlLmVtaXQoJ2Vycm9yJywgbmV3IGdvdC5SZXF1ZXN0RXJyb3IoZXJyLCBvcHRzKSk7XG5cdFx0fSk7XG5cblx0XHRpZiAob3B0cy5nb3RUaW1lb3V0KSB7XG5cdFx0XHR0aW1lZE91dChyZXEsIG9wdHMuZ290VGltZW91dCk7XG5cdFx0fVxuXG5cdFx0c2V0SW1tZWRpYXRlKCgpID0+IHtcblx0XHRcdGVlLmVtaXQoJ3JlcXVlc3QnLCByZXEpO1xuXHRcdH0pO1xuXHR9O1xuXG5cdGdldChvcHRzKTtcblx0cmV0dXJuIGVlO1xufVxuXG5mdW5jdGlvbiBhc1Byb21pc2Uob3B0cykge1xuXHRyZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuXHRcdGNvbnN0IGVlID0gcmVxdWVzdEFzRXZlbnRFbWl0dGVyKG9wdHMpO1xuXG5cdFx0ZWUub24oJ3JlcXVlc3QnLCByZXEgPT4ge1xuXHRcdFx0aWYgKGlzU3RyZWFtKG9wdHMuYm9keSkpIHtcblx0XHRcdFx0b3B0cy5ib2R5LnBpcGUocmVxKTtcblx0XHRcdFx0b3B0cy5ib2R5ID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHJlcS5lbmQob3B0cy5ib2R5KTtcblx0XHR9KTtcblxuXHRcdGVlLm9uKCdyZXNwb25zZScsIHJlcyA9PiB7XG5cdFx0XHRjb25zdCBzdHJlYW0gPSBvcHRzLmVuY29kaW5nID09PSBudWxsID8gZ2V0U3RyZWFtLmJ1ZmZlcihyZXMpIDogZ2V0U3RyZWFtKHJlcywgb3B0cyk7XG5cblx0XHRcdHN0cmVhbVxuXHRcdFx0XHQuY2F0Y2goZXJyID0+IHJlamVjdChuZXcgZ290LlJlYWRFcnJvcihlcnIsIG9wdHMpKSlcblx0XHRcdFx0LnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0Y29uc3Qgc3RhdHVzQ29kZSA9IHJlcy5zdGF0dXNDb2RlO1xuXHRcdFx0XHRcdGNvbnN0IGxpbWl0U3RhdHVzQ29kZSA9IG9wdHMuZm9sbG93UmVkaXJlY3QgPyAyOTkgOiAzOTk7XG5cblx0XHRcdFx0XHRyZXMuYm9keSA9IGRhdGE7XG5cblx0XHRcdFx0XHRpZiAob3B0cy5qc29uICYmIHJlcy5ib2R5KSB7XG5cdFx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0XHRyZXMuYm9keSA9IEpTT04ucGFyc2UocmVzLmJvZHkpO1xuXHRcdFx0XHRcdFx0fSBjYXRjaCAoZSkge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyBuZXcgZ290LlBhcnNlRXJyb3IoZSwgc3RhdHVzQ29kZSwgb3B0cywgZGF0YSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHN0YXR1c0NvZGUgPCAyMDAgfHwgc3RhdHVzQ29kZSA+IGxpbWl0U3RhdHVzQ29kZSkge1xuXHRcdFx0XHRcdFx0dGhyb3cgbmV3IGdvdC5IVFRQRXJyb3Ioc3RhdHVzQ29kZSwgb3B0cyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0cmVzb2x2ZShyZXMpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXJyLCAncmVzcG9uc2UnLCB7dmFsdWU6IHJlc30pO1xuXHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdGVlLm9uKCdlcnJvcicsIHJlamVjdCk7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBhc1N0cmVhbShvcHRzKSB7XG5cdGNvbnN0IGlucHV0ID0gbmV3IFBhc3NUaHJvdWdoKCk7XG5cdGNvbnN0IG91dHB1dCA9IG5ldyBQYXNzVGhyb3VnaCgpO1xuXHRjb25zdCBwcm94eSA9IGR1cGxleGVyMyhpbnB1dCwgb3V0cHV0KTtcblxuXHRpZiAob3B0cy5qc29uKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdnb3QgY2FuIG5vdCBiZSB1c2VkIGFzIHN0cmVhbSB3aGVuIG9wdGlvbnMuanNvbiBpcyB1c2VkJyk7XG5cdH1cblxuXHRpZiAob3B0cy5ib2R5KSB7XG5cdFx0cHJveHkud3JpdGUgPSAoKSA9PiB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ2dvdFxcJ3Mgc3RyZWFtIGlzIG5vdCB3cml0YWJsZSB3aGVuIG9wdGlvbnMuYm9keSBpcyB1c2VkJyk7XG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IGVlID0gcmVxdWVzdEFzRXZlbnRFbWl0dGVyKG9wdHMpO1xuXG5cdGVlLm9uKCdyZXF1ZXN0JywgcmVxID0+IHtcblx0XHRwcm94eS5lbWl0KCdyZXF1ZXN0JywgcmVxKTtcblxuXHRcdGlmIChpc1N0cmVhbShvcHRzLmJvZHkpKSB7XG5cdFx0XHRvcHRzLmJvZHkucGlwZShyZXEpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlmIChvcHRzLmJvZHkpIHtcblx0XHRcdHJlcS5lbmQob3B0cy5ib2R5KTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAob3B0cy5tZXRob2QgPT09ICdQT1NUJyB8fCBvcHRzLm1ldGhvZCA9PT0gJ1BVVCcgfHwgb3B0cy5tZXRob2QgPT09ICdQQVRDSCcpIHtcblx0XHRcdGlucHV0LnBpcGUocmVxKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRyZXEuZW5kKCk7XG5cdH0pO1xuXG5cdGVlLm9uKCdyZXNwb25zZScsIHJlcyA9PiB7XG5cdFx0Y29uc3Qgc3RhdHVzQ29kZSA9IHJlcy5zdGF0dXNDb2RlO1xuXG5cdFx0cmVzLnBpcGUob3V0cHV0KTtcblxuXHRcdGlmIChzdGF0dXNDb2RlIDwgMjAwIHx8IHN0YXR1c0NvZGUgPiAyOTkpIHtcblx0XHRcdHByb3h5LmVtaXQoJ2Vycm9yJywgbmV3IGdvdC5IVFRQRXJyb3Ioc3RhdHVzQ29kZSwgb3B0cyksIG51bGwsIHJlcyk7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0cHJveHkuZW1pdCgncmVzcG9uc2UnLCByZXMpO1xuXHR9KTtcblxuXHRlZS5vbigncmVkaXJlY3QnLCBwcm94eS5lbWl0LmJpbmQocHJveHksICdyZWRpcmVjdCcpKTtcblx0ZWUub24oJ2Vycm9yJywgcHJveHkuZW1pdC5iaW5kKHByb3h5LCAnZXJyb3InKSk7XG5cblx0cmV0dXJuIHByb3h5O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVBcmd1bWVudHModXJsLCBvcHRzKSB7XG5cdGlmICh0eXBlb2YgdXJsICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgdXJsICE9PSAnb2JqZWN0Jykge1xuXHRcdHRocm93IG5ldyBFcnJvcihgUGFyYW1ldGVyIFxcYHVybFxcYCBtdXN0IGJlIGEgc3RyaW5nIG9yIG9iamVjdCwgbm90ICR7dHlwZW9mIHVybH1gKTtcblx0fVxuXG5cdGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuXHRcdHVybCA9IHVybC5yZXBsYWNlKC9edW5peDovLCAnaHR0cDovLyQmJyk7XG5cdFx0dXJsID0gdXJsUGFyc2VMYXgodXJsKTtcblxuXHRcdGlmICh1cmwuYXV0aCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdCYXNpYyBhdXRoZW50aWNhdGlvbiBtdXN0IGJlIGRvbmUgd2l0aCBhdXRoIG9wdGlvbicpO1xuXHRcdH1cblx0fVxuXG5cdG9wdHMgPSBPYmplY3QuYXNzaWduKFxuXHRcdHtcblx0XHRcdHByb3RvY29sOiAnaHR0cDonLFxuXHRcdFx0cGF0aDogJycsXG5cdFx0XHRyZXRyaWVzOiA1XG5cdFx0fSxcblx0XHR1cmwsXG5cdFx0b3B0c1xuXHQpO1xuXG5cdG9wdHMuaGVhZGVycyA9IE9iamVjdC5hc3NpZ24oe1xuXHRcdCd1c2VyLWFnZW50JzogYCR7cGtnLm5hbWV9LyR7cGtnLnZlcnNpb259IChodHRwczovL2dpdGh1Yi5jb20vc2luZHJlc29yaHVzL2dvdClgLFxuXHRcdCdhY2NlcHQtZW5jb2RpbmcnOiAnZ3ppcCxkZWZsYXRlJ1xuXHR9LCBsb3dlcmNhc2VLZXlzKG9wdHMuaGVhZGVycykpO1xuXG5cdGNvbnN0IHF1ZXJ5ID0gb3B0cy5xdWVyeTtcblxuXHRpZiAocXVlcnkpIHtcblx0XHRpZiAodHlwZW9mIHF1ZXJ5ICE9PSAnc3RyaW5nJykge1xuXHRcdFx0b3B0cy5xdWVyeSA9IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeShxdWVyeSk7XG5cdFx0fVxuXG5cdFx0b3B0cy5wYXRoID0gYCR7b3B0cy5wYXRoLnNwbGl0KCc/JylbMF19PyR7b3B0cy5xdWVyeX1gO1xuXHRcdGRlbGV0ZSBvcHRzLnF1ZXJ5O1xuXHR9XG5cblx0aWYgKG9wdHMuanNvbiAmJiBvcHRzLmhlYWRlcnMuYWNjZXB0ID09PSB1bmRlZmluZWQpIHtcblx0XHRvcHRzLmhlYWRlcnMuYWNjZXB0ID0gJ2FwcGxpY2F0aW9uL2pzb24nO1xuXHR9XG5cblx0bGV0IGJvZHkgPSBvcHRzLmJvZHk7XG5cblx0aWYgKGJvZHkpIHtcblx0XHRpZiAodHlwZW9mIGJvZHkgIT09ICdzdHJpbmcnICYmICEoYm9keSAhPT0gbnVsbCAmJiB0eXBlb2YgYm9keSA9PT0gJ29iamVjdCcpKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ29wdGlvbnMuYm9keSBtdXN0IGJlIGEgUmVhZGFibGVTdHJlYW0sIHN0cmluZywgQnVmZmVyIG9yIHBsYWluIE9iamVjdCcpO1xuXHRcdH1cblxuXHRcdG9wdHMubWV0aG9kID0gb3B0cy5tZXRob2QgfHwgJ1BPU1QnO1xuXG5cdFx0aWYgKGlzU3RyZWFtKGJvZHkpICYmIHR5cGVvZiBib2R5LmdldEJvdW5kYXJ5ID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0XHQvLyBTcGVjaWFsIGNhc2UgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9mb3JtLWRhdGEvZm9ybS1kYXRhXG5cdFx0XHRvcHRzLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gb3B0cy5oZWFkZXJzWydjb250ZW50LXR5cGUnXSB8fCBgbXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9JHtib2R5LmdldEJvdW5kYXJ5KCl9YDtcblx0XHR9IGVsc2UgaWYgKGJvZHkgIT09IG51bGwgJiYgdHlwZW9mIGJvZHkgPT09ICdvYmplY3QnICYmICFCdWZmZXIuaXNCdWZmZXIoYm9keSkgJiYgIWlzU3RyZWFtKGJvZHkpKSB7XG5cdFx0XHRvcHRzLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gb3B0cy5oZWFkZXJzWydjb250ZW50LXR5cGUnXSB8fCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJztcblx0XHRcdGJvZHkgPSBvcHRzLmJvZHkgPSBxdWVyeXN0cmluZy5zdHJpbmdpZnkoYm9keSk7XG5cdFx0fVxuXG5cdFx0aWYgKG9wdHMuaGVhZGVyc1snY29udGVudC1sZW5ndGgnXSA9PT0gdW5kZWZpbmVkICYmIG9wdHMuaGVhZGVyc1sndHJhbnNmZXItZW5jb2RpbmcnXSA9PT0gdW5kZWZpbmVkICYmICFpc1N0cmVhbShib2R5KSkge1xuXHRcdFx0Y29uc3QgbGVuZ3RoID0gdHlwZW9mIGJvZHkgPT09ICdzdHJpbmcnID8gQnVmZmVyLmJ5dGVMZW5ndGgoYm9keSkgOiBib2R5Lmxlbmd0aDtcblx0XHRcdG9wdHMuaGVhZGVyc1snY29udGVudC1sZW5ndGgnXSA9IGxlbmd0aDtcblx0XHR9XG5cdH1cblxuXHRvcHRzLm1ldGhvZCA9IChvcHRzLm1ldGhvZCB8fCAnR0VUJykudG9VcHBlckNhc2UoKTtcblxuXHRpZiAob3B0cy5ob3N0bmFtZSA9PT0gJ3VuaXgnKSB7XG5cdFx0Y29uc3QgbWF0Y2hlcyA9IC8oLispOiguKykvLmV4ZWMob3B0cy5wYXRoKTtcblxuXHRcdGlmIChtYXRjaGVzKSB7XG5cdFx0XHRvcHRzLnNvY2tldFBhdGggPSBtYXRjaGVzWzFdO1xuXHRcdFx0b3B0cy5wYXRoID0gbWF0Y2hlc1syXTtcblx0XHRcdG9wdHMuaG9zdCA9IG51bGw7XG5cdFx0fVxuXHR9XG5cblx0aWYgKHR5cGVvZiBvcHRzLnJldHJpZXMgIT09ICdmdW5jdGlvbicpIHtcblx0XHRjb25zdCByZXRyaWVzID0gb3B0cy5yZXRyaWVzO1xuXG5cdFx0b3B0cy5yZXRyaWVzID0gKGl0ZXIsIGVycikgPT4ge1xuXHRcdFx0aWYgKGl0ZXIgPiByZXRyaWVzIHx8ICFpc1JldHJ5QWxsb3dlZChlcnIpKSB7XG5cdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBub2lzZSA9IE1hdGgucmFuZG9tKCkgKiAxMDA7XG5cblx0XHRcdHJldHVybiAoKDEgPDwgaXRlcikgKiAxMDAwKSArIG5vaXNlO1xuXHRcdH07XG5cdH1cblxuXHRpZiAob3B0cy5mb2xsb3dSZWRpcmVjdCA9PT0gdW5kZWZpbmVkKSB7XG5cdFx0b3B0cy5mb2xsb3dSZWRpcmVjdCA9IHRydWU7XG5cdH1cblxuXHRpZiAob3B0cy50aW1lb3V0KSB7XG5cdFx0b3B0cy5nb3RUaW1lb3V0ID0gb3B0cy50aW1lb3V0O1xuXHRcdGRlbGV0ZSBvcHRzLnRpbWVvdXQ7XG5cdH1cblxuXHRyZXR1cm4gb3B0cztcbn1cblxuZnVuY3Rpb24gZ290KHVybCwgb3B0cykge1xuXHR0cnkge1xuXHRcdHJldHVybiBhc1Byb21pc2Uobm9ybWFsaXplQXJndW1lbnRzKHVybCwgb3B0cykpO1xuXHR9IGNhdGNoIChlcnIpIHtcblx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKTtcblx0fVxufVxuXG5jb25zdCBoZWxwZXJzID0gW1xuXHQnZ2V0Jyxcblx0J3Bvc3QnLFxuXHQncHV0Jyxcblx0J3BhdGNoJyxcblx0J2hlYWQnLFxuXHQnZGVsZXRlJ1xuXTtcblxuaGVscGVycy5mb3JFYWNoKGVsID0+IHtcblx0Z290W2VsXSA9ICh1cmwsIG9wdHMpID0+IGdvdCh1cmwsIE9iamVjdC5hc3NpZ24oe30sIG9wdHMsIHttZXRob2Q6IGVsfSkpO1xufSk7XG5cbmdvdC5zdHJlYW0gPSAodXJsLCBvcHRzKSA9PiBhc1N0cmVhbShub3JtYWxpemVBcmd1bWVudHModXJsLCBvcHRzKSk7XG5cbmZvciAoY29uc3QgZWwgb2YgaGVscGVycykge1xuXHRnb3Quc3RyZWFtW2VsXSA9ICh1cmwsIG9wdHMpID0+IGdvdC5zdHJlYW0odXJsLCBPYmplY3QuYXNzaWduKHt9LCBvcHRzLCB7bWV0aG9kOiBlbH0pKTtcbn1cblxuZnVuY3Rpb24gc3RkRXJyb3IoZXJyb3IsIG9wdHMpIHtcblx0aWYgKGVycm9yLmNvZGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHRoaXMuY29kZSA9IGVycm9yLmNvZGU7XG5cdH1cblxuXHRPYmplY3QuYXNzaWduKHRoaXMsIHtcblx0XHRtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuXHRcdGhvc3Q6IG9wdHMuaG9zdCxcblx0XHRob3N0bmFtZTogb3B0cy5ob3N0bmFtZSxcblx0XHRtZXRob2Q6IG9wdHMubWV0aG9kLFxuXHRcdHBhdGg6IG9wdHMucGF0aFxuXHR9KTtcbn1cblxuZ290LlJlcXVlc3RFcnJvciA9IGNyZWF0ZUVycm9yQ2xhc3MoJ1JlcXVlc3RFcnJvcicsIHN0ZEVycm9yKTtcbmdvdC5SZWFkRXJyb3IgPSBjcmVhdGVFcnJvckNsYXNzKCdSZWFkRXJyb3InLCBzdGRFcnJvcik7XG5nb3QuUGFyc2VFcnJvciA9IGNyZWF0ZUVycm9yQ2xhc3MoJ1BhcnNlRXJyb3InLCBmdW5jdGlvbiAoZSwgc3RhdHVzQ29kZSwgb3B0cywgZGF0YSkge1xuXHRzdGRFcnJvci5jYWxsKHRoaXMsIGUsIG9wdHMpO1xuXHR0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuXHR0aGlzLnN0YXR1c01lc3NhZ2UgPSBodHRwLlNUQVRVU19DT0RFU1t0aGlzLnN0YXR1c0NvZGVdO1xuXHR0aGlzLm1lc3NhZ2UgPSBgJHtlLm1lc3NhZ2V9IGluIFwiJHt1cmxMaWIuZm9ybWF0KG9wdHMpfVwiOiBcXG4ke2RhdGEuc2xpY2UoMCwgNzcpfS4uLmA7XG59KTtcblxuZ290LkhUVFBFcnJvciA9IGNyZWF0ZUVycm9yQ2xhc3MoJ0hUVFBFcnJvcicsIGZ1bmN0aW9uIChzdGF0dXNDb2RlLCBvcHRzKSB7XG5cdHN0ZEVycm9yLmNhbGwodGhpcywge30sIG9wdHMpO1xuXHR0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuXHR0aGlzLnN0YXR1c01lc3NhZ2UgPSBodHRwLlNUQVRVU19DT0RFU1t0aGlzLnN0YXR1c0NvZGVdO1xuXHR0aGlzLm1lc3NhZ2UgPSBgUmVzcG9uc2UgY29kZSAke3RoaXMuc3RhdHVzQ29kZX0gKCR7dGhpcy5zdGF0dXNNZXNzYWdlfSlgO1xufSk7XG5cbmdvdC5NYXhSZWRpcmVjdHNFcnJvciA9IGNyZWF0ZUVycm9yQ2xhc3MoJ01heFJlZGlyZWN0c0Vycm9yJywgZnVuY3Rpb24gKHN0YXR1c0NvZGUsIG9wdHMpIHtcblx0c3RkRXJyb3IuY2FsbCh0aGlzLCB7fSwgb3B0cyk7XG5cdHRoaXMuc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGU7XG5cdHRoaXMuc3RhdHVzTWVzc2FnZSA9IGh0dHAuU1RBVFVTX0NPREVTW3RoaXMuc3RhdHVzQ29kZV07XG5cdHRoaXMubWVzc2FnZSA9ICdSZWRpcmVjdGVkIDEwIHRpbWVzLiBBYm9ydGluZy4nO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gZ290O1xuIl19